
.. _program_listing_file_lib_BaseStatus.hpp:

Program Listing for File BaseStatus.hpp
=======================================

|exhale_lsh| :ref:`Return to documentation for file <file_lib_BaseStatus.hpp>` (``lib/BaseStatus.hpp``)

.. |exhale_lsh| unicode:: U+021B0 .. UPWARDS ARROW WITH TIP LEFTWARDS

.. code-block:: cpp

   #pragma once
   
   #include <sqlite3.h>
   #include "AnalysisGraph.hpp"
   #include "DatabaseHelper.hpp"
   #include "utils.hpp"
   #include <thread>
   #include <ctime>
   #include <chrono>
   #include <nlohmann/json.hpp>
   
   using namespace std;
   using json = nlohmann::json;
   
   class BaseStatus {
   
     private:
       Database* database = nullptr;
       std::thread *pThread = nullptr;
       bool recording = false;
       string timestamp();
       string class_name = "N/A";
       string table_name = "N/A";
       void create_table();
       void clean_table();
       void clean_row(string id);
       json read_row(string id);
   
     protected:
       void scheduler();
       void log_error(string msg);
       void log_info(string msg);
       bool is_busy(string id); 
       void write_row(string id, json status);
       json get_status_with_id(string id);
       virtual void update_db() = 0;
       double progress = 0.0;
   
     public:
       BaseStatus(
         Database* database,
         const string table_name,
         const string class_name
       ) :
         database(database),
         table_name(table_name),
         class_name(class_name){}
       ~BaseStatus(){}
   
       void clean_db();
       void set_progress(double p) { progress = p;}
       void increment_progress(double i) { progress += i;}
       virtual json get_status() = 0;
       void start_recording();
       void stop_recording();
   
       // serialized JSON fields in the status text
       const string COL_ID = "id"; // database column, not exported
       const string COL_STATUS = "status"; // database column, not exported
       const string PROGRESS = "progressPercentage"; // JSON field, API
       const string STATUS = "status"; // JSON field, ?
   };
