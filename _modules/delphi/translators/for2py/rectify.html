<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>delphi.translators.for2py.rectify &mdash; delphi  documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/collapsible-lists/css/tree_view.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../../../../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> delphi
            <img src="../../../../_static/delphi_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../model.html">The Delphi model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../GrFN_API.html">GroundedFunctionNetwork API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../grfn_spec.html">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cpp_api/library_root.html">C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../grfn_openapi.html">GrFN OpenAPI Specification</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">delphi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
          <li><a href="../for2py.html">delphi.translators.for2py</a> &raquo;</li>
      <li>delphi.translators.for2py.rectify</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for delphi.translators.for2py.rectify</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The purpose of this module is to do all the clean up for translate.py.</span>
<span class="sd">This (rectify.py) module contains functions that receive OFP generated XML as an input.</span>
<span class="sd">Then, the functions removes any unnecessary elements and refactor randomly structured</span>
<span class="sd">(nested) elements into a correct structure. The output file will be</span>
<span class="sd">approximately 30%~40% lighter in terms of number of lines than the OFP XML.</span>

<span class="sd">Author: Terrence J. Lim</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">delphi.translators.for2py</span> <span class="kn">import</span> <span class="n">For2PyError</span><span class="p">,</span> <span class="n">syntax</span><span class="p">,</span> <span class="n">f2grfn</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">isfile</span><span class="p">,</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="n">TYPE_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;int&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bool&quot;</span><span class="p">:</span> <span class="s2">&quot;logical&quot;</span><span class="p">,</span>
<span class="p">}</span>

<div class="viewcode-block" id="RectifiedXMLGenerator"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator">[docs]</a><span class="k">class</span> <span class="nc">RectifiedXMLGenerator</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># True if derived type declaration exist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if derived type var. reference exist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type_ref</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if current var. is an array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_array</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if format exists in the code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_format</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if current var. is for function argument</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_function_arg</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True only if goto-stmt exists in the AST</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">need_goto_elimination</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if more goto-stmt exists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">continue_elimination</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if operation negation is needed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">need_op_negation</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if any statement requires reconstruction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">need_reconstruct</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if each goto case is ready for reconstruction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_after_case_now</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_before_case_now</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if each goto case encountered</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_after</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if statement nests stop statement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_stop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if statements follow either after</span>
        <span class="c1"># goto or label. Both cannot be true</span>
        <span class="c1"># at the same time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_goto</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_label</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if collecting of statement is done</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collecting_stmts_done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if reconstruction (goto elimination) is done</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruction_for_after_done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruction_for_before_done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if one reconstructed statement needs another</span>
        <span class="c1"># reconstruction by nesting it under do while due to</span>
        <span class="c1"># label_before case exist as it&#39;s parent goto</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encapsulate_under_do_while</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Keep a track where goto was declared</span>
        <span class="c1"># whether it&#39;s under program(main) or loop body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_loop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Keeps track of the signed real/int literal constant inside data</span>
        <span class="c1"># statements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_data_stmt_constant</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Keeps records of encountered &lt;goto-stmt&gt; lbl value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_after</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_before</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Keeps records of encountered &lt;label&gt; lbl value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_after</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># A name mapper list for declared</span>
        <span class="c1"># &#39;label_flag_&#39; variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declared_label_flags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declared_goto_flags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># A list to hold save_entity tags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_entities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Keep a track of all encountered goto and label stmts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encountered_goto_label</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Keep a track of goto and label with its case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_label_with_case</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Keeps a track of current label of goto-stmt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Keep a track of operations for conditional goto</span>
        <span class="c1"># key will be the unique code assigned to each &lt;goto-stmt&gt;</span>
        <span class="c1"># {code:Element}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conditional_op</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Counts the number of &lt;goto-stmt&gt; in the code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_stmt_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Keep a track of collected goto-stmts and labels</span>
        <span class="c1"># for goto elimination and reconstruction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stmts_after_goto</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;goto-stmts&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>
        <span class="c1"># Dictionary to hold statements before_after case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;stmts-follow-label&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;count-gotos&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># Dictionary to hold statements label_after case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;stmts-follow-goto&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;stmts-follow-label&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;count-gotos&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># Keeps a track of current derived type name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_derived_type_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Keeps a track of current scope of code</span>
        <span class="c1"># i.e. program, main, or function, etc.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Keep a track of both array and non-array variables</span>
        <span class="c1"># in the dictionary of {&#39;name&#39; : &#39;scope&#39;}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declared_non_array_vars</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Keep a track of declared derived type variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Holds variables extracted from derived type refenrece</span>
        <span class="c1"># i.e. x%y%z, then x and y and z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_refs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Keeps track of subscripts of arrays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscripts_holder</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Holds format XML for later reconstruction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format_holder</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Holds a type of parent element&#39;s type element</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_type</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="c1"># Holds XML of derived type reference for later reconstruction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_ref</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="c1"># Actually holds XML of current scope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_body_scope</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="c1"># Keeps a track of parent statements to goto-stmt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_stmt_parents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Keeps a track of parent statements to label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_parents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Flag to check if the variable is a character</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_character</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># List to store all the character variables defined</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">character_var_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Keeps a track of the main body that the statement</span>
        <span class="c1"># is nested under, i.e. program, loop, and if, etc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;current&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;prev&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;grand-prev&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_level_rank</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;program&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;if&quot;</span><span class="p">:</span> <span class="mi">2</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_elem_holder</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;program&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;if&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># Check for the status whether current &lt;goto-stmt&gt; is</span>
        <span class="c1"># conditional or not.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conditional_goto</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if goto handling needs outward or</span>
        <span class="c1"># inward movement.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outward_move</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inward_move</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if another &lt;if&gt; appears before</span>
        <span class="c1"># goto. This &lt;if&gt; has nothing to do</span>
        <span class="c1"># conditional status of goto.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">if_appear_before_goto</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># True if goto is under &lt;if&gt; that is</span>
        <span class="c1"># a conditional goto statement.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_if</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># If goto is conditional and under else</span>
        <span class="c1"># that is a case of conditional without operator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_else</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># When handling function, collect names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args_for_function</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Holds arguments of subroutine or function XML object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arguments_list</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Holds function argument types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">argument_types</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Temporarily holds the type of declaring variable type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Holds the caller arguments that are array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller_arr_arguments</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Set to true if handling &lt;call&gt;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_function</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_fortran_file_abs_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module_log_file_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module_files_to_process</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules_in_file</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_array_dimensions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Keeps a track of maximum number of function</span>
        <span class="c1"># arguments that are member of interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">member_function_argument_max</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Mark whether currently handling interface</span>
        <span class="c1"># member functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_interface_member</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Keeps a track of interface function names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface_functions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface_function_xml</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Mark wheter currently handling interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_interface</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Keep a track of currently declaring interface name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_interface_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Keep a track of interface XML object for later update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface_xml</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimensions_holder</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Keep a dictionary of declared variables {&quot;var_name&quot;:&quot;type&quot;}</span>
        <span class="c1"># by their scope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables_by_scope</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Keep a track of used module in the current program</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">used_modules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Holds module summary imported from modFileLog.json file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module_summary</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1">#################################################################</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#                  TAG LISTS FOR EACH HANDLER                   #</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#################################################################</span>

    <span class="n">file_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;program&quot;</span><span class="p">,</span>
        <span class="s2">&quot;subroutine&quot;</span><span class="p">,</span>
        <span class="s2">&quot;module&quot;</span><span class="p">,</span>
        <span class="s2">&quot;declaration&quot;</span><span class="p">,</span>
        <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prefix&quot;</span>
    <span class="p">]</span>

    <span class="n">program_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;header&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span>
    <span class="p">]</span>

    <span class="n">statement_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;assignment&quot;</span><span class="p">,</span>
        <span class="s2">&quot;write&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stop&quot;</span><span class="p">,</span>
        <span class="s2">&quot;execution-part&quot;</span><span class="p">,</span>
        <span class="s2">&quot;print&quot;</span><span class="p">,</span>
        <span class="s2">&quot;open&quot;</span><span class="p">,</span>
        <span class="s2">&quot;read&quot;</span><span class="p">,</span>
        <span class="s2">&quot;close&quot;</span><span class="p">,</span>
        <span class="s2">&quot;call&quot;</span><span class="p">,</span>
        <span class="s2">&quot;statement&quot;</span><span class="p">,</span>
        <span class="s2">&quot;label&quot;</span><span class="p">,</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;continue-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;do-term-action-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;return&quot;</span><span class="p">,</span>
        <span class="s2">&quot;contains-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;declaration&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prefix&quot;</span><span class="p">,</span>
        <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="s2">&quot;internal-subprogram&quot;</span><span class="p">,</span>
        <span class="s2">&quot;internal-subprogram-part&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prefix&quot;</span><span class="p">,</span>
        <span class="s2">&quot;exit&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cycle&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">loop_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;header&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span>
    <span class="p">]</span>

    <span class="n">specification_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;declaration&quot;</span><span class="p">,</span>
        <span class="s2">&quot;use&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">declaration_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;type&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dimensions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variables&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type-declaration-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prefix-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;save-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;saved-entity&quot;</span><span class="p">,</span>
        <span class="s2">&quot;access-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;attr-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;access-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;access-id-list&quot;</span><span class="p">,</span>
        <span class="s2">&quot;constants&quot;</span><span class="p">,</span>
        <span class="s2">&quot;interface&quot;</span><span class="p">,</span>
        <span class="s2">&quot;subroutine&quot;</span><span class="p">,</span>
        <span class="s2">&quot;intent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;names&quot;</span><span class="p">,</span>
        <span class="s2">&quot;procedure-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;values&quot;</span>
    <span class="p">]</span>

    <span class="n">value_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">derived_type_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;declaration-type-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type-param-or-comp-def-stmt-list&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-decl-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-initialization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data-component-def-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-def-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-attr-spec-list&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-attr-spec-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;explicit-shape-spec-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;explicit-shape-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;explicit-shape-spec-list&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-attr-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-attr-spec-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-shape-spec-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;explicit-shape-spec-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;explicit-shape-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-attr-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-attr-spec-list&quot;</span><span class="p">,</span>
        <span class="s2">&quot;end-type-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;derived-type-def&quot;</span><span class="p">,</span>

    <span class="p">]</span>

    <span class="n">header_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;index-variable&quot;</span><span class="p">,</span>
        <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;arguments&quot;</span><span class="p">,</span>
        <span class="s2">&quot;names&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;loop-control&quot;</span><span class="p">,</span>
        <span class="s2">&quot;label&quot;</span><span class="p">,</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;equiv-operand__equiv-op&quot;</span><span class="p">,</span>
        <span class="s2">&quot;subroutine-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;value-ranges&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">body_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;specification&quot;</span><span class="p">,</span>
        <span class="s2">&quot;statement&quot;</span><span class="p">,</span>
        <span class="s2">&quot;loop&quot;</span><span class="p">,</span>
        <span class="s2">&quot;if&quot;</span><span class="p">,</span>
        <span class="s2">&quot;label&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stop&quot;</span><span class="p">,</span>
        <span class="s2">&quot;do-term-action-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;select&quot;</span><span class="p">,</span>
        <span class="s2">&quot;case&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">operand_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">subscripts_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;argument&quot;</span><span class="p">,</span>
        <span class="s2">&quot;range&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">index_range_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;lower-bound&quot;</span><span class="p">,</span>
        <span class="s2">&quot;upper-bound&quot;</span><span class="p">,</span>
        <span class="s2">&quot;step&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">bound_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">module_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;header&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">,</span>
        <span class="s2">&quot;module-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;members&quot;</span><span class="p">,</span>
        <span class="s2">&quot;end-module-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;contains-stmt&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">members_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;subroutine&quot;</span><span class="p">,</span>
        <span class="s2">&quot;module-subprogram&quot;</span><span class="p">,</span>
        <span class="s2">&quot;module-subprogram-part&quot;</span><span class="p">,</span>
        <span class="s2">&quot;declaration&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prefix&quot;</span><span class="p">,</span>
        <span class="s2">&quot;function&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">only_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;only&quot;</span><span class="p">,</span>
        <span class="s2">&quot;only-list&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">select_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;header&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">case_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;header&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">unnecessary_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;do-variable&quot;</span><span class="p">,</span>
        <span class="s2">&quot;end-program-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;main-program&quot;</span><span class="p">,</span>
        <span class="s2">&quot;char-selector&quot;</span><span class="p">,</span>
        <span class="s2">&quot;declaration-type-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type-param-or-comp-def-stmt-list&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-decl-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data-component-def-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-def-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-initialization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;attr-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;attr-id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;designator&quot;</span><span class="p">,</span>
        <span class="s2">&quot;int-literal-constant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;char-literal-constant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;real-literal-constant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;io-control-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;array-spec-element&quot;</span><span class="p">,</span>
        <span class="s2">&quot;print-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;print-format&quot;</span><span class="p">,</span>
        <span class="s2">&quot;keyword-argument&quot;</span><span class="p">,</span>
        <span class="s2">&quot;end-subroutine-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;logical-literal-constant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;equiv-op&quot;</span><span class="p">,</span>
        <span class="s2">&quot;equiv-operand&quot;</span><span class="p">,</span>
        <span class="s2">&quot;saved-entity-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;saved-entity-list&quot;</span><span class="p">,</span>
        <span class="s2">&quot;access-id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parameter-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type-param-value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;char-selector&quot;</span><span class="p">,</span>
        <span class="s2">&quot;interface-block&quot;</span><span class="p">,</span>
        <span class="s2">&quot;interface-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;interface-body&quot;</span><span class="p">,</span>
        <span class="s2">&quot;interface-specification&quot;</span><span class="p">,</span>
        <span class="s2">&quot;end-interface-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;select-case-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;case-selector&quot;</span><span class="p">,</span>
        <span class="s2">&quot;case-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;end-select-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-attr-spec-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;explicit-shape-spec-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;explicit-shape-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;explicit-shape-spec-list&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-attr-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-attr-spec-list&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sequence-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;private-or-sequence&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data-stmt-set&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;signed-real-literal-constant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;signed-int-literal-constant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data-stmt-constant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data-i-do-object-list__begin&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">output_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">dtype_var_declaration_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;component-decl&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-decl-list&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-decl-list__begin&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">variable_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;initial-value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;length&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dimensions&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1">#################################################################</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#                       HANDLER FUNCTIONS                       #</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#################################################################</span>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_file"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_file">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_file</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">       between the file elements.</span>

<span class="sd">        In order to control new sub-element creation under</span>
<span class="sd">        the current element, if child.tag == &quot;__tag_name__&quot;</span>
<span class="sd">        has been added. If any new tag(s) that is not being</span>
<span class="sd">        handled currently, appears in the future, add</span>
<span class="sd">        child.tag == &quot;__tag_name__&quot; at the end of the last</span>
<span class="sd">        condition. This applies all other handler functions.</span>

<span class="sd">        &lt;file&gt;</span>
<span class="sd">        &lt;/file&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_child_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_file: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_program"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_program">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_program</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML</span>
<span class="sd">        elements between the program elements.</span>

<span class="sd">        &lt;program&gt;</span>
<span class="sd">        &lt;/program&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">program_child_tags</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">current_body_scope</span> <span class="o">=</span> <span class="n">cur_elem</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_program: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_header"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_header">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_header</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the header elements.</span>

<span class="sd">        &lt;header&gt;</span>
<span class="sd">        &lt;/header&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This holder will be used only when refactoring of header is needed,</span>
        <span class="c1"># such as with odd syntax of .eqv. operator</span>
        <span class="n">temp_elem_holder</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">target_tags</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
                <span class="s2">&quot;equiv-operand__equiv-op&quot;</span>
        <span class="p">]</span>
        <span class="n">need_refactoring</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_child_tags</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subroutine-stmt&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>

                    <span class="c1"># Add a new interface:[] element into the interface</span>
                    <span class="c1"># function tracker dictionary if current header is</span>
                    <span class="c1"># for declaring interface.</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_interface</span> <span class="ow">and</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">interface_functions</span><span class="p">[</span><span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">interface_function_xml</span><span class="p">[</span><span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cur_interface_name</span> <span class="o">=</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                                <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                        <span class="p">)</span>
                        <span class="c1"># If the current header belongs to &lt;function&gt;,</span>
                        <span class="c1"># we need to manipulate the structure of the AST</span>
                        <span class="c1"># to have an equivalent syntax as &lt;subroutine&gt;</span>
                        <span class="k">if</span> <span class="p">(</span>
                                <span class="n">parent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span>
                                <span class="ow">and</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;names&quot;</span>
                        <span class="p">):</span>
                            <span class="n">current</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">)</span>
                            <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args_for_function</span><span class="p">)</span>
                            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                                                <span class="n">current</span><span class="p">,</span> <span class="s2">&quot;arguments&quot;</span><span class="p">,</span>
                                                <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)})</span>
                            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_for_function</span><span class="p">:</span>
                                <span class="n">_</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                                                <span class="n">cur_elem</span><span class="p">,</span> <span class="s2">&quot;argument&quot;</span><span class="p">,</span>
                                                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">arg</span><span class="p">,</span>
                                                 <span class="s2">&quot;is_array&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">}</span>
                                <span class="p">)</span>

                        <span class="c1"># If the current header belongs to &lt;subroutine&gt;,</span>
                        <span class="c1"># add it to the arguments_list for later</span>
                        <span class="c1"># array status marking when a function call happens</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subroutine&quot;</span>
                             <span class="ow">and</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;arguments&quot;</span><span class="p">)</span>
                            <span class="ow">or</span> <span class="n">parent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span>
                        <span class="p">):</span>
                            <span class="n">sub_name</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">arguments_list</span><span class="p">[</span><span class="n">sub_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur_elem</span>

                    <span class="k">if</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="n">target_tags</span><span class="p">:</span>
                        <span class="n">temp_elem_holder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;equiv-operand__equiv-op&quot;</span><span class="p">:</span>
                            <span class="n">need_refactoring</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="c1"># Handler for the case where label appears under</span>
                    <span class="c1"># the header element. This happens when label</span>
                    <span class="c1"># is assigned to the if statement.</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">traverse</span> <span class="o">==</span> <span class="mi">1</span>
                        <span class="ow">and</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;label&quot;</span>
                    <span class="p">):</span>
                        <span class="n">lbl</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span>
                        <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lbl</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">encountered_goto_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>
                        <span class="c1"># Label-before case</span>
                        <span class="k">if</span> <span class="p">(</span>
                                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_after</span>
                                <span class="ow">or</span> <span class="n">lbl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_after</span>
                        <span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">goto_label_with_case</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;before&quot;</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_after</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">if</span> <span class="n">lbl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_header: Empty elements &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot;&#39;</span>

        <span class="c1"># Revert the argument list back to its empty state to accommodate for</span>
        <span class="c1"># new functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args_for_function</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># equivalent operator has a weird ast syntax,</span>
        <span class="c1"># so it requires refactoring.</span>
        <span class="k">if</span> <span class="n">need_refactoring</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_header</span><span class="p">(</span><span class="n">temp_elem_holder</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_body"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_body">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_body</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the body elements.</span>

<span class="sd">        &lt;body&gt;</span>
<span class="sd">        &lt;/body&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_elem_holder</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">current</span>
        <span class="c1"># Keeping the track of the body&#39;s boundary.</span>
        <span class="k">if</span> <span class="n">traverse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;prev&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;grand-prev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">tag</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;prev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">tag</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="p">),</span> <span class="s2">&quot;self.body_level[&#39;current&#39;] cannot be None.&quot;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;grand-prev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;prev&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;prev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">tag</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_child_tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="n">traverse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># Handling conditional &lt;goto-stmt&gt;</span>
                        <span class="k">if</span> <span class="p">(</span>
                                <span class="n">parent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;if&quot;</span>
                                <span class="ow">and</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span>
                        <span class="p">):</span>
                            <span class="k">assert</span> <span class="p">(</span>
                                    <span class="s2">&quot;lbl&quot;</span> <span class="ow">in</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span>
                            <span class="p">),</span> <span class="s2">&quot;Label &#39;lbl&#39; must be present in &lt;if&gt; attrib&quot;</span>

                            <span class="c1"># goto-stmt counter will be used as</span>
                            <span class="c1"># an identifier for two statements</span>
                            <span class="c1"># that are nested one in another</span>
                            <span class="n">unique_code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goto_stmt_counter</span><span class="p">)</span>

                            <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;conditional-goto-stmt-lbl&#39;</span><span class="p">]</span> <span class="o">=</span> \
                                <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span>
                            <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unique_code</span>
                            <span class="k">if</span> <span class="s2">&quot;goto-move&quot;</span> <span class="ow">in</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                                <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                            <span class="k">if</span> <span class="s2">&quot;goto-remove&quot;</span> <span class="ow">in</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                                <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-remove&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>

                            <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;conditional-goto-stmt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                            <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unique_code</span>
                            <span class="c1"># If the &lt;statement&gt; for &lt;goto-stmt&gt; is nested</span>
                            <span class="c1"># under the conditional &lt;if&gt;, then the boundary of</span>
                            <span class="c1"># &lt;statement&gt; remains as the current - 1 level.</span>
                            <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;body-level&#39;</span><span class="p">]</span> <span class="o">=</span> \
                                <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;prev&#39;</span><span class="p">]</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;prev&#39;</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;grand-prev&#39;</span><span class="p">]</span> <span class="o">=</span> \
                                <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;prev&#39;</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;prev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">tag</span>

                        <span class="c1"># Check if conditional goto-stmt is under loop statement</span>
                        <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span>
                                    <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;if&quot;</span>
                                    <span class="ow">or</span> <span class="p">(</span>
                                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;statement&quot;</span>
                                        <span class="ow">and</span> <span class="s2">&quot;conditional-goto-stmt&quot;</span> <span class="ow">in</span>
                                        <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                                    <span class="p">)</span>
                            <span class="p">):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_loop</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="c1"># Check a case where &lt;if&gt; under another &lt;if&gt;.</span>
                        <span class="c1"># &lt;if&gt;</span>
                        <span class="c1">#   &lt;if&gt;</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">grandparent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span>
                            <span class="ow">and</span> <span class="s2">&quot;parent&quot;</span> <span class="ow">in</span> <span class="n">grandparent</span><span class="o">.</span><span class="n">attrib</span>
                            <span class="ow">and</span> <span class="n">grandparent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;if&quot;</span>
                        <span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_if</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># A Checker for whether current statement is</span>
                        <span class="c1"># nested under the loop.</span>
                        <span class="k">if</span> <span class="s2">&quot;body-level&quot;</span> <span class="ow">in</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;body-level&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_loop</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_loop</span> <span class="o">=</span> <span class="kc">False</span>

                        <span class="n">new_parent</span> <span class="o">=</span> <span class="n">current</span>
                        <span class="c1"># Reconstruction of statements</span>
                        <span class="k">if</span> <span class="p">(</span>
                                <span class="s2">&quot;parent&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span>
                                <span class="ow">and</span> <span class="p">(</span>
                                <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_loop</span>
                                    <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_if</span>
                                    <span class="ow">and</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;program&quot;</span><span class="p">)</span>
                                <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goto_under_if</span>
                                    <span class="ow">and</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;if&quot;</span><span class="p">)</span>
                                <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goto_under_loop</span>
                                    <span class="ow">and</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;loop&quot;</span><span class="p">)</span>
                                    <span class="p">)</span>
                        <span class="p">):</span>
                            <span class="c1"># Remove statements marked for removal(2nd traverse)</span>
                            <span class="k">if</span> <span class="p">(</span>
                                    <span class="s2">&quot;goto-remove&quot;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                                    <span class="ow">or</span> <span class="s2">&quot;goto-move&quot;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                            <span class="p">):</span>
                                <span class="n">current</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">)</span>
                                <span class="k">if</span> <span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_after_case_now</span>
                                        <span class="ow">and</span>
                                        <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruction_for_after_done</span>
                                <span class="p">):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_goto_after_label</span><span class="p">(</span>
                                        <span class="n">new_parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span>
                                    <span class="p">)</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">continue_elimination</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">if</span> <span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_before_case_now</span>
                                        <span class="ow">and</span>
                                        <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruction_for_before_done</span>
                                <span class="p">):</span>
                                    <span class="n">reconstruct_target</span> <span class="o">=</span> \
                                        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_goto_before_label</span><span class="p">(</span>
                                        <span class="n">new_parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span> <span class="n">reconstruct_target</span>
                                    <span class="p">)</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_after</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">continue_elimination</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">if</span> <span class="p">(</span>
                                        <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span>
                                        <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_after</span>
                                <span class="p">):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">continue_elimination</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_body: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; &#39;</span> \
                                  <span class="sa">f</span><span class="s1">&#39;not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_child_tags</span>
                        <span class="ow">and</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="s2">&quot;statement&quot;</span>
                <span class="p">):</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;statement&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                            <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                            <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_body: Empty elements &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot;&#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39; not handled&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_format</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_format</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_format</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_specification"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_specification">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_specification</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the specification elements.</span>

<span class="sd">        &lt;specification&gt;</span>
<span class="sd">        &lt;/specification&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specification_child_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_specification: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="s2">&quot;declaration&quot;</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_specification: Empty elements &#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot;&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_declaration"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_declaration">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_declaration</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the declaration elements.</span>

<span class="sd">        &lt;declaration&gt;</span>
<span class="sd">        &lt;/declaration&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_derived_type_dimension_setting</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">is_end_of_one_dimension</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">dim_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="c1"># Temporarily hold the declaring variable&#39;s type.</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;type&quot;</span> <span class="ow">and</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">variable_type</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="c1"># Keep a track of array in derived type dimension information.</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;explicit-shape-spec-list__begin&quot;</span><span class="p">:</span>
                <span class="n">is_derived_type_dimension_setting</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">dim_number</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_array_dimensions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;explicit-shape-spec&quot;</span><span class="p">:</span>
                <span class="n">is_end_of_one_dimension</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">dim_number</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;explicit-shape-spec-list&quot;</span><span class="p">:</span>
                <span class="n">is_derived_type_dimension_setting</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declaration_child_tags</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">is_format</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">format_holder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
                            <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span>
                    <span class="p">):</span>
                        <span class="k">if</span> <span class="n">is_derived_type_dimension_setting</span><span class="p">:</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;dim-number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dim_number</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_array_dimensions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                            <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">is_array</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                            <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                        <span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-array-spec&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;operation&quot;</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_declaration: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declaration_child_tags</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;saved-entity&quot;</span><span class="p">:</span>
                        <span class="c1"># If you find saved-entity, add the element to a list </span>
                        <span class="c1"># and remove it from the XML since you want to shift </span>
                        <span class="c1"># it below save-stmt</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">saved_entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">)</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;save-stmt&quot;</span><span class="p">:</span>
                        <span class="c1"># If you find save-stmt, check if it contains </span>
                        <span class="c1"># saved-entities and add it below this XML element</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saved_entities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_entities</span><span class="p">:</span>
                                <span class="n">_</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                                  <span class="n">item</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>

                            <span class="c1"># Reinitialize this list since you&#39;ll need an</span>
                            <span class="c1"># empty one for the next SAVE statement</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">saved_entities</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-decl&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-decl-list&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-decl-list__begin&quot;</span>
                <span class="p">):</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;derived-type&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-array-spec&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span>
                            <span class="ow">and</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_child_tags</span>
                    <span class="p">):</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="kc">False</span>
                        <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;self.In handle_tag_declaration: Empty elements &quot;&#39;</span> \
                            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_array</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_array</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_character</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_character</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># If is_derived_type is true,</span>
        <span class="c1"># reconstruct the derived type declaration AST structure</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">:</span>
                <span class="c1"># Modify or add &#39;name&#39; attribute of the MAIN (or the outer</span>
                <span class="c1"># most) &lt;type&gt; elements with the name of derived type name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent_type</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_derived_type_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_derived_type_declaration</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">variable_type</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions_holder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restruct_declaration</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dimensions_holder</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Keep a track of all declared variables by scope</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span>
                <span class="ow">and</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables_by_scope</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">variables_by_scope</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">current</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span>
                    <span class="n">var_type</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;variables&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">subElem</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">subElem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables_by_scope</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span><span class="p">][</span><span class="n">subElem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">var_type</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_type"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_type">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_type</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the variables elements.</span>

<span class="sd">        &lt;type&gt;</span>
<span class="sd">        &lt;/type&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;character&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_character</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">current</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;string_length&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">dim_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">is_derived_type_dimension_setting</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;keyword2&quot;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;keyword2&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;keyword2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;keyword2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;keyword2&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;keyword2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span>
                <span class="c1"># Having a nested &quot;type&quot; indicates that this is</span>
                <span class="c1"># a &quot;derived type&quot; declaration.</span>
                <span class="c1">#    In other word, this is a case of</span>
                <span class="c1">#    &lt;type&gt;</span>
                <span class="c1">#        &lt;type&gt;</span>
                <span class="c1">#            ...</span>
                <span class="c1">#        &lt;/type&gt;</span>
                <span class="c1">#    &lt;/type&gt;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent_type</span> <span class="o">=</span> <span class="n">current</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;derived-type-stmt&quot;</span><span class="p">:</span>
                <span class="c1"># If child.tag is derived-type-stmt while self.is_derived_type</span>
                <span class="c1"># is not true, it&#39;s an indication of only a single variable</span>
                <span class="c1"># was declared under the derived type declaration, so the syntax</span>
                <span class="c1"># has no nested type case like above. Thus, in order to make</span>
                <span class="c1"># the syntax same, I&#39;m adding another type and nest everything</span>
                <span class="c1"># under it.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">type_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                              <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                    <span class="n">type_elem</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;is_derived_type&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span><span class="p">))</span>
                    <span class="n">type_elem</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent_type</span> <span class="o">=</span> <span class="n">current</span>
                <span class="c1"># Modify or add &#39;name&#39; attribute of the &lt;type&gt;</span>
                <span class="c1"># elements with the name of derived type name</span>
                <span class="n">current</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
                <span class="c1"># And, store the name of the derived type name for</span>
                <span class="c1"># later setting the outer most &lt;type&gt; elements&#39;s name attribute</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur_derived_type_name</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;explicit-shape-spec-list__begin&quot;</span><span class="p">:</span>
                <span class="n">is_derived_type_dimension_setting</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">dim_number</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_array_dimensions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;explicit-shape-spec&quot;</span><span class="p">:</span>
                <span class="n">is_end_of_one_dimension</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">dim_number</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;explicit-shape-spec-list&quot;</span><span class="p">:</span>
                <span class="n">is_derived_type_dimension_setting</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;intrinsic-type-spec&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;derived-type-spec&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_type</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">variable_type</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;typeName&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;typeName&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_character</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;string_length&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="n">is_derived_type_dimension_setting</span><span class="p">:</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;dim-number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dim_number</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_array_dimensions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">is_derived_type_dimension_setting</span>
                    <span class="ow">and</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
            <span class="p">):</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;dim-number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dim_number</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_array_dimensions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-array-spec&quot;</span>
                    <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;operation&quot;</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_var_declaration_tags</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;length&quot;</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_type: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not &#39;</span> \
                                  <span class="sa">f</span><span class="s1">&#39;handled&#39;</span>
        <span class="c1"># This will mark whether this type declaration is for a derived type</span>
        <span class="c1"># declaration or not</span>
        <span class="n">current</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;is_derived_type&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span><span class="p">))</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_variables"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_variables">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_variables</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the variables elements.</span>

<span class="sd">        &lt;variables&gt;</span>
<span class="sd">        &lt;/variables&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span>
                        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">argument_types</span>
                        <span class="ow">and</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">argument_types</span><span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">argument_types</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span><span class="p">][</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span>
                        <span class="s1">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_type</span>
                <span class="c1"># Up to this point, all the child (nested or sub) elements were</span>
                <span class="c1"># &lt;variable&gt;</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="n">cur_elem</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;is_array&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_array</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span>
                    <span class="ow">and</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">):</span>
                    <span class="n">grandparent</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span>
                        <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_variables: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_variable"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_variable">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_variable</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the variables elements.</span>

<span class="sd">        &lt;variable&gt;</span>
<span class="sd">        &lt;/variable&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Store all declared variables based on their array status</span>
        <span class="k">if</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">declared_non_array_vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span><span class="p">}</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_character</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">character_var_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_child_tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                            <span class="p">{</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span><span class="p">}</span>
                        <span class="p">)</span>
                        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_non_array_vars</span><span class="p">[</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions_holder</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_variable: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;entity-decl&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_variable: Empty elements &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot;&#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_constants"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_constants">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_constants</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements between the</span>
<span class="sd">        constants elements.</span>

<span class="sd">        &lt;constants&gt;</span>
<span class="sd">        &lt;/constants&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="n">cur_elem</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;is_array&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_array</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;parameter-stmt&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_constant: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_constant"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_constant">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_constant</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements between the</span>
<span class="sd">        constants elements.</span>

<span class="sd">        &lt;constant&gt;</span>
<span class="sd">        &lt;/constant&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Store all declared variables based on their array status</span>
        <span class="k">if</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">declared_non_array_vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span><span class="p">}</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_constant: Empty elements &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; &#39;</span> \
                   <span class="sa">f</span><span class="s1">&#39;not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_statement"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_statement">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_statement</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the statement elements.</span>

<span class="sd">        &lt;statement&gt;</span>
<span class="sd">        &lt;/statement&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">traverse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;body-level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_level</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">statement_child_tags</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_stop</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;has-stop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-remove&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>

                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span>
                    <span class="n">label_presented</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">lbl</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">encountered_goto_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">traverse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># Label-before case</span>
                        <span class="k">if</span> <span class="p">(</span>
                                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_after</span>
                                <span class="ow">or</span> <span class="n">lbl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_after</span>
                        <span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">goto_label_with_case</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;before&quot;</span>
                            <span class="c1"># Since we want to handle label_after case before</span>
                            <span class="c1"># label_before when both cases appear in the code,</span>
                            <span class="c1"># we ignore all label_before case until _after case</span>
                            <span class="c1"># get handled. Thus, mark label_before to false</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_after</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">if</span> <span class="n">lbl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>
                        <span class="c1"># Label-after case</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">goto_label_with_case</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;after&quot;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_goto</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_label</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">if</span> <span class="n">lbl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_after</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_after</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>

                        <span class="k">if</span> <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span>
                                <span class="ow">or</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span>
                        <span class="p">):</span>
                            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-remove&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target-label-statement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>

                        <span class="c1"># Since &lt;format&gt; is followed by &lt;label&gt;,</span>
                        <span class="c1"># check the case and undo all operations done for goto.</span>
                        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format&quot;</span> <span class="ow">and</span> <span class="n">label_presented</span><span class="p">:</span>
                            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="k">del</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target-label-statement&#39;</span><span class="p">]</span>
                            <span class="k">del</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="p">(</span>
                                <span class="n">traverse</span> <span class="o">&gt;</span> <span class="mi">1</span>
                        <span class="p">),</span> <span class="s2">&quot;In handle_tag_statement. Reconstruction must be &quot;</span> \
                           <span class="s2">&quot;done in traverse &gt; 1.&quot;</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collecting_stmts_done</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_after_case_now</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">collecting_stmts_done</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
                <span class="c1"># If a &#39;name&#39; tag is the direct sub-elements of &#39;statement&#39;,</span>
                <span class="c1"># it&#39;s an indication of this statement is handling</span>
                <span class="c1"># (usually assignment) derived type variables. Thus,</span>
                <span class="c1"># in order to make concurrent with other assignment syntax,</span>
                <span class="c1"># remove the outside name elements (but store it to the</span>
                <span class="c1"># temporary holder) and reconstruct it before the end of</span>
                <span class="c1"># statement</span>
                <span class="k">assert</span> <span class="n">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;goto-stmt&quot;</span><span class="p">:</span>
                <span class="c1"># self.goto_stmt_level = parent.attrib[&#39;parent&#39;]</span>

                <span class="c1"># &lt;goto-stmt&gt; met, increment the counter</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">goto_stmt_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># If goto-stmt was seen, we do not construct element for it.</span>
                <span class="c1"># However, we collect the information (attributes) that is</span>
                <span class="c1"># associated to the existing OFP generated element</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">need_goto_elimination</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">if_appear_before_goto</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">target_lbl</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target_label&#39;</span><span class="p">]</span>
                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-stmt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_lbl</span>
                <span class="n">_</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="c1"># Reaching goto-stmt is a flag to stop collecting states</span>
                <span class="k">if</span> <span class="n">traverse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span>
                        <span class="ow">and</span> <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;else&quot;</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_else</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">encountered_goto_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_lbl</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_label</span><span class="p">:</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-remove&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;next-goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span>
                            <span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_label</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">collecting_stmts_done</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="c1"># A case where label appears &quot;before&quot; goto</span>
                    <span class="k">if</span> <span class="n">target_lbl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">goto_label_with_case</span><span class="p">[</span><span class="n">target_lbl</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;before&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span>
                            <span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_lbl</span><span class="p">)</span>
                    <span class="c1"># A case where label appears &quot;after&quot; goto</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">goto_label_with_case</span><span class="p">[</span><span class="n">target_lbl</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;after&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                        <span class="k">if</span> <span class="s2">&quot;parent-goto&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;skip-collect&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_after</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_lbl</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_goto</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">label_after</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">target_lbl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="p">(</span>
                                <span class="n">traverse</span> <span class="o">&gt;</span> <span class="mi">1</span>
                        <span class="p">),</span> <span class="s2">&quot;Reconstruction cannot happen in the first traverse&quot;</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_before_case_now</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_statement: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>

        <span class="c1"># Statement collector (1st traverse)</span>
        <span class="k">if</span> <span class="n">traverse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_after</span><span class="p">:</span>
                <span class="c1"># Since we do not want to extract the stop statement from</span>
                <span class="c1"># that is not a main body, check it before extraction</span>
                <span class="k">if</span> <span class="s2">&quot;has-stop&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span>
                        <span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                            <span class="n">parent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span>
                            <span class="ow">and</span> <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;program&quot;</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span>
                            <span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_after</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_goto</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-remove&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                    <span class="k">if</span> <span class="s2">&quot;has-stop&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span>
                            <span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span>
                                <span class="n">parent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span>
                                <span class="ow">and</span> <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;program&quot;</span>
                        <span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span>
                                <span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>

                    <span class="k">if</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stmts_after_goto</span><span class="p">[</span><span class="s1">&#39;goto-stmts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="s2">&quot;target-label-statement&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stmts_after_goto</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_label</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-remove&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span>
                        <span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>

                    <span class="k">if</span> <span class="p">(</span>
                            <span class="p">(</span>
                                <span class="n">parent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span>
                                <span class="ow">and</span> <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;program&quot;</span>
                                <span class="ow">and</span> <span class="s2">&quot;has-stop&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span>
                            <span class="p">)</span>
                            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_loop</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_label</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_after_case_now</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_assignment"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_assignment">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_assignment</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the assignment elements.</span>

<span class="sd">        &lt;assignment&gt;</span>
<span class="sd">        &lt;/assignment&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;target&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_assignment: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_target"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_target">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_target</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the target elements.</span>

<span class="sd">        &lt;target&gt;</span>
<span class="sd">        &lt;/target&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_reconstruct</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_name_element</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_target: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_names"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_names">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_names</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the names elements.</span>

<span class="sd">        &lt;names&gt;</span>
<span class="sd">        &lt;names&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_interface</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">interface_functions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_interface_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">interface_function_xml</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_interface_name</span><span class="p">][</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">cur_elem</span>
                <span class="k">if</span> <span class="n">grandparent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">args_for_function</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
                <span class="c1"># If the element holds sub-elements, call the XML tree parser</span>
                <span class="c1"># with created new &lt;name&gt; element</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="c1"># Else, update the element&#39;s attribute</span>
                <span class="c1"># with the default &lt;name&gt; element attributes</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;hasSubscripts&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;is_array&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;numPartRef&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ambiguous&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="c1"># Check if the variable is a function argument</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_function_arg</span><span class="p">:</span>
                        <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;is_arg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;is_arg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
                    <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_names: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_name"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_name">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements between</span>
<span class="sd">        the name elements.</span>

<span class="sd">        &lt;name&gt;</span>
<span class="sd">        &lt;name&gt;</span>

<span class="sd">        There are three different types of names that the type attribute can</span>
<span class="sd">    hold:</span>
<span class="sd">            (1) variable  - Simple (single) variable or an array</span>
<span class="sd">            (2) procedure - Function (or procedure) call</span>
<span class="sd">            (3) ambiguous - None of the above two type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span>
            <span class="ow">and</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span>
        <span class="p">):</span>
            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>

        <span class="c1"># If &#39;id&#39; attribute holds &#39;%&#39; symbol, it&#39;s an indication of derived type</span>
        <span class="c1"># referencing. Thus, clean up the &#39;id&#39; and reconstruct the &lt;name&gt; AST.</span>
        <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">and</span> <span class="s2">&quot;%&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type_ref</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_derived_type_ref</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>

        <span class="c1"># Default attribute values</span>
        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;hasSubscripts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_arg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;numPartRef&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ambiguous&quot;</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subscripts&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;assignment&quot;</span>
                <span class="p">):</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subscripts&quot;</span><span class="p">:</span>
                        <span class="c1"># If current name is for caller arguments,</span>
                        <span class="c1"># mark the name of the function in the subscripts</span>
                        <span class="c1"># as an one of its attributes</span>
                        <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;call&quot;</span><span class="p">:</span>
                            <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;hasSubscripts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                        <span class="c1"># Check whether the variable is an array AND the</span>
                        <span class="c1"># variable is for the current scope. This is important</span>
                        <span class="c1"># for derived type variable referencing</span>
                        <span class="k">if</span> <span class="p">(</span>
                                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span>
                                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span><span class="p">[</span>
                                        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                                    <span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span>
                        <span class="p">):</span>
                            <span class="c1"># Since the procedure &quot;call&quot; has a same AST syntax</span>
                            <span class="c1"># as an array, check its type and set the &quot;is_array&quot;</span>
                            <span class="c1"># value</span>
                            <span class="k">assert</span> <span class="p">(</span>
                                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;procedure&quot;</span>
                            <span class="p">),</span> <span class="s2">&quot;Trying to assign a procedure call to while &quot;</span> \
                               <span class="s2">&quot;is_array true.&quot;</span>
                            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                        <span class="k">elif</span> <span class="p">(</span>
                                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                                <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_non_array_vars</span>
                                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_non_array_vars</span><span class="p">[</span>
                                        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                                    <span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span>
                                <span class="ow">and</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">character_var_list</span>
                        <span class="p">):</span>
                            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;hasSubscripts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">)</span>
                    <span class="p">),</span> <span class="s2">&quot;derived_type_var holder must be empty.&quot;</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In self.handle_tag_name: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;generic_spec&quot;</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;data-ref&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="kc">False</span>
                        <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In self.handle_tag_name: Empty elements &#39;</span> \
                           <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>

        <span class="c1"># If the name element is for handling</span>
        <span class="c1"># derived type references, reconstruct it</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_refs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_derived_type_names</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type_ref</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">need_reconstruct</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_value"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_value">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_value</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the value elements.</span>

<span class="sd">        &lt;value&gt;</span>
<span class="sd">        &lt;/value&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">function_call</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
                <span class="ow">and</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments_list</span>
            <span class="p">):</span>
                <span class="c1"># if &#39;id&#39; is in the arguments_list, it indicates that</span>
                <span class="c1"># the RHS of the assignment is a function call</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">call_function</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">function_call</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_child_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_value: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
            <span class="p">)</span>

            <span class="c1"># If current assignment is done with a function call,</span>
            <span class="c1"># then update function definition&#39;s arguments with array status</span>
            <span class="k">if</span> <span class="n">function_call</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_function_arguments</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_reconstruct</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_name_element</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_literal"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_literal">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_literal</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the literal elements.</span>

<span class="sd">        &lt;literal&gt;</span>
<span class="sd">        &lt;/literal&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_id</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">parent</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="kc">False</span>
                        <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_literal: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;data-stmt-constant&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_literal: Empty &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_dimensions"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_dimensions">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_dimensions</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the dimensions elements.</span>

<span class="sd">        &lt;dimensions&gt;</span>
<span class="sd">        &lt;/dimensions&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;dimension&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="kc">False</span>
                        <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_dimensions: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not &#39;</span> \
                           <span class="sa">f</span><span class="s1">&#39;handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_dimensions: Empty &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not &#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39;handled&#39;</span>

        <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dimensions_holder</span> <span class="o">=</span> <span class="n">current</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_dimension"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_dimension">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_dimension</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the dimension elements.</span>

<span class="sd">        &lt;dimension&gt;</span>
<span class="sd">        &lt;/dimension&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;range&quot;</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="kc">False</span>
                        <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_dimension: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_dimension: Empty &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not &#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39;handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_loop"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_loop">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_loop</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the do loop elements.</span>

<span class="sd">        &lt;loop&gt;</span>
<span class="sd">        &lt;/loop&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_child_tags</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">is_format</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">format_holder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                            <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                            <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In self.handle_tag_loop: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_index_variable_or_range"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_index_variable_or_range">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_index_variable_or_range</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the index_variable or range elements.</span>

<span class="sd">        &lt;index_variable&gt;          or        &lt;range&gt;</span>
<span class="sd">        &lt;/index_variable&gt;                   &lt;/range&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_range_child_tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_index_variable_or_range: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot;&#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39; not handled&#39;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">traverse</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_index_variable_or_range: Empty &#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_bound"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_bound">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_bound</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the upper_bound elements.</span>

<span class="sd">        &lt;upper_bound&gt;</span>
<span class="sd">        &lt;/upper_bound&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound_child_tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
                            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_reconstruct</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_name_element</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_upper_bound: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">traverse</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_upper_bound: Empty &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not &#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39;handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_subscripts"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_subscripts">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_subscripts</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the subscripts elements.</span>

<span class="sd">        &lt;subscripts&gt;</span>
<span class="sd">        &lt;/subscripts&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subscript&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In self.handle_tag_subscripts: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not &#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39;handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_subscript"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_subscript">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_subscript</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the subscript elements.</span>

<span class="sd">        &lt;subscript&gt;</span>
<span class="sd">        &lt;/subscript&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscripts_child_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In self.handle_tag_subscript: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not &#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39;handled&#39;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
                <span class="c1"># If current subscript is for a function caller and</span>
                <span class="c1"># current element (argument) is an array, then store</span>
                <span class="c1"># it into the caller_arr_arguments map for later use</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">call_function</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">cur_elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
                         <span class="ow">and</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="s2">&quot;fname&quot;</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">),</span> <span class="s2">&quot;If this subscript is for the caller argument,</span><span class="se">\</span>
<span class="s2">                            fname must exist in the parent&quot;</span>
                    <span class="n">fname</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">]</span>
                    <span class="n">arg</span> <span class="o">=</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller_arr_arguments</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">caller_arr_arguments</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">caller_arr_arguments</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">arg</span><span class="p">]</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_operation"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_operation">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_operation</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the operation elements.</span>

<span class="sd">        &lt;operation&gt;</span>
<span class="sd">        &lt;/operation&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="c1"># A process of negating the operator during goto elimination</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;operator&quot;</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_op_negation</span>
            <span class="p">):</span>
                <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;operator&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">syntax</span><span class="o">.</span><span class="n">NEGATED_OP</span><span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;operator&#39;</span><span class="p">]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">need_op_negation</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;operand&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="s2">&quot;operator&quot;</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_operation: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_operand"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_operand">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_operand</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the operation elements.</span>

<span class="sd">        &lt;operand&gt;</span>
<span class="sd">        &lt;/operand&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operand_child_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_operand: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_reconstruct</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_name_element</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_write"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_write">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_write</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the operation elements.</span>

<span class="sd">        &lt;operand&gt;</span>
<span class="sd">        &lt;/operand&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;io-controls&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;outputs&quot;</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_write: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_io_controls"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_io_controls">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_io_controls</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the io-controls elements.</span>

<span class="sd">        &lt;io-controls&gt;</span>
<span class="sd">        &lt;/io-controls&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;io-control&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_io_controls: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_io_control"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_io_control">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_io_control</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the io-control elements.</span>

<span class="sd">        &lt;io-control&gt;</span>
<span class="sd">        &lt;/io-control&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="c1"># To make io-control elements simpler, the code below</span>
            <span class="c1"># will append io-control-spec&#39;s attributes to its</span>
            <span class="c1"># parent (io-control). This will eliminate at least</span>
            <span class="c1"># one recursion in translate.py to retrieve</span>
            <span class="c1"># the io-control information</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;io-control-spec&quot;</span><span class="p">:</span>
                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;io-control&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span>
                                      <span class="n">traverse</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_io_control: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; &#39;</span> \
                                  <span class="sa">f</span><span class="s1">&#39;not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_io_control: Empty &quot;&#39;</span> \
                                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_outputs"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_outputs">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_outputs</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the outputs elements.</span>

<span class="sd">        &lt;outputs&gt;</span>
<span class="sd">        &lt;/outputs&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_outputs: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_output"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_output">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_output</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the output elements.</span>

<span class="sd">        &lt;output&gt;</span>
<span class="sd">        &lt;/output&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_child_tags</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_reconstruct</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_name_element</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_outputs: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_format"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_format">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_format</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the format elements.</span>

<span class="sd">        &lt;format&gt;</span>
<span class="sd">        &lt;/format&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format-items&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_format: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_format_items"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_format_items">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_format_items</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the format_items and its sub-elements</span>

<span class="sd">        &lt;format_items&gt;</span>
<span class="sd">        ____&lt;format_item&gt;</span>
<span class="sd">        ____&lt;/format_item&gt;</span>
<span class="sd">        &lt;/format_items&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format-items&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format-item&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_format_items: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_print"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_print">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_print</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the print tags.</span>

<span class="sd">        &lt;print&gt;</span>
<span class="sd">        &lt;/print&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="s2">&quot;print-stmt&quot;</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;outputs&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_print: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_open"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_open">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_open</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the open elements.</span>

<span class="sd">        &lt;open&gt;</span>
<span class="sd">        &lt;/open&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;keyword-arguments&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_open: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;open-stmt&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_open: Empty elements &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; &#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39;ot handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_keyword_arguments"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_keyword_arguments">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_keyword_arguments</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements between</span>
<span class="sd">        the keyword-arguments and keyword-argument elements.</span>

<span class="sd">        &lt;keyword-arguments&gt;</span>
<span class="sd">        ____&lt;keyword-argument&gt;</span>
<span class="sd">        ____&lt;/keyword-argument&gt;</span>
<span class="sd">        &lt;/keyword-arguments&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;keyword-argument&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span>
                <span class="p">):</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_keyword_arguments: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not &#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39;handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_keyword_arguments: Empty elements &#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_read"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_read">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_read</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the read elements.</span>

<span class="sd">        &lt;read&gt;</span>
<span class="sd">        &lt;/read&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;io-controls&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;inputs&quot;</span>
                <span class="p">):</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_read: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;read-stmt&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_read: Empty elements &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; &#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39;not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_inputs"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_inputs</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the inputs and input elements.</span>

<span class="sd">        &lt;inputs&gt;</span>
<span class="sd">        ____&lt;input&gt;</span>
<span class="sd">        ____&lt;/input&gt;</span>
<span class="sd">        &lt;/inputs&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
                <span class="p">):</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_input - </span><span class="si">{</span><span class="n">root</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not &#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39;handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_input - </span><span class="si">{</span><span class="n">root</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">: Empty elements &#39;</span> \
                   <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_close"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_close">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_close</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the close elements.</span>

<span class="sd">        &lt;close&gt;</span>
<span class="sd">        &lt;/close&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;keyword-arguments&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_close: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;close-stmt&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_close: Empty elements &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot;&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_call"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_call">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_call</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the call elements.</span>

<span class="sd">        &lt;call&gt;</span>
<span class="sd">        &lt;/call&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_function</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
                    <span class="c1"># fname: Function name</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_call: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;call-stmt&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_call: Empty elements &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot;&#39;</span>

        <span class="c1"># Update call function definition&#39;s arguments with array status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_function_arguments</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
        <span class="c1"># Update call function arguments with their types</span>
        <span class="n">update</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">arguments_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_call_argument_type</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span><span class="p">,</span> <span class="n">arguments_info</span><span class="p">)</span>
        <span class="c1"># If modules been used in the current program, check for interface functions</span>
        <span class="c1"># and replace function names, if necessary.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">used_modules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">replace_interface_function_to_target</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">arguments_info</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_subroutine"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_subroutine">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_subroutine</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the subroutine elements.</span>

<span class="sd">        &lt;subroutine&gt;</span>
<span class="sd">        &lt;/subroutine&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">argument_types</span><span class="p">[</span><span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;header&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">current_body_scope</span> <span class="o">=</span> <span class="n">cur_elem</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_subroutine: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_subroutine: Empty elements &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="c1"># Updating the argument attribute to hold the type.</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments_list</span><span class="p">[</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]:</span>
            <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">argument_types</span><span class="p">[</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]:</span>
                <span class="n">arg</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">argument_types</span><span class="p">[</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]][</span><span class="n">arg</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]])</span>

        <span class="c1"># Add extra XMLs under the interface function names to hold the argument types.</span>
        <span class="k">for</span> <span class="n">interface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_function_xml</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_function_xml</span><span class="p">[</span><span class="n">interface</span><span class="p">]:</span>
                <span class="n">argument_types</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">interface_function_xml</span><span class="p">[</span><span class="n">interface</span><span class="p">][</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]],</span>
                    <span class="s2">&quot;argument-types&quot;</span>
                <span class="p">)</span>
                <span class="n">num_args</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments_list</span><span class="p">[</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]:</span>
                    <span class="n">num_args</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">argument_type</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">argument_types</span><span class="p">,</span>
                        <span class="s2">&quot;argument-type&quot;</span><span class="p">,</span>
                        <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">arg</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]}</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interface_function_xml</span><span class="p">[</span><span class="n">interface</span><span class="p">][</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;num_args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_args</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_arguments"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_arguments">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_arguments</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the arguments.</span>

<span class="sd">        &lt;arguments&gt;</span>
<span class="sd">        &lt;/arguments&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_of_args</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_interface_member</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">grandparent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subroutine&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">interface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_functions</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                            <span class="n">grandparent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_functions</span><span class="p">[</span><span class="n">interface</span><span class="p">]</span>
                            <span class="ow">and</span> <span class="n">interface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_xml</span>
                    <span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span>
                                <span class="s2">&quot;max_arg&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_xml</span><span class="p">[</span><span class="n">interface</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span>
                                <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;max_arg&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_xml</span><span class="p">[</span><span class="n">interface</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span>
                                    <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interface_xml</span><span class="p">[</span><span class="n">interface</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;max_arg&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">num_of_args</span><span class="p">)</span>
                        <span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">interface_xml</span><span class="p">[</span><span class="n">interface</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;max_arg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_of_args</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Currently, </span><span class="si">{</span><span class="n">grandparent</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s2"> not handled for interface.&quot;</span>
                            
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;argument&quot;</span><span class="p">:</span>
                <span class="c1"># Collect the argument names with None as a initial type.</span>
                <span class="c1"># Types will be updated in handle_tag_variable.</span>
                <span class="k">if</span> <span class="n">grandparent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subroutine&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">argument_types</span><span class="p">[</span><span class="n">grandparent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]][</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="c1"># Set a default array status to False</span>
                <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_variable: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_argument"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_argument">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_argument</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements between the</span>
<span class="sd">        argument.</span>

<span class="sd">        &lt;argument&gt;</span>
<span class="sd">        &lt;/argument&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_if"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_if">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_if</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the if elements.</span>

<span class="sd">        &lt;if&gt;</span>
<span class="sd">        &lt;/if&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">traverse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;if-before-goto&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">if_appear_before_goto</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;header&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">traverse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># Check and hold conditional operation for &lt;goto-stmt&gt;</span>
                        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;header&quot;</span><span class="p">:</span>
                            <span class="n">condition</span> <span class="o">=</span> <span class="n">child</span>
                        <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s2">&quot;conditional-goto-stmt-lbl&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                                <span class="k">if</span> <span class="p">(</span>
                                    <span class="s2">&quot;type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                                    <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;else&quot;</span>
                                <span class="p">):</span>
                                    <span class="k">if</span> <span class="p">(</span>
                                        <span class="n">condition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                                        <span class="ow">and</span> <span class="s2">&quot;code&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span>
                                    <span class="p">):</span>
                                        <span class="n">unique_code</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">conditional_op</span><span class="p">[</span><span class="n">unique_code</span><span class="p">]</span> <span class="o">=</span> \
                                            <span class="n">condition</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_if: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;if-stmt&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span> <span class="ow">and</span> <span class="n">traverse</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_if: Empty elements &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; &#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39;not handled&#39;</span>

        <span class="c1"># If label appears before &lt;goto&gt;, mark &lt;if&gt;</span>
        <span class="c1"># with goto-move to move it later (1st traverse)</span>
        <span class="k">if</span> <span class="n">traverse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Since label_after needs to be reconstructed first,</span>
            <span class="c1"># we skip to collect the element if label_after is True</span>
            <span class="c1"># Then, once the reconstruction of label_after is done,</span>
            <span class="c1"># then we collect those reconstructed elements</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_after</span><span class="p">:</span>
                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span>
                    <span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_after</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_goto</span>
                    <span class="ow">and</span> <span class="s2">&quot;conditional-goto-stmt-lbl&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="ow">and</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;if-before-goto&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span>
                <span class="p">):</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-remove&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span>
                        <span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_label</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-remove&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span>
                        <span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_stop"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_stop">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_stop</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the stop elements</span>

<span class="sd">        &lt;stop&gt;</span>
<span class="sd">        &lt;/stop&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;stop-code&quot;</span><span class="p">:</span>
                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_stop: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_step"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_step">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_step</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the step elements.</span>

<span class="sd">        &lt;step&gt;</span>
<span class="sd">        &lt;/step&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;operation&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span>
                <span class="p">):</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_step: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_step: Empty elements &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; &#39;</span> \
                   <span class="sa">f</span><span class="s1">&#39;not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_return"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_return">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_return</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the return and return-stmt elements.</span>
<span class="sd">        However, since &#39;return-stmt&#39; is an empty elements</span>
<span class="sd">        with no sub-elements, the function will not keep</span>
<span class="sd">        the elements, but move the attribute to its parent</span>
<span class="sd">        elements, return.</span>

<span class="sd">        &lt;return&gt;</span>
<span class="sd">        &lt;/return&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;return-stmt&quot;</span><span class="p">:</span>
                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_return: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_function"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_function">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_function</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the function elements.</span>

<span class="sd">        &lt;function&gt;</span>
<span class="sd">        &lt;/function&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;header&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;header&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">is_function_arg</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">current_body_scope</span> <span class="o">=</span> <span class="n">cur_elem</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_function: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;function-stmt&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;end-function-stmt&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;function-subprogram&quot;</span>
                <span class="p">):</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_function: Empty elements &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot;&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_use"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_use">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_use</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the use elements.</span>

<span class="sd">        &lt;use&gt;</span>
<span class="sd">        &lt;/use&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_log_file_path</span><span class="p">)</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Module log file path must exist.&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_log_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_f</span><span class="p">:</span>
            <span class="n">module_logs</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_f</span><span class="p">)</span>

        <span class="n">file_to_mod_mapper</span> <span class="o">=</span> <span class="n">module_logs</span><span class="p">[</span><span class="s2">&quot;file_to_mod&quot;</span><span class="p">]</span>
        <span class="n">mod_to_file_mapper</span> <span class="o">=</span> <span class="n">module_logs</span><span class="p">[</span><span class="s2">&quot;mod_to_file&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module_summary</span> <span class="o">=</span> <span class="n">module_logs</span><span class="p">[</span><span class="s2">&quot;mod_info&quot;</span><span class="p">]</span>

        <span class="n">use_module</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">used_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">use_module</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">use_module</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">mod_to_file_mapper</span><span class="p">:</span>
            <span class="n">use_module_file_path</span> <span class="o">=</span> <span class="n">mod_to_file_mapper</span><span class="p">[</span><span class="n">use_module</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">use_module_file_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">original_fortran_file_abs_path</span>
                    <span class="ow">and</span> <span class="n">use_module</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules_in_file</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module_files_to_process</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">use_module_file_path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If module resides in the same file, we don&#39;t have to do</span>
                <span class="c1"># anything. Handling for this case is already implemented in</span>
                <span class="c1"># genPGM.py</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;use-stmt&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;only&quot;</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_use: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_module"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_module">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_module</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the module elements.</span>

<span class="sd">        &lt;module&gt;</span>
<span class="sd">        &lt;/module&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_child_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_module: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>

            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules_in_file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_initial_value"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_initial_value">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_initial_value</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the initial-value elements.</span>

<span class="sd">        &lt;initial-value&gt;</span>
<span class="sd">        &lt;/initial-value&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;operation&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_initial_value: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;initialization&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_initial_value: Empty elements &#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot;&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_members"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_members">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_members</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparnet</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the members elements.</span>

<span class="sd">        &lt;members&gt;   or    &lt;member&gt;</span>
<span class="sd">        &lt;/members&gt;        &lt;/member&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_interface_member</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">members_child_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_members: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>

            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
        <span class="c1"># Re-initialize to false when exiting members</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_interface_member</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_only"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_only">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_only</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the only elements.</span>

<span class="sd">        &lt;only&gt;</span>
<span class="sd">        &lt;/only&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">only_child_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_only: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>

            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_length"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_length">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_length</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the length elements.</span>

<span class="sd">        &lt;length&gt;</span>
<span class="sd">        &lt;/length&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;literal&quot;</span><span class="p">,</span> <span class="s2">&quot;char-length&quot;</span><span class="p">,</span> <span class="s2">&quot;type-param-value&quot;</span><span class="p">]:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_length: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_interface"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_interface">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_interface</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles rectifying the elements between</span>
<span class="sd">        interface tag.</span>

<span class="sd">        &lt;interface&gt;</span>
<span class="sd">        &lt;/interface&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_interface</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;header&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_length: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">interface_xml</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_interface_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">current</span>
        <span class="c1"># Re-initializing for next interface use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_interface_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_interface</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_select"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_select">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_select</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the select elements.</span>

<span class="sd">        &lt;select&gt;</span>
<span class="sd">        &lt;/select&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_child_tags</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_length: &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; not handled&#39;</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_select: Empty elements &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot;&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_case"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_case">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_case</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the case elements.</span>

<span class="sd">        &lt;case&gt;</span>
<span class="sd">        &lt;/case&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_child_tags</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_case: Empty elements &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot;&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_value_ranges"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_value_ranges">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_value_ranges</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the value-ranges elements.</span>

<span class="sd">        &lt;value-ranges&gt;</span>
<span class="sd">        &lt;/value-ranges&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;value-range&quot;</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_value_ranges: Empty eleme&#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39;nts &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot;&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_value_range"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_value_range">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_value_range</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the value-range elements.</span>

<span class="sd">        &lt;value-range&gt;</span>
<span class="sd">        &lt;/value-range&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_value_range: Empty elements &#39;</span> \
                       <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot;&#39;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_tag_values"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_tag_values">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_values</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles cleaning up the XML elements</span>
<span class="sd">        between the values elements.</span>

<span class="sd">        &lt;values&gt;</span>
<span class="sd">        &lt;/values&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;In handle_tag_values: Empty elements &quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot;&#39;</span>

        <span class="c1"># For DATA statements, further indentation might be required</span>
        <span class="n">target_child</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">delete_child</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">current</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">target_child</span> <span class="o">=</span> <span class="n">child</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">target_child</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="n">delete_child</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">delete_child</span><span class="p">:</span>
            <span class="n">current</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">child</span><span class="p">)</span></div>

    <span class="c1">#################################################################</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#                       XML TAG PARSER                          #</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#################################################################</span>

<div class="viewcode-block" id="RectifiedXMLGenerator.parseXMLTree"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.parseXMLTree">[docs]</a>    <span class="k">def</span> <span class="nf">parseXMLTree</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Recursively traverse through the nested XML AST tree and</span>
<span class="sd">        calls appropriate tag handler, which will generate</span>
<span class="sd">        a cleaned version of XML tree for translate.py.</span>
<span class="sd">        Any new tags handlers must be added under this this function.</span>

<span class="sd">        parseXMLTree</span>

<span class="sd">        Arguments:</span>
<span class="sd">            root: The current root of the tree.</span>
<span class="sd">            current: Current element.</span>
<span class="sd">            parent: Parent element of the current.</span>
<span class="sd">            grandparent: A parent of parent statement of current.</span>
<span class="sd">            traverse: Keeps the track of number of traverse time.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_file</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;program&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_program</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                    <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;header&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_header</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;specification&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_specification</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                          <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_body</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;declaration&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_declaration</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                        <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_type</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;variables&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_variables</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                      <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_variable</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                     <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;statement&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_statement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                      <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;assignment&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_assignment</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                       <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;target&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_target</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_value</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;names&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_names</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_name</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_literal</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                    <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_dimensions</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                       <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;dimension&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_dimension</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                      <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_loop</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;index-variable&quot;</span> <span class="ow">or</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;range&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_index_variable_or_range</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span>
                                                    <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;lower-bound&quot;</span> <span class="ow">or</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;upper-bound&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_bound</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subscripts&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_subscripts</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                       <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subscript&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_subscript</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                      <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;operation&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_operation</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                      <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;operand&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_operand</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                    <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;write&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_write</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;io-controls&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_io_controls</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                        <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;io-control&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_io_control</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                       <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;outputs&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_outputs</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                    <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_output</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_format</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format-items&quot;</span> <span class="ow">or</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format-item&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_format_items</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                         <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;print&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_print</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;open&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_open</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;keyword-arguments&quot;</span> <span class="ow">or</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;keyword-argument&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_keyword_arguments</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span>
                                              <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;read&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_read</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;inputs&quot;</span> <span class="ow">or</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_inputs</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;close&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_close</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;call&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_call</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subroutine&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_subroutine</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                       <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;arguments&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_arguments</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                      <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;if&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_if</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_stop</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_step</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;return&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_return</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_function</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                     <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;use&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_use</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;module&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_module</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;initial-value&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_initial_value</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                          <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;members&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_members</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                    <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;only&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_only</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;length&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_length</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;saved-entity&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_saved_entity</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                         <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;save-stmt&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_save_statement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                           <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;constants&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_constants</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                      <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_constant</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                     <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;argument&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_argument</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                     <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;interface&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_interface</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                    <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;select&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_select</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                   <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;case&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_case</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                 <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;value-ranges&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_value_ranges</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                         <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;value-range&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_value_range</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                        <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;values&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_values</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="kc">False</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;In parseXMLTree: &lt;</span><span class="si">{</span><span class="n">root</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s2">&gt; passed from &lt;</span><span class="si">{</span><span class="n">parent</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s2">&gt; &quot;</span> \
               <span class="sa">f</span><span class="s2">&quot;not supported&quot;</span></div>

    <span class="c1">#################################################################</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#                       RECONSTRUCTORS                          #</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#################################################################</span>

<div class="viewcode-block" id="RectifiedXMLGenerator.reconstruct_derived_type_declaration"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.reconstruct_derived_type_declaration">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_derived_type_declaration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function reconstructs the derived type</span>
<span class="sd">        with the collected derived type declaration</span>
<span class="sd">        elements in the handle_tag_declaration and</span>
<span class="sd">        handle_tag_type.</span>

<span class="sd">        Args:</span>
<span class="sd">            None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">is_dimension</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Since component-decl-list appears after component-decl,</span>
            <span class="c1"># the program needs to iterate the list once first to</span>
            <span class="c1"># pre-collect the variable counts.</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-decl-list&quot;</span><span class="p">:</span>
                    <span class="n">counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">])</span>

            <span class="c1"># Initialize count to 0 for &lt;variables&gt; count attribute.</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># &#39;component-decl-list__begin&#39; tag is an indication</span>
            <span class="c1"># of all the derived type member variable</span>
            <span class="c1"># declarations will follow.</span>
            <span class="n">derived_type</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_type</span><span class="p">,</span> <span class="s2">&quot;derived-types&quot;</span><span class="p">)</span>
            <span class="n">literal_value</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">str_value</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;intrinsic-type-spec&quot;</span><span class="p">:</span>
                    <span class="n">keyword2</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;keyword2&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">keyword2</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">keyword2</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;keyword2&#39;</span><span class="p">]</span>
                    <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;hasKind&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;hasLength&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;keyword1&#39;</span><span class="p">],</span>
                        <span class="s2">&quot;is_derived_type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span><span class="p">),</span>
                        <span class="s2">&quot;keyword2&quot;</span><span class="p">:</span> <span class="n">keyword2</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="n">newType</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">derived_type</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">newType</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;character&quot;</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">literal_value</span> <span class="o">!=</span> <span class="kc">None</span>
                        <span class="p">),</span> <span class="s2">&quot;Literal value (String length) for character cannot be None.&quot;</span>
                        <span class="n">newType</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;string_length&quot;</span><span class="p">,</span> <span class="n">literal_value</span><span class="p">)</span>
                        <span class="n">literal_value</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Reset literal_value to None</span>
                <span class="k">elif</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;derived-type-spec&quot;</span><span class="p">:</span>
                    <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;hasKind&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;hasLength&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;typeName&#39;</span><span class="p">],</span>
                        <span class="s2">&quot;is_derived_type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span><span class="p">),</span>
                        <span class="s2">&quot;keyword2&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="n">newType</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">derived_type</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span>
                        <span class="ow">or</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
                <span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">elem</span>
                    <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
                        <span class="n">tag_name</span> <span class="o">=</span> <span class="s2">&quot;literal&quot;</span>
                        <span class="n">literal_value</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tag_name</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span>
                <span class="k">elif</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-array-spec&quot;</span><span class="p">:</span>
                    <span class="n">is_dimension</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">dim</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-decl-list__begin&quot;</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_dimension</span>

                <span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">count</span><span class="p">:</span>
                        <span class="n">attr</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">counts</span><span class="p">[</span><span class="n">count</span><span class="p">]}</span>
                        <span class="n">new_variables</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                            <span class="n">derived_type</span><span class="p">,</span> <span class="s2">&quot;variables&quot;</span><span class="p">,</span> <span class="n">attr</span>
                        <span class="p">)</span>  <span class="c1"># &lt;variables _attribs_&gt;</span>
                        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;operation&quot;</span><span class="p">:</span>
                    <span class="n">str_value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">elem</span><span class="o">.</span><span class="n">iter</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;char-literal-constant&quot;</span><span class="p">:</span>
                            <span class="n">str_value</span> <span class="o">+=</span> <span class="n">op</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;str&#39;</span><span class="p">]</span>
                    <span class="n">str_value</span> <span class="o">=</span> <span class="n">str_value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-decl&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimension</span><span class="p">:</span>
                        <span class="n">var_attribs</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;has_initial_value&quot;</span><span class="p">:</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span>
                                <span class="s2">&quot;hasComponentInitialization&quot;</span>
                            <span class="p">],</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                            <span class="s2">&quot;is_array&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                        <span class="c1"># Store variable name in the non array tracker</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">declared_non_array_vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                            <span class="p">{</span><span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span><span class="p">}</span>
                        <span class="p">)</span>
                        <span class="n">new_variable</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                            <span class="n">new_variables</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="n">var_attribs</span>
                        <span class="p">)</span>  <span class="c1"># &lt;variable _attribs_&gt;</span>
                        <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;hasComponentInitialization&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                            <span class="n">init_value_attrib</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                                <span class="n">new_variable</span><span class="p">,</span> <span class="s2">&quot;initial-value&quot;</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="n">str_value</span><span class="p">:</span>
                                <span class="n">value</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">str_value</span>
                                <span class="n">str_value</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">new_size</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                                <span class="n">init_value_attrib</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">attrib</span>
                            <span class="p">)</span>  <span class="c1"># &lt;initial-value _attribs_&gt;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">total_number_of_arrays</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_type_array_dimensions</span><span class="p">)</span>
                        <span class="n">new_dimensions</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                            <span class="n">derived_type</span><span class="p">,</span> <span class="s2">&quot;dimensions&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">}</span>
                        <span class="p">)</span>  <span class="c1"># &lt;dimensions count=&quot;1&quot;&gt;</span>

                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_array_dimensions</span><span class="p">[</span><span class="n">dim</span><span class="p">]:</span>
                            <span class="n">new_dimension</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                                <span class="n">new_dimensions</span><span class="p">,</span> <span class="s2">&quot;dimension&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;simple&quot;</span><span class="p">}</span>
                            <span class="p">)</span>  <span class="c1"># &lt;dimension type=&quot;simple&quot;&gt;</span>
                            <span class="n">has_lower_bound</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="n">new_range</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_dimension</span><span class="p">,</span> <span class="s2">&quot;range&quot;</span><span class="p">)</span>
                            <span class="n">num_of_dimensions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_type_array_dimensions</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
                            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_of_dimensions</span><span class="p">):</span>
                                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_array_dimensions</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="n">s</span><span class="p">]</span>
                                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
                                    <span class="n">tag_name</span> <span class="o">=</span> <span class="s2">&quot;literal&quot;</span>
                                <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
                                    <span class="n">tag_name</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span>
                                    <span class="n">value</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;is_derived_type_ref&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">pass</span>

                                <span class="n">need_new_dimension</span> <span class="o">=</span> <span class="kc">False</span> 
                                <span class="n">need_upper_bound</span> <span class="o">=</span> <span class="kc">False</span>
                                <span class="k">if</span> <span class="p">(</span>
                                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_type_array_dimensions</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
                                        <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">has_lower_bound</span> 
                                            <span class="ow">and</span> <span class="p">((</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_type_array_dimensions</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
                                            <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;dim-number&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_array_dimensions</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;dim-number&quot;</span><span class="p">]))</span>
                                <span class="p">):</span>
                                    <span class="k">if</span> <span class="p">(</span>
                                            <span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_type_array_dimensions</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
                                            <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;dim-number&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_array_dimensions</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;dim-number&quot;</span><span class="p">]</span>
                                    <span class="p">):</span>
                                        <span class="n">need_new_dimension</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="n">upper_bound_value</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                                    <span class="n">upper_bound_tag_name</span> <span class="o">=</span> <span class="n">tag_name</span>
                                    <span class="n">tag_name</span> <span class="o">=</span> <span class="s2">&quot;literal&quot;</span>
                                    <span class="n">value</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;literal&quot;</span>
                                    <span class="n">value</span><span class="o">.</span><span class="n">attrib</span> <span class="o">=</span> <span class="p">{</span>
                                            <span class="s2">&quot;dim-number&quot;</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;dim-number&quot;</span><span class="p">],</span>
                                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span>
                                    <span class="p">}</span>
                                    <span class="n">need_upper_bound</span> <span class="o">=</span> <span class="kc">True</span>

                                <span class="k">if</span> <span class="ow">not</span> <span class="n">has_lower_bound</span><span class="p">:</span>
                                    <span class="n">bound</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_range</span><span class="p">,</span> <span class="s2">&quot;lower-bound&quot;</span><span class="p">)</span>
                                    <span class="n">has_lower_bound</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">bound</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_range</span><span class="p">,</span> <span class="s2">&quot;upper-bound&quot;</span><span class="p">)</span>
                                    <span class="n">has_lower_bound</span> <span class="o">=</span> <span class="kc">False</span>

                                <span class="n">new_range_value</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">bound</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>

                                <span class="k">if</span> <span class="n">need_upper_bound</span><span class="p">:</span>
                                    <span class="n">bound</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_range</span><span class="p">,</span> <span class="s2">&quot;upper-bound&quot;</span><span class="p">)</span>
                                    <span class="n">new_range_value</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">bound</span><span class="p">,</span> <span class="n">upper_bound_tag_name</span><span class="p">,</span> <span class="n">upper_bound_value</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                                    <span class="n">has_lower_bound</span> <span class="o">=</span> <span class="kc">False</span>

                                <span class="k">if</span> <span class="n">need_new_dimension</span><span class="p">:</span>
                                    <span class="n">new_dimension</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                                        <span class="n">new_dimensions</span><span class="p">,</span> <span class="s2">&quot;dimension&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;simple&quot;</span><span class="p">}</span>
                                    <span class="p">)</span>  <span class="c1"># &lt;dimension type=&quot;simple&quot;&gt;</span>
                                    <span class="n">new_range</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_dimension</span><span class="p">,</span> <span class="s2">&quot;range&quot;</span><span class="p">)</span>
                                    <span class="n">need_new_dimension</span> <span class="o">=</span> <span class="kc">False</span>

                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">count</span><span class="p">:</span>
                            <span class="n">attr</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">counts</span><span class="p">[</span><span class="n">count</span><span class="p">]}</span>
                            <span class="n">new_variables</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                                <span class="n">derived_type</span><span class="p">,</span> <span class="s2">&quot;variables&quot;</span><span class="p">,</span> <span class="n">attr</span>
                            <span class="p">)</span>
                            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">var_attribs</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;has_initial_value&quot;</span><span class="p">:</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span>
                                <span class="s2">&quot;hasComponentInitialization&quot;</span>
                            <span class="p">],</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                            <span class="s2">&quot;is_array&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                        <span class="c1"># Store variable name in the array tracker</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                            <span class="p">{</span><span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span><span class="p">}</span>
                        <span class="p">)</span>
                        <span class="n">new_variable</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                            <span class="n">new_variables</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="n">var_attribs</span>
                        <span class="p">)</span>
                        <span class="n">is_dimension</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Once one derived type was successfully constructed,</span>
            <span class="c1"># clear all the elements of a derived type list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.reconstruct_derived_type_ref"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.reconstruct_derived_type_ref">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_derived_type_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function reconstruct the id into x.y.k form</span>
<span class="sd">        from the messy looking id. One thing to notice is</span>
<span class="sd">        that this new form was generated in the python syntax,</span>
<span class="sd">        so it is a pre-process for translate.py and</span>
<span class="sd">        even pyTranslate.py that</span>

<span class="sd">        Args:</span>
<span class="sd">            current (:obj: &#39;ET&#39;): Current element object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
                <span class="n">current</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;The tag &lt;name&gt; must be passed to reconstruct_derived_type_ref.</span><span class="se">\</span>
<span class="s2">             Currently, it&#39;s </span><span class="si">{</span><span class="n">current</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="c1"># First the root &lt;name&gt; id gets the very first</span>
        <span class="c1"># variable reference i.e. x in x.y.k (or x%y%k in Fortran syntax)</span>
        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span><span class="p">[</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span>
                <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span>
        <span class="p">):</span>
            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;hasSubscripts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;hasSubscripts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>

        <span class="n">number_of_vars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">)</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">parent_ref</span> <span class="o">=</span> <span class="n">current</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_refs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent_ref</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_vars</span><span class="p">):</span>
            <span class="n">variable_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
            <span class="n">attributes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variable_name</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">variable_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>
                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span>
            <span class="p">):</span>
                <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;hasSubscripts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
            <span class="c1"># Create N (number_of_vars) number of new subElement</span>
            <span class="c1"># under the root &lt;name&gt; for each referencing variable</span>
            <span class="n">reference_var</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">parent_ref</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">attributes</span>
            <span class="p">)</span>
            <span class="n">parent_ref</span> <span class="o">=</span> <span class="n">reference_var</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_refs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent_ref</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Clean up the list for re-use</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.reconstruct_format"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.reconstruct_format">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function is for reconstructing the &lt;format&gt;</span>
<span class="sd">        under the &lt;statement&gt; element.</span>

<span class="sd">        The OFP XML nests formats under:</span>
<span class="sd">            (1) statement</span>
<span class="sd">            (2) declaration</span>
<span class="sd">            (3) loop</span>

<span class="sd">        tags, which are wrong except one that is declared</span>
<span class="sd">        under the statement. Therefore, those formats</span>
<span class="sd">        declared under (2) and (3) will be extracted</span>
<span class="sd">        and reconstructed to be nested under (1)</span>
<span class="sd">        in this function.</span>

<span class="sd">        Args:</span>
<span class="sd">            grandparent (:obj: &#39;ET&#39;): Grand parent element object.</span>
<span class="sd">            traverse (int): Current traverse number.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">root_scope</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_body_scope</span><span class="p">,</span> <span class="s2">&quot;statement&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_holder</span><span class="p">:</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root_scope</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                <span class="n">form</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">root_scope</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.reconstruct_derived_type_names"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.reconstruct_derived_type_names">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_derived_type_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function reconstructs derived type</span>
<span class="sd">        reference syntax tree. However, this functions is</span>
<span class="sd">        actually a preprocessor for the real final reconstruction.</span>

<span class="sd">        Args:</span>
<span class="sd">            current (:obj: &#39;ET&#39;): Current element object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Update reconstruced derived type references</span>
        <span class="k">assert</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type_ref</span> <span class="o">==</span> <span class="kc">True</span>
        <span class="p">),</span> <span class="s2">&quot;&#39;self.is_derived_type_ref&#39; must be true&quot;</span>
        <span class="n">numPartRef</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;numPartRef&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_type_refs</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_refs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;numPartRef&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">numPartRef</span><span class="p">)}</span>
            <span class="p">)</span>
        <span class="c1"># Re-initialize to original values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_refs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.reconstruct_name_element"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.reconstruct_name_element">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_name_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function performs a final reconstruction of</span>
<span class="sd">        derived type name element that was preprocessed by</span>
<span class="sd">        &#39;reconstruct_derived_type_names&#39; function.</span>
<span class="sd">        This function traverses the preprocessed name element</span>
<span class="sd">        (including sub-elements) and split &amp; store &lt;name&gt; and</span>
<span class="sd">        &lt;subscripts&gt; into separate lists. Then, it comibines</span>
<span class="sd">        and reconstructs two lists appropriately.</span>

<span class="sd">        Args:</span>
<span class="sd">            cur_elem (:obj: &#39;ET&#39;): Newly generated element</span>
<span class="sd">            for current element object.</span>
<span class="sd">            current (:obj: &#39;ET&#39;): Current element object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">cur_elem</span><span class="p">]</span>
        <span class="c1"># Remove the original &lt;name&gt; elements.</span>
        <span class="n">current</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">)</span>
        <span class="c1"># Split &amp; Store &lt;name&gt; element and &lt;subscripts&gt;.</span>
        <span class="n">subscripts_holder</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">cur_elem</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subscripts&quot;</span><span class="p">:</span>
                <span class="n">subscripts_holder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">third</span> <span class="ow">in</span> <span class="n">child</span><span class="p">:</span>
                    <span class="n">name_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">third</span><span class="p">)</span>

        <span class="c1"># Combine &amp; Reconstruct &lt;name&gt; element.</span>
        <span class="n">subscript_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
            <span class="n">current</span><span class="p">,</span> <span class="n">name_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">name_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span>
        <span class="p">)</span>
        <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_derived_type_ref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
        <span class="k">if</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;hasSubscripts&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
            <span class="n">cur_elem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subscripts_holder</span><span class="p">[</span><span class="n">subscript_num</span><span class="p">])</span>
            <span class="n">subscript_num</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">numPartRef</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;numPartRef&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">name_element</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_elements</span><span class="p">)):</span>
            <span class="n">name_elements</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;numPartRef&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">numPartRef</span><span class="p">)</span>
            <span class="n">numPartRef</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">name_element</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">cur_elem</span><span class="p">,</span> <span class="n">name_elements</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">name_elements</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="n">name_element</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_derived_type_ref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
            <span class="c1"># In order to handle the nested subelements of &lt;name&gt;,</span>
            <span class="c1"># update the cur_elem at each iteration.</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">name_element</span>
            <span class="k">if</span> <span class="n">name_elements</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;hasSubscripts&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                <span class="n">name_element</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subscripts_holder</span><span class="p">[</span><span class="n">subscript_num</span><span class="p">])</span>
                <span class="n">subscript_num</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Clean out the lists for recyling.</span>
        <span class="c1"># This is not really needed as they are local lists,</span>
        <span class="c1"># but just in case.</span>
        <span class="n">name_elements</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">subscripts_holder</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">need_reconstruct</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.reconstruct_goto_after_label"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.reconstruct_goto_after_label">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_goto_after_label</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span> <span class="n">reconstruct_target</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function gets called when goto appears</span>
<span class="sd">        after the corresponding label and all necessary</span>
<span class="sd">        statements are collected for the reconstruction.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent (:obj: &#39;ET&#39;): A parent ET object that current</span>
<span class="sd">            element will be nested under.</span>
<span class="sd">            header (list): A header tht holds conditional header.</span>
<span class="sd">            traverse (int): A traverse counter.</span>
<span class="sd">            reconstruct_target (dict): A dictionary that holds statements</span>
<span class="sd">            for goto and label as well as the number of goto counter.</span>

<span class="sd">        Return:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">number_of_gotos</span> <span class="o">=</span> <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span>
        <span class="n">stmts_follow_goto</span> <span class="o">=</span> <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">]</span>
        <span class="n">stmts_follow_label</span> <span class="o">=</span> <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span>

        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_conditional_goto</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">stmts_follow_goto</span><span class="p">)</span>

        <span class="c1"># Corrent boundaries of gotos in case of a multiple</span>
        <span class="c1"># nested gotos.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_boundary_corrector</span><span class="p">(</span>
                <span class="n">reconstruct_target</span><span class="p">,</span> <span class="n">stmts_follow_goto</span><span class="p">,</span>
                <span class="n">stmts_follow_label</span>
        <span class="p">)</span>

        <span class="c1"># Check for the case where goto and label are</span>
        <span class="c1"># at different lexical levels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_in_outward_movement</span><span class="p">(</span><span class="n">stmts_follow_goto</span><span class="p">,</span> <span class="n">stmts_follow_label</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditional_goto</span><span class="p">:</span>
            <span class="n">declared_goto_flag_num</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_declaration_element</span><span class="p">(</span>
                <span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;goto_flag&quot;</span><span class="p">,</span> <span class="n">number_of_gotos</span><span class="p">,</span>
                <span class="n">declared_goto_flag_num</span><span class="p">,</span> <span class="n">traverse</span>
            <span class="p">)</span>

        <span class="c1"># This variable is for storing goto that may appear</span>
        <span class="c1"># at the end of if because we want to extract one </span>
        <span class="c1"># scope out and place it right after</span>
        <span class="c1"># the constructed if-statement</span>
        <span class="n">next_goto</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">reconstructed_goto_elem</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_gotos</span><span class="p">):</span>
            <span class="c1"># Constructor for statements if and statements nested</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_stmts_follow_goto_after_case</span><span class="p">(</span>
                    <span class="n">header</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">stmts_follow_goto</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">,</span>
                    <span class="n">traverse</span><span class="p">,</span> <span class="n">reconstructed_goto_elem</span><span class="p">,</span> <span class="n">i</span>
            <span class="p">)</span>
            <span class="c1"># Constructor for statements with L_i:stmt_n</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_stmts_follow_label_after_case</span><span class="p">(</span>
                        <span class="n">stmts_follow_label</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">,</span> <span class="n">reconstructed_goto_elem</span><span class="p">,</span>
                        <span class="n">header</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">i</span>
            <span class="p">)</span>
            <span class="c1"># When unconditional goto, it generates &#39;goto_flag_i = False&#39;</span>
            <span class="c1"># statement at the end of reconstrcted goto statement.</span>
            <span class="c1"># Else, nothing gets printed, but set self.conditional_goto to False</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditional_goto</span><span class="p">:</span>
                <span class="n">statement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;statement&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generate_assignment_element</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> \
                        <span class="sa">f</span><span class="s2">&quot;goto_flag_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;literal&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
                <span class="n">reconstructed_goto_elem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conditional_goto</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reconstructed_goto_elem</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">stmts_follow_label</span> <span class="o">=</span> <span class="n">reconstructed_goto_elem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">encapsulate_under_do_while</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># next_goto holds another goto after the current label_after</span>
            <span class="c1"># case label, which will encapsulate reconstrcted goto element</span>
            <span class="k">if</span> <span class="n">next_goto</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_next_goto</span><span class="p">(</span><span class="n">next_goto</span><span class="p">,</span> <span class="n">reconstructed_goto_elem</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="c1"># Set all holders and checkers (markers) to default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_after</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_if</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_after_case_now</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruction_for_after_done</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_after</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_after</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.reconstruct_goto_before_label"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.reconstruct_goto_before_label">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_goto_before_label</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span> <span class="n">reconstruct_target</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function gets called when goto appears</span>
<span class="sd">        before the corresponding label and all necessary</span>
<span class="sd">        statements are collected for the reconstruction.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent (:obj: &#39;ET&#39;): A parent ET object that current</span>
<span class="sd">            element will be nested under.</span>
<span class="sd">            traverse (int): A traverse counter.</span>
<span class="sd">            reconstruct_target (dict): A dictionary that holds statements</span>
<span class="sd">            for goto and label as well as the number of goto counter.</span>

<span class="sd">        Return:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stmts_follow_label</span> <span class="o">=</span> <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span>
        <span class="n">number_of_gotos</span> <span class="o">=</span> <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span>

        <span class="c1"># This removes the statement that&#39;s a child statement of</span>
        <span class="c1"># if body being seprately re-added to the list.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_dup_stmt</span><span class="p">(</span><span class="n">stmts_follow_label</span><span class="p">)</span>

        <span class="c1"># Declare label flag for loop condition</span>
        <span class="n">declared_label_flag_num</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_declaration_element</span><span class="p">(</span>
            <span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;label_flag&quot;</span><span class="p">,</span> <span class="n">number_of_gotos</span><span class="p">,</span>
            <span class="n">declared_label_flag_num</span><span class="p">,</span> <span class="n">traverse</span>
        <span class="p">)</span>

        <span class="c1"># Find the boundary from label to goto.</span>
        <span class="c1"># Remove any statements that are not within the boundary.</span>
        <span class="n">goto_index_holder</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">target_label_lbl</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">statements_to_recover</span> <span class="o">=</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">boundary_identifier_for_backward_goto</span><span class="p">(</span>
                    <span class="n">stmts_follow_label</span><span class="p">,</span> <span class="n">goto_index_holder</span><span class="p">,</span>
                    <span class="n">number_of_gotos</span><span class="p">,</span> <span class="n">target_label_lbl</span>
            <span class="p">)</span>

        <span class="c1"># In case of multiple goto statements appears,</span>
        <span class="c1"># slice them into N number of list objects</span>
        <span class="c1"># The location of goto statement (inner to outer)</span>
        <span class="c1"># is represented by the increament of index</span>
        <span class="c1"># i.e. [0]: innermost, [N]: Outermost</span>
        <span class="n">multiple_goto_stmts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiple_goto_identifier</span><span class="p">(</span>
                <span class="n">goto_index_holder</span><span class="p">,</span> <span class="n">multiple_goto_stmts</span><span class="p">,</span>
                <span class="n">stmts_follow_label</span>
        <span class="p">)</span>

        <span class="c1"># Check whether there is nested label_after</span>
        <span class="c1"># case goto statements. Handles one case</span>
        <span class="c1"># at a time.</span>
        <span class="n">nested_gotos_exist</span> <span class="o">=</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">nested_forward_goto_identifier</span><span class="p">(</span><span class="n">multiple_goto_stmts</span><span class="p">)</span>

        <span class="c1"># Generate loop ast</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">construct_goto_loop</span><span class="p">(</span>
                <span class="n">parent</span><span class="p">,</span> <span class="n">reconstruct_target</span><span class="p">,</span>
                <span class="n">nested_gotos_exist</span><span class="p">,</span> <span class="n">multiple_goto_stmts</span><span class="p">,</span>
                <span class="n">number_of_gotos</span><span class="p">,</span> <span class="n">declared_label_flag_num</span><span class="p">,</span>
                <span class="n">traverse</span><span class="p">,</span> <span class="n">target_label_lbl</span><span class="p">)</span>

        <span class="c1"># Recover rest of the statements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statement_recovery</span><span class="p">(</span><span class="n">statements_to_recover</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>

        <span class="c1"># Set all holders and checkers (markers) to default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_before_case_now</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_for_before_done</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.reconstruct_header"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.reconstruct_header">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_header</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">temp_elem_holder</span><span class="p">,</span> <span class="n">parent</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function is for reconstructing the oddly</span>
<span class="sd">        generated header AST to have an uniform structure</span>
<span class="sd">        with other multiary type operation nested headers.</span>

<span class="sd">        Args:</span>
<span class="sd">            temp_elem_holder (list): A temporary holder that</span>
<span class="sd">            holds statements under header for swap.</span>
<span class="sd">                parent (:obj: &#39;ET&#39;): A parent ET object that current</span>

<span class="sd">        Return:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This operation is basically for switching</span>
        <span class="c1"># the location of operator and 2nd operand,</span>
        <span class="c1"># so the output syntax can have a common structure</span>
        <span class="c1"># with other operation AST</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">temp_elem_holder</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">temp_elem_holder</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span>

        <span class="c1"># First create &lt;operation&gt; element</span>
        <span class="c1"># Currently, only assume multiary reconstruction</span>
        <span class="n">operation</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;operation&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;multiary&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">temp_elem_holder</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span> <span class="ow">or</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
                <span class="n">operand</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="s2">&quot;operand&quot;</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;equiv-operand__equiv-op&quot;</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Tag must be &#39;equiv-operand__equiv-op&#39;. Current: </span><span class="si">{</span><span class="n">elem</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="n">operator</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">operation</span><span class="p">,</span> <span class="s2">&quot;operator&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;operator&quot;</span><span class="p">:</span><span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;equivOp&#39;</span><span class="p">]}</span>
                <span class="p">)</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.goto_boundary_corrector"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.goto_boundary_corrector">[docs]</a>    <span class="k">def</span> <span class="nf">goto_boundary_corrector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reconstruct_target</span><span class="p">,</span> <span class="n">stmts_follow_goto</span><span class="p">,</span> <span class="n">stmts_follow_label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function is for correcting the boundaries of goto</span>
<span class="sd">        statements in case of a multiple gotos are nested and</span>
<span class="sd">        crossing each other.</span>

<span class="sd">        Args:</span>
<span class="sd">            reconstruct_target (dict): A dictionary that holds statements</span>
<span class="sd">            for goto and label as well as the number of goto counter.</span>
<span class="sd">            stmts_follow_goto (list): A list that holds statements</span>
<span class="sd">            after goto statement.</span>
<span class="sd">            stmts_follow_label (list): A list that holds statements</span>
<span class="sd">            after label statements.</span>

<span class="sd">        Return:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If [0] &lt;goto-stmt&gt; is an inner scope statement of the [N-1]</span>
        <span class="c1"># &lt;goto-stmt&gt;in the stmts_follow_goto, then we need to correct</span>
        <span class="c1"># the boundary issue by moving the [N-1] element to </span>
        <span class="c1"># the end of stmts_follow_label</span>
        <span class="n">last_stmt</span> <span class="o">=</span> <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">last_stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
            <span class="n">first_goto</span> <span class="o">=</span> <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">last_stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">first_goto</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent-goto&#39;</span><span class="p">]:</span>
                <span class="n">last_goto</span> <span class="o">=</span> <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">last_goto</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;next-goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                <span class="n">stmts_follow_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_goto</span><span class="p">)</span>

        <span class="n">goto_and_label_stmts_after_goto</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">stmts_follow_goto</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="n">goto_and_label_stmts_after_goto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="n">goto_and_label_stmts_after_goto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">])</span>

        <span class="n">num_of_goto_and_label_after_label</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">stmts_follow_label</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="ow">or</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">):</span>
                <span class="n">num_of_goto_and_label_after_label</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Since the first label-statement of</span>
                <span class="c1"># stmts_follow_label is always a match</span>
                <span class="c1"># for the first goto-statement in the</span>
                <span class="c1"># stmt_follow_goto in the label_after case,</span>
                <span class="c1"># remove the goto-move (label_before) case mark</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span>
                        <span class="ow">and</span> <span class="s2">&quot;goto-move&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">):</span>
                    <span class="k">del</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span>

        <span class="c1"># -2 disregarding the first and last statements</span>
        <span class="n">num_of_goto_and_label_after_label</span> <span class="o">-=</span> <span class="mi">2</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_of_goto_and_label_after_label</span><span class="p">):</span>
            <span class="n">stmt</span> <span class="o">=</span> <span class="n">stmts_follow_label</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">stmts_follow_goto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.reconstruct_stmts_follow_goto_after_case"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.reconstruct_stmts_follow_goto_after_case">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_stmts_follow_goto_after_case</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">stmts_follow_goto</span><span class="p">,</span>
            <span class="n">next_goto</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span> <span class="n">reconstructed_goto_elem</span><span class="p">,</span>
            <span class="n">index</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function generates a new if statement to</span>
<span class="sd">        nests statements that follow goto-stmt based on</span>
<span class="sd">        condition or non-condition status to eliminate</span>
<span class="sd">        goto.</span>

<span class="sd">        Args:</span>
<span class="sd">            next_goto (list): A list to hold next goto-stmt that may exist</span>
<span class="sd">            within the boundary of current goto.</span>
<span class="sd">            reconstructed_goto_elem (list): A list that will hold</span>
<span class="sd">            reconstructed if statements.</span>
<span class="sd">            header (list): A header tht holds conditional header.</span>
<span class="sd">            parent (:obj: &#39;ET&#39;): A parent ET object that current</span>
<span class="sd">            element will be nested under.</span>
<span class="sd">            stmts_follow_goto (list): A list that holds statements</span>
<span class="sd">            within the boundary of currently handling goto.</span>
<span class="sd">            traverse (int): A current traverse counter.</span>
<span class="sd">            index (int): An index of goto.</span>

<span class="sd">        Return:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditional_goto</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outward_move</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">inward_move</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">need_op_negation</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generate_if_element</span><span class="p">(</span>
                        <span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parent</span><span class="p">,</span> <span class="n">stmts_follow_goto</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span> <span class="n">reconstructed_goto_elem</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">outward_move</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">stmts_follow_goto</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;skip-collect&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                        <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span> <span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">stmt</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">stmt</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                <span class="p">),</span> <span class="s2">&quot;Currently inward movement for goto is not being handled.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_if_element</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">stmts_follow_goto</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;unary&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;goto_flag_</span><span class="si">{</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;.not.&quot;</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span>
                <span class="n">reconstructed_goto_elem</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">reconstructed_goto_elem</span><span class="p">:</span>
            <span class="n">stmts_follow_goto</span> <span class="o">=</span> <span class="n">reconstructed_goto_elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.handle_in_outward_movement"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.handle_in_outward_movement">[docs]</a>    <span class="k">def</span> <span class="nf">handle_in_outward_movement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmts_follow_goto</span><span class="p">,</span> <span class="n">stmts_follow_label</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function checks the lexical level of goto and label.</span>
<span class="sd">        Then, generate and add (remove) statements to the statement</span>
<span class="sd">        holders, so they can be handled appropriately.</span>

<span class="sd">        Args:</span>
<span class="sd">            stmts_follow_goto (list): It holds all the statements</span>
<span class="sd">            that appeared after the goto statement in the original</span>
<span class="sd">            code.</span>
<span class="sd">            stmts_follow_label (list): It holds all the statements</span>
<span class="sd">            that appeared after the label statement in the original</span>
<span class="sd">            code.</span>
<span class="sd">            parent (:obj: &#39;ET&#39;): A parent ET object that current</span>
<span class="sd">            element will be nested under.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">body_levels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">goto_stmt</span> <span class="ow">in</span> <span class="n">stmts_follow_goto</span><span class="p">:</span>
            <span class="c1"># If the statements are in different level,</span>
            <span class="c1"># we do not want to have them in the stmts_follow_goto,</span>
            <span class="c1"># so check such case and remove anything follow goto-stmt.</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outward_move</span>
                <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;generated-exit-stmt&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">goto_stmt</span><span class="o">.</span><span class="n">attrib</span>
                     <span class="ow">and</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">goto_stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">stmts_follow_goto</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">goto_stmt</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">goto_stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="n">lbl</span> <span class="o">=</span> <span class="n">goto_stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span>
                <span class="n">body_levels</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="n">goto_stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;body-level&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">label_stmt</span> <span class="ow">in</span> <span class="n">stmts_follow_label</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;target-label-statement&#39;</span> <span class="ow">in</span> <span class="n">label_stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="n">label_stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
                        <span class="n">label_body_level</span> <span class="o">=</span> <span class="n">label_stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;body-level&#39;</span><span class="p">]</span>
                        <span class="c1"># A goto-forward case where goto and label are</span>
                        <span class="c1"># located in different levels</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">label</span> <span class="ow">in</span> <span class="n">body_levels</span>
                            <span class="ow">and</span> <span class="n">body_levels</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">!=</span> <span class="n">label_body_level</span>
                        <span class="p">):</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_level_rank</span><span class="p">[</span><span class="n">label_body_level</span><span class="p">]</span>\
                                    <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_level_rank</span><span class="p">[</span><span class="n">body_levels</span><span class="p">[</span><span class="n">label</span><span class="p">]]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">outward_move</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="c1"># Since outward movement is simply adding exit (break) to</span>
                                <span class="c1"># the goto-stmt place, we have to create &lt;exit&gt; statement,</span>
                                <span class="c1"># then append it to the stmts_follo_goto</span>
                                <span class="n">statement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;statement&quot;</span><span class="p">)</span>
                                <span class="n">statement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;generated-exit-stmt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                                <span class="n">exit</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="s2">&quot;exit&quot;</span><span class="p">)</span>
                                <span class="n">stmts_follow_goto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
                                <span class="c1"># We need to remove it from the parent as it was just</span>
                                <span class="c1"># a place holder before append to the list</span>
                                <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>

                                <span class="k">if</span> <span class="n">label_body_level</span> <span class="o">!=</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_loop</span> <span class="o">=</span> <span class="kc">False</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_loop</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.reconstruct_next_goto"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.reconstruct_next_goto">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_next_goto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">,</span> <span class="n">reconstructed_goto_elem</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function reconstruct a goto statement that appears</span>
<span class="sd">        after the currently handling goto case. The default case</span>
<span class="sd">        is that the next goto is a backward goto case, which</span>
<span class="sd">        requires reconstruction by reconstruct_goto_before function.</span>
<span class="sd">        Thus, this function prepares the ingredient for it.</span>

<span class="sd">        Args:</span>
<span class="sd">            next_goto (list): Holds statement and goto-stmt elements.</span>
<span class="sd">            reconstructed_goto_elem (list): Holds reconstructed if statements</span>
<span class="sd">            that was generated after eliminating the goto.</span>
<span class="sd">            header (list): A header tht holds conditional header.</span>

<span class="sd">        Return:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">statement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
            <span class="n">parent</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
            <span class="n">next_goto</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span>
        <span class="p">)</span>
        <span class="n">goto_stmt</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
            <span class="n">statement</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;goto-stmt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
            <span class="n">next_goto</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;goto-stmt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">reconstructed_goto_elem</span>
            <span class="ow">and</span> <span class="n">reconstructed_goto_elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
                <span class="o">==</span> <span class="n">goto_stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target_label&#39;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">reconstructed_goto_elem</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_before_case_now</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reconstruction_for_before_done</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.check_conditional_goto"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.check_conditional_goto">[docs]</a>    <span class="k">def</span> <span class="nf">check_conditional_goto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">stmts_follow_goto</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function checks whether the goto is conditional</span>
<span class="sd">        or unconditional. If it&#39;s conditional, it extracts</span>
<span class="sd">        conditional operation (header).</span>

<span class="sd">        Args:</span>
<span class="sd">            header (list): A header tht holds conditional header.</span>
<span class="sd">            stmts_follow_goto (list): It holds all the statements</span>
<span class="sd">            that appeared after the goto statement in the original</span>
<span class="sd">            code.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check for the status whether current &lt;goto-stmt&gt; is</span>
        <span class="c1"># conditional. If yes, only extract the header (condition)</span>
        <span class="c1"># and remove the if statement AST from the tree. </span>
        <span class="n">uniq_code</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">stmts_follow_goto</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;statement&quot;</span>
                    <span class="ow">and</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="ow">and</span> <span class="s2">&quot;conditional-goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">):</span>
                <span class="n">uniq_code</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conditional_goto</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">uniq_code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditional_op</span><span class="p">:</span>
                    <span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditional_op</span><span class="p">[</span><span class="n">uniq_code</span><span class="p">]</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.reconstruct_stmts_follow_label_after_case"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.reconstruct_stmts_follow_label_after_case">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_stmts_follow_label_after_case</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">stmts_follow_label</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">,</span>
                <span class="n">reconstructed_goto_elem</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span>
                <span class="n">parent</span><span class="p">,</span> <span class="n">index</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function generates a new statements to</span>
<span class="sd">        nest statements that follow label based on</span>
<span class="sd">        condition or non-condition status to eliminate</span>
<span class="sd">        goto.</span>

<span class="sd">        Args:</span>
<span class="sd">            next_goto (list): A list to hold next goto-stmt that may exist</span>
<span class="sd">            within the boundary of current goto.</span>
<span class="sd">            reconstructed_goto_elem (list): A list that will hold</span>
<span class="sd">            reconstructed if statements.</span>
<span class="sd">            header (list): A header tht holds conditional header.</span>
<span class="sd">            parent (:obj: &#39;ET&#39;): A parent ET object that current</span>
<span class="sd">            element will be nested under.</span>
<span class="sd">            stmts_follow_label (list): A list that holds statements</span>
<span class="sd">            follow label statement for currently handling goto.</span>
<span class="sd">            traverse (int): A current traverse counter.</span>
<span class="sd">            index (int): An index of goto.</span>

<span class="sd">        Return:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">stmts_follow_label</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># A case where another goto-stmt appears after the current label</span>
                <span class="k">if</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                    <span class="n">goto_stmt</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">goto_stmt</span><span class="p">[</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stmt</span>
                    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">stmt</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target_label&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_before</span><span class="p">:</span>
                            <span class="n">goto_stmt</span><span class="p">[</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target_label&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_after</span>
                            <span class="ow">and</span> <span class="s2">&quot;goto-move&quot;</span> <span class="ow">in</span> <span class="n">goto_stmt</span><span class="p">[</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span>
                        <span class="p">):</span>
                            <span class="k">del</span> <span class="n">goto_stmt</span><span class="p">[</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span>
                        <span class="n">goto_stmt</span><span class="p">[</span><span class="s1">&#39;goto-stmt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span>
                    <span class="n">next_goto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">goto_stmt</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># A case where both goto and label are under the same level</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outward_move</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">inward_move</span><span class="p">:</span>
                        <span class="n">reconstructed_goto_elem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">encapsulate_under_do_while</span><span class="p">:</span>
                            <span class="n">statement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">stmt</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">stmt</span><span class="p">:</span>
                                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
                    <span class="c1"># A case where outward movement goto handling is need</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">outward_move</span><span class="p">:</span>
                        <span class="n">label_body_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_elem_holder</span><span class="p">[</span><span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;body-level&#39;</span><span class="p">]]</span>
                        <span class="c1"># If goto is a conditional case, but under else then</span>
                        <span class="c1"># there is no header operation. Thus, we simply declare new boolean</span>
                        <span class="c1"># variable like a non-conditional goto, then use that variable to</span>
                        <span class="c1"># construct new if statement and nest statement under label.</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_else</span><span class="p">:</span>
                            <span class="n">number_of_gotos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">])</span>
                            <span class="n">declared_goto_flag_num</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">generate_declaration_element</span><span class="p">(</span>
                                <span class="n">label_body_level</span><span class="p">,</span> <span class="s2">&quot;goto_flag&quot;</span><span class="p">,</span> <span class="n">number_of_gotos</span><span class="p">,</span>
                                <span class="n">declared_goto_flag_num</span><span class="p">,</span> <span class="n">traverse</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">generate_if_element</span><span class="p">(</span>
                                <span class="kc">None</span><span class="p">,</span> <span class="n">label_body_level</span><span class="p">,</span> <span class="n">stmts_follow_label</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s2">&quot;goto_flag_</span><span class="si">{</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span>
                                <span class="n">reconstructed_goto_elem</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">generate_if_element</span><span class="p">(</span>
                                    <span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label_body_level</span><span class="p">,</span> <span class="n">stmts_follow_label</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                    <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span> <span class="n">reconstructed_goto_elem</span>
                            <span class="p">)</span>
                    <span class="c1"># A case where inward movement goto handling is need</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span></div>


<div class="viewcode-block" id="RectifiedXMLGenerator.restruct_declaration"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.restruct_declaration">[docs]</a>    <span class="k">def</span> <span class="nf">restruct_declaration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem_declaration</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function is to restructure declaration to have an uniform</span>
<span class="sd">        xml structure.&quot;&quot;&quot;</span>
        
        <span class="n">declaration</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
            <span class="n">parent</span><span class="p">,</span> <span class="n">elem_declaration</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">elem_declaration</span><span class="o">.</span><span class="n">attrib</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">elem_declaration</span><span class="p">:</span>
            <span class="n">subelem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">declaration</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_element</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">subelem</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span>
                <span class="n">dimensions</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">declaration</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dimensions_holder</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dimensions_holder</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions_holder</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.generate_element"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.generate_element">[docs]</a>    <span class="k">def</span> <span class="nf">generate_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_elem</span><span class="p">,</span> <span class="n">parent_elem</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function is to traverse the existing xml and generate</span>
<span class="sd">        a new copy to the given parent element - This is a recursive function.&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">current_elem</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">parent_elem</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generate_element</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subelem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">parent_elem</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>  <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">subelem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span><span class="p">:</span>
                    <span class="n">subelem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span></div>

    <span class="c1">#################################################################</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#                       ELEMENT GENERATORS                      #</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#################################################################</span>

<div class="viewcode-block" id="RectifiedXMLGenerator.generate_declaration_element"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.generate_declaration_element">[docs]</a>    <span class="k">def</span> <span class="nf">generate_declaration_element</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">default_name</span><span class="p">,</span> <span class="n">number_of_gotos</span><span class="p">,</span>
            <span class="n">declared_flag_num</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A flag declaration and assignment xml generation.</span>
<span class="sd">        This will generate N number of label_flag_i or goto_i,</span>
<span class="sd">        where N is the number of gotos in the Fortran code</span>
<span class="sd">        and i is the number assigned to the flag</span>

<span class="sd">        Args:</span>
<span class="sd">            parent (:obj: &#39;ET&#39;): Parent element object.</span>
<span class="sd">            default_name (str): A default name given for</span>
<span class="sd">            new variable.</span>
<span class="sd">            number_of_gotos (int): A number of gotos. Amount</span>
<span class="sd">            of variables will be generated based on this number.</span>
<span class="sd">            declared_flag_num (list): A list to hold the number</span>
<span class="sd">            of delcared varaibles (flags).</span>
<span class="sd">            traverse (int): A current traverse counter.</span>

<span class="sd">        Return:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Declaration</span>
        <span class="n">specification_attribs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;declaration&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;implicit&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;imports&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uses&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span>
        <span class="p">}</span>
        <span class="n">specification_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
            <span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;specification&quot;</span><span class="p">,</span> <span class="n">specification_attribs</span>
        <span class="p">)</span>
        <span class="n">declaration_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
            <span class="n">specification_elem</span><span class="p">,</span> <span class="s2">&quot;declaration&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;variable&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">type_attribs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;hasKind&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hasLength&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_derived_type&quot;</span><span class="p">:</span> <span class="s2">&quot;False&quot;</span><span class="p">,</span>
            <span class="s2">&quot;keyword2&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;logical&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">type_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
            <span class="n">declaration_elem</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">type_attribs</span>
        <span class="p">)</span>
        <span class="n">variables_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
            <span class="n">declaration_elem</span><span class="p">,</span>
            <span class="s2">&quot;variables&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">number_of_gotos</span><span class="p">)}</span>
        <span class="p">)</span>
        <span class="n">variable_attribs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;hasArraySpec&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hasCharLength&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hasCoarraySpec&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hasInitialValue&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hasInitialization&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_array&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_gotos</span><span class="p">):</span>
            <span class="n">flag_num</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">default_name</span> <span class="o">==</span> <span class="s2">&quot;label_flag&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">flag_num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_label_flags</span><span class="p">:</span>
                    <span class="n">flag_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_label_flags</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">default_name</span> <span class="o">==</span> <span class="s2">&quot;goto_flag&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">flag_num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_goto_flags</span><span class="p">:</span>
                    <span class="n">flag_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_goto_flags</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">declared_label_flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag_num</span><span class="p">)</span>
            <span class="n">declared_flag_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag_num</span><span class="p">)</span>
            <span class="n">variable_attribs</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">default_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">flag_num</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">variable_attribs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">default_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">flag_num</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">variable_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">variables_elem</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="n">variable_attribs</span>
            <span class="p">)</span>

        <span class="c1"># Assignment</span>
        <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_gotos</span><span class="p">):</span>
            <span class="n">flag_num</span> <span class="o">=</span> <span class="n">declared_flag_num</span><span class="p">[</span><span class="n">flag</span><span class="p">]</span>
            <span class="n">declared_flag_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag_num</span><span class="p">)</span>
            <span class="n">statement_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;statement&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assignment_element</span><span class="p">(</span>
                <span class="n">statement_elem</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">default_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">flag_num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
                <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="n">traverse</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.generate_assignment_element"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.generate_assignment_element">[docs]</a>    <span class="k">def</span> <span class="nf">generate_assignment_element</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">name_id</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">value_type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is a function for generating new assignment element xml</span>
<span class="sd">        for goto reconstruction.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent (:obj: &#39;ET&#39;): Parent element object.</span>
<span class="sd">            name_id (str): Name of a target variable.</span>
<span class="sd">            value_type (str): Type of value that will be assigned.</span>
<span class="sd">            traverse (int): A current traverse counter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">assignment_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;assignment&quot;</span><span class="p">)</span>
        <span class="n">target_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">assignment_elem</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">generate_name_element</span><span class="p">(</span>
            <span class="n">target_elem</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="n">name_id</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span>
        <span class="p">)</span>

        <span class="n">value_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">assignment_elem</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="c1"># Unconditional goto has default values of literal as below</span>
        <span class="k">if</span> <span class="n">value_type</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">condition</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">),</span> <span class="s2">&quot;Literal type assignment must not hold condition element.&quot;</span>
            <span class="n">literal_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">value_elem</span><span class="p">,</span> <span class="s2">&quot;literal&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="c1"># Conditional goto has dynamic values of operation</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">condition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">),</span> <span class="s2">&quot;Conditional &lt;goto-stmt&gt; assignment must be passed with operation.&quot;</span>
            <span class="n">unique_code</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">[</span><span class="n">unique_code</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">stmt</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;operation&quot;</span><span class="p">:</span>
                    <span class="n">condition_op</span> <span class="o">=</span> <span class="n">stmt</span>
            <span class="n">operation_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">value_elem</span><span class="p">,</span> <span class="n">condition_op</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">condition_op</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                <span class="n">condition_op</span><span class="p">,</span> <span class="n">operation_elem</span><span class="p">,</span>
                <span class="n">value_elem</span><span class="p">,</span> <span class="n">assignment_elem</span><span class="p">,</span>
                <span class="n">traverse</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.generate_operation_element"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.generate_operation_element">[docs]</a>    <span class="k">def</span> <span class="nf">generate_operation_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">op_type</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is a function for generating new operation element and</span>
<span class="sd">        its nested subelements with the passes arguments.</span>

<span class="sd">        Currently, it generates only a unary operation syntax only.</span>
<span class="sd">        It may require update in the future.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent (:obj: &#39;ET&#39;): Parent element object.</span>
<span class="sd">            op_type (str): Operation type.</span>
<span class="sd">            operator (str): Operator.</span>
<span class="sd">            name (str): Name of a variable for new element.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">operation_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;operation&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">op_type</span><span class="p">})</span>
        <span class="n">operator_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">operation_elem</span><span class="p">,</span> <span class="s2">&quot;operator&quot;</span><span class="p">,</span>
                                      <span class="p">{</span><span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="p">})</span>
        <span class="n">operand_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">operation_elem</span><span class="p">,</span> <span class="s2">&quot;operand&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">generate_name_element</span><span class="p">(</span><span class="n">operand_elem</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                   <span class="s2">&quot;ambiguous&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.generate_name_element"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.generate_name_element">[docs]</a>    <span class="k">def</span> <span class="nf">generate_name_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">hasSubscripts</span><span class="p">,</span> <span class="n">name_id</span><span class="p">,</span> <span class="n">is_array</span><span class="p">,</span>
                              <span class="n">numPartRef</span><span class="p">,</span> <span class="n">name_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is a function for generating new name element based on</span>
<span class="sd">        the provided arguments.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent (:obj: &#39;ET&#39;): Parent element object.</span>
<span class="sd">            hasSubscripts (str): &quot;true&quot; or &quot;false&quot; status in string.</span>
<span class="sd">            name_id (str): Name of a variable.</span>
<span class="sd">            numPartRef (str): Number of references.</span>
<span class="sd">            type (str): Type of a variable.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name_attribs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;hasSubscripts&quot;</span><span class="p">:</span> <span class="n">hasSubscripts</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">name_id</span><span class="p">,</span>
            <span class="s2">&quot;is_array&quot;</span><span class="p">:</span> <span class="n">is_array</span><span class="p">,</span>
            <span class="s2">&quot;numPartRef&quot;</span><span class="p">:</span> <span class="n">numPartRef</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">name_type</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">name_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">name_attribs</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.generate_if_element"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.generate_if_element">[docs]</a>    <span class="k">def</span> <span class="nf">generate_if_element</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">stored_stmts</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">,</span>
            <span class="n">need_operation</span><span class="p">,</span> <span class="n">op_type</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span>
            <span class="n">traverse</span><span class="p">,</span> <span class="n">reconstructed_goto_elem</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is a function generating new if element.</span>
<span class="sd">        Since header can hold unary, multiary, or name, some arguments</span>
<span class="sd">        may be passed with None. Check them to generate an appropriate XML.</span>

<span class="sd">        Args:</span>
<span class="sd">            header (:obj: &#39;ET&#39;): Header element from if.</span>
<span class="sd">            parent (:obj: &#39;ET&#39;): Parent element object.</span>
<span class="sd">            stored_stmts (list): List of statements.</span>
<span class="sd">            next_goto (list): Another gotos appear while</span>
<span class="sd">            handling current goto stmt.</span>
<span class="sd">            need_operation (bool): Boolean to state whether</span>
<span class="sd">            new if needs operation header.</span>
<span class="sd">            op_type (str): Operation type.</span>
<span class="sd">            lhs (str): Left hand side variabel name.</span>
<span class="sd">            rhs (str): Right hand side variabel name.</span>
<span class="sd">            operator (str): Operator.</span>
<span class="sd">            traverse (int): Current traverse counter.</span>
<span class="sd">            reconstructed_goto_elem (list): A list to</span>
<span class="sd">            hold reconstructed AST after goto elimination.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">goto_nest_if_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;if&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;parent&quot;</span><span class="p">:</span><span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]})</span>

        <span class="n">header_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">goto_nest_if_elem</span><span class="p">,</span> <span class="s2">&quot;header&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">need_operation</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generate_operation_element</span><span class="p">(</span><span class="n">header_elem</span><span class="p">,</span> <span class="n">op_type</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span>
                                                <span class="n">lhs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                    <span class="n">operation_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">header_elem</span><span class="p">,</span> <span class="n">stmt</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                                   <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">operation_elem</span><span class="p">,</span> <span class="n">header_elem</span><span class="p">,</span>
                                      <span class="n">goto_nest_if_elem</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_name_element</span><span class="p">(</span><span class="n">header_elem</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;variable&quot;</span><span class="p">)</span>

        <span class="c1"># Generate AST for statements that will be nested under if (!cond) or (cond)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">statement_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">label_before_within_scope</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">body_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">goto_nest_if_elem</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">stored_stmts</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;skip-collect&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                    <span class="n">parent_scope</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent-goto&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">parent_scope</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_label_with_case</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_label_with_case</span><span class="p">[</span><span class="n">parent_scope</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;before&quot;</span><span class="p">:</span>
                            <span class="n">goto_nest_if_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_scope</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">encapsulate_under_do_while</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="s2">&quot;next-goto&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
                        <span class="ow">or</span> <span class="p">(</span>
                            <span class="s2">&quot;lbl&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
                            <span class="ow">and</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_label</span>
                        <span class="p">)</span>
                    <span class="p">):</span>
                        <span class="k">if</span> <span class="s2">&quot;goto-move&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">label_before_within_scope</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s2">&quot;target-label-statement&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                                <span class="k">del</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span>
                                <span class="k">del</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target-label-statement&#39;</span><span class="p">]</span>
                                <span class="n">label_before_within_scope</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="c1"># If label for label-before case is the first statement,</span>
                                <span class="c1"># we want to mark this entire if-statement because it</span>
                                <span class="c1"># represents that it needs to be encapsulated with do-while</span>
                                <span class="k">if</span> <span class="n">statement_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">encapsulate_under_do_while</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="c1"># Reinitialize counter to 0 to count the number of gotos</span>
                                <span class="c1"># only within the current scope</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">current_label</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">label_before_within_scope</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span>
                                <span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">stmt</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span>
                                    <span class="n">label</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_label</span> <span class="o">==</span> <span class="n">label</span><span class="p">:</span>
                                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">encapsulate_under_do_while</span><span class="p">:</span>
                                            <span class="n">goto_nest_if_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span>
                                                <span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
                                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;goto-stmt&quot;</span><span class="p">:</span>
                                    <span class="c1"># If current goto-stmt label is equal to the scope label,</span>
                                    <span class="c1"># it means that end-of-scope is met and ready to reconstruct</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_label</span> <span class="o">==</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target_label&#39;</span><span class="p">]:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                        <span class="c1"># Since we are going to handle the first label-before</span>
                                        <span class="c1"># case, remove the label lbl from the list</span>
                                        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_before</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                        <span class="n">label_before_within_scope</span> <span class="o">=</span> <span class="kc">False</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">current_label</span> <span class="o">=</span> <span class="kc">None</span>

                                        <span class="n">reconstruct_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_goto_before_label</span><span class="p">(</span>
                                            <span class="n">body_elem</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span>
                                            <span class="n">reconstruct_target</span><span class="p">)</span>

                                    <span class="c1"># Else, a new goto-stmt was found that is nested current label_before</span>
                                    <span class="c1"># case scope, so we need to update the parent for it</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent-goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_label</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">body_elem</span><span class="p">,</span> <span class="n">stmt</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                                     <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                            <span class="k">if</span> <span class="s2">&quot;goto-remove&quot;</span> <span class="ow">in</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                                <span class="k">del</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-remove&#39;</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">stmt</span><span class="p">:</span>
                                <span class="n">child_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                                           <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">child_elem</span><span class="p">,</span>
                                                      <span class="n">cur_elem</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span>
                                                      <span class="n">traverse</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">need_operation</span><span class="p">:</span>
                            <span class="n">goto_stmt</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="n">goto_stmt</span><span class="p">[</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stmt</span>
                            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">stmt</span><span class="p">:</span>
                                <span class="k">assert</span> <span class="p">(</span>
                                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;goto-stmt&quot;</span>
                                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Must only store &lt;goto-stmt&gt; in next_goto[&#39;goto-stmt&#39;]. Current: &lt;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s2">&gt;.&quot;</span>
                                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span>
                                    <span class="s1">&#39;target_label&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_before</span><span class="p">:</span>
                                    <span class="n">goto_stmt</span><span class="p">[</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span>
                                        <span class="s1">&#39;goto-move&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                                <span class="k">if</span> <span class="p">(</span>
                                        <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span>
                                            <span class="s1">&#39;target_label&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_after</span>
                                        <span class="ow">and</span> <span class="s2">&quot;goto-move&quot;</span> <span class="ow">in</span> <span class="n">goto_stmt</span><span class="p">[</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span>
                                <span class="p">):</span>
                                    <span class="k">del</span> <span class="n">goto_stmt</span><span class="p">[</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span>
                                <span class="n">goto_stmt</span><span class="p">[</span><span class="s1">&#39;goto-stmt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span>
                            <span class="n">next_goto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">goto_stmt</span><span class="p">)</span>
                    <span class="n">statement_num</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encapsulate_under_do_while</span>
            <span class="ow">and</span> <span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">goto_nest_if_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;program&quot;</span>
                        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">outward_move</span>
                    <span class="p">)</span>
                    <span class="ow">or</span> <span class="p">(</span>
                        <span class="n">goto_nest_if_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;program&quot;</span>
                        <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outward_move</span>
                    <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">):</span>
            <span class="n">goto_nest_if_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
            <span class="n">reconstructed_goto_elem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">goto_nest_if_elem</span><span class="p">)</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">goto_nest_if_elem</span><span class="p">)</span></div>

    <span class="c1">#################################################################</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#                       MISCELLANEOUS                           #</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#################################################################</span>

<div class="viewcode-block" id="RectifiedXMLGenerator.clean_derived_type_ref"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.clean_derived_type_ref">[docs]</a>    <span class="k">def</span> <span class="nf">clean_derived_type_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function will clean up the derived type referencing syntax,</span>
<span class="sd">        which is stored in a form of &quot;id=&#39;x&#39;%y&quot; in the id attribute.</span>
<span class="sd">        Once the id gets cleaned, it will call the</span>
<span class="sd">        reconstruc_derived_type_ref function to reconstruct and replace the</span>
<span class="sd">        messy version of id with the cleaned version.</span>

<span class="sd">        Args:</span>
<span class="sd">            current (:obj: &#39;ET&#39;): Current element object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_id</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span>
            <span class="s2">&quot;id&quot;</span>
        <span class="p">]</span>  <span class="c1"># 1. Get the original form of derived type id, which is in a form of,</span>
        <span class="c1"># for example, id=&quot;x&quot;%y in the original XML.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_id</span><span class="p">(</span><span class="n">current_id</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># 2. Extract the first variable name, for example, x in this case.</span>
        <span class="n">percent_sign</span> <span class="o">=</span> <span class="n">current_id</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
            <span class="s2">&quot;%&quot;</span>
        <span class="p">)</span>  <span class="c1"># 3. Get the location of the &#39;%&#39; sign.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">current_id</span><span class="p">[</span><span class="n">percent_sign</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_id</span><span class="p">)]</span>
        <span class="p">)</span>  <span class="c1"># 4. Get the field variable. y in this example.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_derived_type_ref</span><span class="p">(</span><span class="n">current</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.clean_id"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.clean_id">[docs]</a>    <span class="k">def</span> <span class="nf">clean_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unrefined_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function refines id (or value) with quotation</span>
<span class="sd">        marks included by removing them and returns only</span>
<span class="sd">        the variable name. For example, from &quot;OUTPUT&quot;</span>
<span class="sd">        to OUTPUT and &quot;x&quot; to x.</span>
<span class="sd">        </span>
<span class="sd">        Thus, the id name will be modified as below:</span>
<span class="sd">            Unrefined id - id = &quot;&quot;OUTPUT&quot;&quot;</span>
<span class="sd">            Refined id - id = &quot;OUTPUT&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            unrefined_id (str): Id of name element that holds</span>
<span class="sd">            unnecessary strings.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">([^\&#39;]+)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">unrefined_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.clean_attrib"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.clean_attrib">[docs]</a>    <span class="k">def</span> <span class="nf">clean_attrib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The original XML elements holds &#39;eos&#39; and</span>
<span class="sd">        &#39;rule&#39; attributes that are not necessary</span>
<span class="sd">        and being used. Thus, this function will </span>
<span class="sd">        remove them in the rectified version of</span>
<span class="sd">        XML.</span>

<span class="sd">        Args:</span>
<span class="sd">            current (:obj: &#39;ET&#39;): Current element object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;eos&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;eos&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;rule&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;rule&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.boundary_identifier"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.boundary_identifier">[docs]</a>    <span class="k">def</span> <span class="nf">boundary_identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function will be called to identify the boundary</span>
<span class="sd">        for each goto-and-label. The definition of scope here is</span>
<span class="sd">        that whether one goto-label is nested under another goto-label.</span>
<span class="sd">        </span>
<span class="sd">        For example:</span>
<span class="sd">            &lt;label with lbl = 111&gt;</span>
<span class="sd">            ____&lt;goto-stmt with lbl = 222&gt;</span>
<span class="sd">            ____&lt;label with lbl = 222&gt;</span>
<span class="sd">            &lt;goto-stmt with lbl = 111&gt;</span>

<span class="sd">        In this case, &quot;goto-label with lbl = 222&quot; is within</span>
<span class="sd">        the scope of &quot;lbl = 111&quot;</span>
<span class="sd">        Thus, the elements will be assigned with &quot;parent-goto&quot; attribute with 111.</span>

<span class="sd">        Args:</span>
<span class="sd">            None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">boundary</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">lbl_counter</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">goto_label_in_order</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">goto_and_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encountered_goto_label</span>
        <span class="k">for</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">goto_and_labels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lbl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lbl_counter</span><span class="p">:</span>
                <span class="n">lbl_counter</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lbl_counter</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Identify each label&#39;s parent label (scope)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">goto_label_in_order</span><span class="p">:</span>
                <span class="n">goto_label_in_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lbl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">goto_label_in_order</span><span class="p">:</span>
                    <span class="n">parent</span> <span class="o">=</span> <span class="n">goto_label_in_order</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">boundary</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent</span>
                    <span class="n">goto_label_in_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>

        <span class="c1"># Since the relationship betwen label:goto-stmt is 1:M,</span>
        <span class="c1"># find the label that has multiple goto-stmts.</span>
        <span class="c1"># Because that extra &lt;goto-stmt&gt; creates extra scope to</span>
        <span class="c1"># encapsulate other &#39;label-goto&#39; or &#39;goto-label&#39;.</span>
        <span class="k">for</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">goto_label_in_order</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lbl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">boundary</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">counter</span> <span class="ow">in</span> <span class="n">lbl_counter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">counter</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">boundary</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>

        <span class="c1"># This will check for the handled goto cases.</span>
        <span class="c1"># If any unhandled case encountered, then it will</span>
        <span class="c1"># assert and give out an error. Else, return nothing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_availability</span> <span class="p">(</span><span class="n">boundary</span><span class="p">)</span>

        <span class="n">boundary_for_label</span> <span class="o">=</span> <span class="n">boundary</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_goto_assigner</span> <span class="p">(</span>
                <span class="n">boundary</span><span class="p">,</span> <span class="n">boundary_for_label</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_goto_assigner</span> <span class="p">(</span>
                <span class="n">boundary</span><span class="p">,</span> <span class="n">boundary_for_label</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span><span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_goto_assigner</span> <span class="p">(</span>
                <span class="n">boundary</span><span class="p">,</span> <span class="n">boundary_for_label</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span><span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.update_function_arguments"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.update_function_arguments">[docs]</a>    <span class="k">def</span> <span class="nf">update_function_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function handles function definition&#39;s</span>
<span class="sd">        arguments with array status based on the information</span>
<span class="sd">        that was observed during the function call</span>

<span class="sd">        Args:</span>
<span class="sd">            current (:obj: &#39;ET&#39;): Current node (either call or value)</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fname</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments_list</span><span class="p">:</span>
            <span class="n">callee_arguments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments_list</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">callee_arguments</span><span class="p">:</span>
                <span class="c1"># self.caller_arr_arguments holds any element</span>
                <span class="c1"># only when arrays are being passed to functions</span>
                <span class="c1"># as arguments. Thus, we first need to check if</span>
                <span class="c1"># callee function name exists in the list</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller_arr_arguments</span>
                    <span class="ow">and</span> <span class="n">arg</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller_arr_arguments</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">arg</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">arg</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
        <span class="c1"># re-initialize back to initial values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_function</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.update_call_argument_type"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.update_call_argument_type">[docs]</a>    <span class="k">def</span> <span class="nf">update_call_argument_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">arguments_info</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function updates call statement function argument xml</span>
<span class="sd">        with variable type.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
                <span class="ow">and</span> <span class="n">update</span><span class="p">)</span>
                <span class="ow">and</span> <span class="p">(</span><span class="n">scope</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables_by_scope</span>
                <span class="ow">and</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables_by_scope</span><span class="p">[</span><span class="n">scope</span><span class="p">])</span>
        <span class="p">):</span>

            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables_by_scope</span><span class="p">[</span><span class="n">scope</span><span class="p">][</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span>
            <span class="n">arguments_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">current</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">TYPE_MAP</span><span class="p">:</span>
                <span class="n">type_info</span> <span class="o">=</span> <span class="n">TYPE_MAP</span><span class="p">[</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">type_info</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
            <span class="n">arguments_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">type_info</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">current</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subscript&quot;</span><span class="p">:</span>
                <span class="n">update</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_call_argument_type</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">arguments_info</span><span class="p">)</span></div>
                    
<div class="viewcode-block" id="RectifiedXMLGenerator.replace_interface_function_to_target"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.replace_interface_function_to_target">[docs]</a>    <span class="k">def</span> <span class="nf">replace_interface_function_to_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">arguments_info</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function will check whether replacing function name is needed</span>
<span class="sd">        or not. That is if the Fortran source code has module with interface</span>
<span class="sd">        and does dynamic dispatching to functions.&quot;&quot;&quot;</span>
        <span class="n">cur_function</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">target_function</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">used_modules</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_summary</span><span class="p">:</span>
                <span class="n">interface_funcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_summary</span><span class="p">[</span><span class="n">module</span><span class="p">][</span><span class="s1">&#39;interface_functions&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">cur_function</span> <span class="ow">in</span> <span class="n">interface_funcs</span><span class="p">:</span>
                    <span class="n">interface_func_list</span> <span class="o">=</span> <span class="n">interface_funcs</span><span class="p">[</span><span class="n">cur_function</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">interface_func_list</span><span class="p">:</span>
                        <span class="n">function_args</span> <span class="o">=</span> <span class="n">interface_func_list</span><span class="p">[</span><span class="n">func</span><span class="p">]</span>
                        <span class="n">found_target_function</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments_info</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">function_args</span><span class="p">):</span>
                            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="c1">#  a: argument, t: type</span>
                            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">function_args</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="n">arguments_info</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                    <span class="n">found_target_function</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">found_target_function</span> <span class="o">=</span> <span class="kc">False</span>
                                    <span class="k">break</span>
                                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="c1"># If target function was found in the interface function list,</span>
                        <span class="c1"># modify the current &lt;call&gt; element name and its child &lt;name&gt;</span>
                        <span class="c1"># element id with the target function name from the interface name.</span>
                        <span class="k">if</span> <span class="n">found_target_function</span><span class="p">:</span>
                            <span class="c1"># The order of modifying is important.</span>
                            <span class="c1"># MUST modify child element &lt;name&gt; first before modifying</span>
                            <span class="c1"># current &lt;call&gt;.</span>
                            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">current</span><span class="p">:</span>
                                <span class="k">if</span> <span class="p">(</span>
                                        <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
                                        <span class="ow">and</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">]</span>
                                <span class="p">):</span>
                                    <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
                                <span class="k">for</span> <span class="n">subElem</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">subElem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subscripts&quot;</span><span class="p">:</span>
                                        <span class="n">subElem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
                            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span></div>


    <span class="c1">#################################################################</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#               GOTO ELIMINATION HELPER FUNCTIONS               #</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#################################################################</span>

<div class="viewcode-block" id="RectifiedXMLGenerator.case_availability"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.case_availability">[docs]</a>    <span class="k">def</span> <span class="nf">case_availability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundary</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function checks for the goto cases in the code based</span>
<span class="sd">        on the boundary. If any unhandled case encountered, then it</span>
<span class="sd">        will assert and halt the program.</span>

<span class="sd">        Args:</span>
<span class="sd">            boundary (dict): A dictonary of goto label</span>
<span class="sd">            and boundary label.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Case check for more than double nested goto case</span>
        <span class="n">nested_gotos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">root_boundary</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">current_boundary</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">goto</span><span class="p">,</span> <span class="n">boundary</span> <span class="ow">in</span> <span class="n">boundary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">current_boundary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">current_boundary</span> <span class="o">=</span> <span class="n">goto</span>
                <span class="n">root_boundary</span> <span class="o">=</span> <span class="n">goto</span>
                <span class="n">nested_gotos</span><span class="p">[</span><span class="n">root_boundary</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">boundary</span> <span class="o">==</span> <span class="n">current_boundary</span><span class="p">:</span>
                    <span class="n">nested_gotos</span><span class="p">[</span><span class="n">root_boundary</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">nested_gotos</span><span class="p">[</span><span class="n">root_boundary</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Do do not handle &gt; 2 nested goto case at this moment.&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">root_boundary</span> <span class="o">=</span> <span class="n">goto</span>
                    <span class="n">nested_gotos</span><span class="p">[</span><span class="n">root_boundary</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">current_boundary</span> <span class="o">=</span> <span class="n">goto</span>

        <span class="c1"># All cases are currently handled</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.parent_goto_assigner"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.parent_goto_assigner">[docs]</a>    <span class="k">def</span> <span class="nf">parent_goto_assigner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="n">boundary_for_label</span><span class="p">,</span>
                             <span class="n">statements_to_reconstruct</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function actually assigns boundary(s) to each goto</span>
<span class="sd">        and label statements.</span>

<span class="sd">        Args:</span>
<span class="sd">            boundary (list): A list of boundaries.</span>
<span class="sd">            boundary_for_label (dict): A dictionary of</span>
<span class="sd">            label as a key and its parent boundary label.</span>
<span class="sd">            statements_to_reconstruct (list): A list of</span>
<span class="sd">            statements that require reconstruction.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">statements_to_reconstruct</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="n">target_lbl</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">target_lbl</span> <span class="ow">in</span> <span class="n">boundary</span><span class="p">:</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent-goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">boundary</span><span class="p">[</span><span class="n">target_lbl</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">boundary</span><span class="p">[</span><span class="n">target_lbl</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent-goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>

            <span class="k">if</span> <span class="s2">&quot;target-label-statement&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">boundary_for_label</span><span class="p">:</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent-goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">boundary_for_label</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">boundary_for_label</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent-goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.remove_dup_stmt"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.remove_dup_stmt">[docs]</a>    <span class="k">def</span> <span class="nf">remove_dup_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmts_follow_label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This removes the statement that&#39;s a child statement of</span>
<span class="sd">        if body being seprately re-added to the list.</span>

<span class="sd">        Args:</span>
<span class="sd">           stmts_follow_label (:obj: &#39;ET&#39;): A list that holds</span>
<span class="sd">           statements appeard under the label-statement for</span>
<span class="sd">           reconstruction.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prev_stmt</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">stmts_follow_label</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prev_stmt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># This statement always appears right before</span>
                <span class="c1"># the if-statement, so check this condition</span>
                <span class="c1"># and remove it from the list.</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;if&quot;</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">prev_stmt</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;statement&quot;</span>
                         <span class="ow">and</span> <span class="n">prev_stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;body-level&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;if&quot;</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">stmts_follow_label</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">prev_stmt</span><span class="p">)</span>
            <span class="n">prev_stmt</span> <span class="o">=</span> <span class="n">stmt</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.boundary_identifier_for_backward_goto"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.boundary_identifier_for_backward_goto">[docs]</a>    <span class="k">def</span> <span class="nf">boundary_identifier_for_backward_goto</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">stmts_follow_label</span><span class="p">,</span> <span class="n">goto_index_holder</span><span class="p">,</span>
            <span class="n">number_of_gotos</span><span class="p">,</span> <span class="n">target_label_lbl</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function identifies the boundary from label to goto.</span>
<span class="sd">        Remove any statements that are not within the boundary.</span>
<span class="sd">        Then, store those removed statements seprately for later</span>
<span class="sd">        restoration.</span>

<span class="sd">        Args:</span>
<span class="sd">            stmts_follow_label (list): A list holding the</span>
<span class="sd">            statements that appear after the label-statement</span>
<span class="sd">            for reconstruction.</span>
<span class="sd">            goto_index_holder (list): A list of index of goto</span>
<span class="sd">            in the stmts_follow_label.</span>
<span class="sd">            number_of_gotos (int): Number of gotos in the</span>
<span class="sd">            stmts_follow_label.</span>
<span class="sd">            target_label_lbl (list): A list that should</span>
<span class="sd">            only hold one value of label-stmt&#39;s label value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (list): A list of statements that requires</span>
<span class="sd">            restoration after loop generation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">goto_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">stmts_follow_label</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span>
                    <span class="ow">and</span> <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">):</span>
                <span class="n">target_label_lbl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">stmt</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;goto-stmt&quot;</span>
                        <span class="ow">and</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target_label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_label_lbl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">goto_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">goto_index_holder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">goto_counter</span> <span class="o">==</span> <span class="n">number_of_gotos</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">statements_to_recover</span> <span class="o">=</span> <span class="n">stmts_follow_label</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">stmts_follow_label</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">statements_to_recover</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;if&quot;</span>
                    <span class="ow">and</span> <span class="s2">&quot;conditional-goto-stmt-lbl&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">):</span>
                <span class="n">statements_to_recover</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">stmts_follow_label</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">stmts_follow_label</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">statements_to_recover</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.multiple_goto_identifier"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.multiple_goto_identifier">[docs]</a>    <span class="k">def</span> <span class="nf">multiple_goto_identifier</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">goto_index_holder</span><span class="p">,</span>
            <span class="n">multiple_goto_stmts</span><span class="p">,</span> <span class="n">stmts_follow_label</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function identifies any additional goto</span>
<span class="sd">        statements may appear within the boundary of</span>
<span class="sd">        currently handling backward goto case.</span>

<span class="sd">        Args:</span>
<span class="sd">            stmts_follow_label (list): A list holding the</span>
<span class="sd">            statements that appear after the label-statement</span>
<span class="sd">            for reconstruction.</span>
<span class="sd">            goto_index_holder (list): A list of index of goto</span>
<span class="sd">            in the stmts_follow_label.</span>
<span class="sd">            multiple_goto_stmts (list): A list that will hold</span>
<span class="sd">            additional gotos within the boundary of current</span>
<span class="sd">            goto.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">goto_index_holder</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">multiple_goto_stmts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">stmts_follow_label</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">goto_index_holder</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">goto_index_holder</span><span class="p">):</span>
                    <span class="n">multiple_goto_stmts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">stmts_follow_label</span><span class="p">[</span>
                        <span class="n">goto_index_holder</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">goto_index_holder</span><span class="p">[</span>
                                                         <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">multiple_goto_stmts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">stmts_follow_label</span><span class="p">[</span>
                        <span class="n">goto_index_holder</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">goto_index_holder</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.nested_forward_goto_identifier"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.nested_forward_goto_identifier">[docs]</a>    <span class="k">def</span> <span class="nf">nested_forward_goto_identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiple_goto_stmts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function identifies any existing forward</span>
<span class="sd">        goto case nested under the backward goto case.</span>

<span class="sd">        Args:</span>
<span class="sd">            multiple_goto_stmts (list): A list that will hold</span>
<span class="sd">            additional gotos within the boundary of current</span>
<span class="sd">            goto.</span>
<span class="sd">            index_boundary (list): A list that will hold</span>
<span class="sd">            the indices of label of &lt;label&gt; and &lt;goto-stmt&gt;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (bool): A boolean status indicating whether the</span>
<span class="sd">            nested forward goto exists within the boundary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">index_boundary</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nested_gotos_exist</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">goto</span> <span class="ow">in</span> <span class="n">multiple_goto_stmts</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">main_loop_lbl</span> <span class="o">=</span> <span class="n">goto</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
            <span class="n">label_after_lbl</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">goto</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">label_after_lbl</span><span class="p">:</span>
                        <span class="n">index_boundary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                            <span class="n">main_loop_lbl</span> <span class="o">!=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span>
                            <span class="ow">and</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labels</span>
                    <span class="p">):</span>
                        <span class="n">nested_gotos_exist</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">label_after_lbl</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span>
                        <span class="n">index_boundary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">nested_gotos_exist</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.construct_goto_loop"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.construct_goto_loop">[docs]</a>    <span class="k">def</span> <span class="nf">construct_goto_loop</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">reconstruct_target</span><span class="p">,</span> <span class="n">nested_gotos_exist</span><span class="p">,</span>
            <span class="n">multiple_goto_stmts</span><span class="p">,</span> <span class="n">number_of_gotos</span><span class="p">,</span> <span class="n">declared_label_flag_num</span><span class="p">,</span>
            <span class="n">traverse</span><span class="p">,</span> <span class="n">target_label_lbl</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function constructs loop syntax tree for goto</span>
<span class="sd">        backward case.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent (:obj: &#39;ET&#39;): Parent element of loop.</span>
<span class="sd">            reconstruct_target (dict): A dictionary that</span>
<span class="sd">            will hold nested goto statement.</span>
<span class="sd">            nested_gotos_exist (bool): Boolean to indicating</span>
<span class="sd">            whether nested goto exists or not.</span>
<span class="sd">            multiple_goto_stmts (list): A list of goto and other</span>
<span class="sd">            statements.</span>
<span class="sd">            number_of_gotos (int): Number of gotos to reconstruct.</span>
<span class="sd">            declared_label_flag_num (list): List of flag numbers.</span>
<span class="sd">            traverse (int): Current traverse counter.</span>
<span class="sd">            target_label_lbl (list): A single value list that</span>
<span class="sd">            holds the label value of &lt;label&gt;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cur_elem_parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="n">current_goto_num</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">end_of_current_goto_loop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_gotos</span><span class="p">):</span>
            <span class="n">loop_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">cur_elem_parent</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">,</span>
                                      <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;do-while&quot;</span><span class="p">})</span>

            <span class="n">header_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">loop_elem</span><span class="p">,</span> <span class="s2">&quot;header&quot;</span><span class="p">)</span>
            <span class="c1"># The outermost flag == N and the innermost flag == 1</span>
            <span class="n">flag_num</span> <span class="o">=</span> <span class="n">declared_label_flag_num</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;label_flag_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">flag_num</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">name_attrib</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;hasSubscripts&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ambiguous&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">name_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">header_elem</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">name_attrib</span><span class="p">)</span>
            <span class="n">flag_name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">body_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">loop_elem</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">)</span>
            <span class="c1"># Keep a track of the parent and grandparent elements</span>
            <span class="n">grand_parent_elem</span> <span class="o">=</span> <span class="n">cur_elem_parent</span>
            <span class="n">cur_elem_parent</span> <span class="o">=</span> <span class="n">body_elem</span>
            <span class="c1"># Since reconstruction of multiple goto is done from outermost</span>
            <span class="c1"># to the inner, we are not constructing any subelements until</span>
            <span class="c1"># all encapsulating loops are created first</span>
            <span class="k">if</span> <span class="n">current_goto_num</span> <span class="o">==</span> <span class="n">number_of_gotos</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">statements</span> <span class="ow">in</span> <span class="n">multiple_goto_stmts</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">statements</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">nested_gotos_exist</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">nested_goto_handler</span><span class="p">(</span>
                                        <span class="n">reconstruct_target</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span>
                                        <span class="n">body_elem</span><span class="p">,</span> <span class="n">traverse</span>
                                <span class="p">)</span>
                                <span class="n">nested_gotos_exist</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">elems</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                                    <span class="n">body_elem</span><span class="p">,</span> <span class="n">stmt</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
                                <span class="p">)</span>
                                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">stmt</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="p">(</span>
                                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;goto-stmt&quot;</span>
                                            <span class="ow">and</span> <span class="n">target_label_lbl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span>
                                            <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target_label&#39;</span><span class="p">]</span>
                                    <span class="p">):</span>
                                        <span class="c1"># Conditional</span>
                                        <span class="k">if</span> <span class="s2">&quot;conditional-goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assignment_element</span><span class="p">(</span>
                                                <span class="n">elems</span><span class="p">,</span> <span class="n">flag_name</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">conditional_op</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                                <span class="n">traverse</span>
                                            <span class="p">)</span>
                                        <span class="c1"># Unconditional</span>
                                        <span class="k">else</span><span class="p">:</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assignment_element</span><span class="p">(</span>
                                                <span class="n">elems</span><span class="p">,</span> <span class="n">flag_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                                <span class="s2">&quot;literal&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="n">traverse</span>
                                            <span class="p">)</span>
                                        <span class="n">end_of_current_goto_loop</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">child_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                                            <span class="n">elems</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                                        <span class="p">)</span>
                                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                                                <span class="n">child</span><span class="p">,</span> <span class="n">child_elem</span><span class="p">,</span> <span class="n">elems</span><span class="p">,</span>
                                                <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                                            <span class="p">)</span>
                        <span class="c1"># If end_of_current_goto_loop is True,</span>
                        <span class="c1"># escape one loop out to continue</span>
                        <span class="c1"># construct statements</span>
                        <span class="k">if</span> <span class="n">end_of_current_goto_loop</span><span class="p">:</span>
                            <span class="n">body_elem</span> <span class="o">=</span> <span class="n">grand_parent_elem</span>
                            <span class="n">end_of_current_goto_loop</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="n">flag_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;label_flag_&quot;</span> \
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">number_of_gotos</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">else</span><span class="p">:</span>
                    <span class="n">current_goto_num</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.nested_goto_handler"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.nested_goto_handler">[docs]</a>    <span class="k">def</span> <span class="nf">nested_goto_handler</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">reconstruct_target</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span>
                <span class="n">body_elem</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function collects forward goto case</span>
<span class="sd">        related statements under the backward goto</span>
<span class="sd">        boundary. Then, it calls goto_after function</span>
<span class="sd">        to reconstruct goto.</span>

<span class="sd">        Args:</span>
<span class="sd">            reconstruct_target (list): A list that holds</span>
<span class="sd">            statements for reconstruction.</span>
<span class="sd">            statements (:obj: &#39;ET&#39;): Statements for</span>
<span class="sd">            reconstructions.</span>
<span class="sd">            body_elem (:obj: &#39;ET&#39;): Body element of</span>
<span class="sd">            the loop.</span>
<span class="sd">            traverse (int): Current traverse counter. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">]</span> \
            <span class="o">=</span> <span class="n">statements</span><span class="p">[</span><span class="n">index_scope</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">index_scope</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span> \
            <span class="o">=</span> <span class="n">statements</span><span class="p">[</span><span class="n">index_scope</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span> \
            <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_goto_after_label</span><span class="p">(</span>
            <span class="n">body_elem</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span> <span class="n">reconstruct_target</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span>
            <span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="RectifiedXMLGenerator.statement_recovery"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifiedXMLGenerator.statement_recovery">[docs]</a>    <span class="k">def</span> <span class="nf">statement_recovery</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statements_to_recover</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function is for recovering any existing statements</span>
<span class="sd">        that follow reconstructed loop.</span>

<span class="sd">        Args:</span>
<span class="sd">            statements_to_recover (list): A list of statements.</span>
<span class="sd">            parent (:obj: &#39;ET&#39;): A prent element.</span>
<span class="sd">            traverse (int): Current traverse counter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">recover_stmt</span> <span class="ow">in</span> <span class="n">statements_to_recover</span><span class="p">:</span>
            <span class="n">statement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">parent</span><span class="p">,</span> <span class="n">recover_stmt</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">recover_stmt</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">recover_stmt</span><span class="p">:</span>
                <span class="n">child_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">statement</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">child_elem</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                        <span class="p">)</span></div></div>


<span class="c1">#################################################################</span>
<span class="c1">#                                                               #</span>
<span class="c1">#                     NON-CLASS FUNCTIONS                       #</span>
<span class="c1">#                                                               #</span>
<span class="c1">#################################################################</span>

<div class="viewcode-block" id="is_empty"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.is_empty">[docs]</a><span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="n">elem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function is just a helper function for</span>
<span class="sd">    check whether the passed elements (i.e. list)</span>
<span class="sd">    is empty or not</span>

<span class="sd">    Args:</span>
<span class="sd">        elem (:obj:): Any structured data object (i.e. list).</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if element is empty or false if not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">elem</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="indent"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.indent">[docs]</a><span class="k">def</span> <span class="nf">indent</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function indents each level of XML.</span>

<span class="sd">    Source:</span>
<span class="sd">        https://stackoverflow.com/questions/3095434/inserting-newlines</span>
<span class="sd">        -in-xml-file-generated-via-xml-etree-elementstree-in-python</span>

<span class="sd">    Args:</span>
<span class="sd">        elem (:obj: &#39;ET&#39;): An XML root.</span>
<span class="sd">        level (int): A root level in integer.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">level</span> <span class="o">*</span> <span class="s2">&quot;  &quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;  &quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">:</span>
            <span class="n">indent</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">level</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">i</span></div>


<div class="viewcode-block" id="buildNewASTfromXMLString"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.buildNewASTfromXMLString">[docs]</a><span class="k">def</span> <span class="nf">buildNewASTfromXMLString</span><span class="p">(</span>
        <span class="n">xmlString</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">original_fortran_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">module_log_file_path</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span> <span class="n">List</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;This function processes OFP generated XML and generates a rectified</span>
<span class="sd">    version by recursively calling the appropriate functions.</span>

<span class="sd">    Args:</span>
<span class="sd">        xmlString (str): XML as a string</span>
<span class="sd">        original_fortran_file (str): Path to the original Fortran file</span>
<span class="sd">        module_log_file_path (str): Path to the module_log_file</span>

<span class="sd">    Returns:</span>
<span class="sd">        ET object: A reconstructed element object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xml_generator</span> <span class="o">=</span> <span class="n">RectifiedXMLGenerator</span><span class="p">()</span>
    <span class="c1"># We need the absolute path of Fortran file to lookup in the modLogFile.json</span>
    <span class="n">xml_generator</span><span class="o">.</span><span class="n">original_fortran_file_abs_path</span> <span class="o">=</span> \
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">original_fortran_file</span><span class="p">)</span>
    <span class="n">xml_generator</span><span class="o">.</span><span class="n">module_log_file_path</span> <span class="o">=</span> <span class="n">module_log_file_path</span>
    <span class="n">traverse</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">ofpAST</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="n">xmlString</span><span class="p">)</span>
    <span class="c1"># A root of the new AST</span>
    <span class="n">newRoot</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="n">ofpAST</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">ofpAST</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
    <span class="c1"># First add the root to the new AST list</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">ofpAST</span><span class="p">:</span>
        <span class="c1"># Handle only non-empty elements</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">newRoot</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="n">xml_generator</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">newRoot</span><span class="p">,</span> <span class="n">newRoot</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>

    <span class="c1"># Indent and structure the tree properly</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">newRoot</span><span class="p">)</span>
    <span class="n">indent</span><span class="p">(</span><span class="n">newRoot</span><span class="p">)</span>

    <span class="c1"># Checks if the rectified AST requires goto elimination,</span>
    <span class="c1"># if it does, it does a 2nd traversal to eliminate and</span>
    <span class="c1"># reconstruct the AST once more</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">xml_generator</span><span class="o">.</span><span class="n">need_goto_elimination</span><span class="p">):</span>
        <span class="n">oldRoot</span> <span class="o">=</span> <span class="n">newRoot</span>
        <span class="n">traverse</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">xml_generator</span><span class="o">.</span><span class="n">boundary_identifier</span><span class="p">()</span>

        <span class="n">newRoot</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="n">oldRoot</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">oldRoot</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">oldRoot</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">newRoot</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="n">xml_generator</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">newRoot</span><span class="p">,</span> <span class="n">newRoot</span><span class="p">,</span>
                                        <span class="n">traverse</span><span class="p">)</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">newRoot</span><span class="p">)</span>
        <span class="n">indent</span><span class="p">(</span><span class="n">newRoot</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">xml_generator</span><span class="o">.</span><span class="n">continue_elimination</span><span class="p">:</span>
            <span class="n">xml_generator</span><span class="o">.</span><span class="n">need_goto_elimination</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">newRoot</span><span class="p">,</span> <span class="n">xml_generator</span><span class="o">.</span><span class="n">module_files_to_process</span></div>


<div class="viewcode-block" id="parse_args"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.parse_args">[docs]</a><span class="k">def</span> <span class="nf">parse_args</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;This function parse the arguments passed to the script.</span>
<span class="sd">    It returns a tuple of (input ofp xml, output xml)</span>
<span class="sd">    file names.</span>

<span class="sd">    Args:</span>
<span class="sd">        None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-f&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--file&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;OFP generated XML file needs to be passed.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-g&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--gen&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A rectified version of XML.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">if</span> <span class="p">(</span>
            <span class="n">args</span><span class="o">.</span><span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">gen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="n">ofpFile</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rectifiedFile</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">gen</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="kc">False</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;[[ Missing either input or output file.</span><span class="se">\</span>
<span class="s2">             Input: </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="si">}</span><span class="s2">, Output: </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">gen</span><span class="si">}</span><span class="s2"> ]]&quot;</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">ofpFile</span><span class="p">,</span> <span class="n">rectifiedFile</span><span class="p">)</span></div>


<div class="viewcode-block" id="fileChecker"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.fileChecker">[docs]</a><span class="k">def</span> <span class="nf">fileChecker</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function checks for the validity (file existence and</span>
<span class="sd">    mode). If either the file does not exist or the mode is</span>
<span class="sd">    not valid, throws an IO exception and terminates the program</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): A file name that reconstructed XMl</span>
<span class="sd">        will be written to.</span>
<span class="sd">        mode (str): Mode to open the file in.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="kc">False</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> does not exit or invalid mode </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">.&quot;</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="p">(</span><span class="n">ofpFile</span><span class="p">,</span> <span class="n">rectifiedFile</span><span class="p">)</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">()</span>

    <span class="c1"># Since we pass the file name to the element</span>
    <span class="c1"># tree parser not opening it with open function,</span>
    <span class="c1"># we check for the validity before the file name</span>
    <span class="c1"># is actually passed to the parser</span>
    <span class="n">fileChecker</span><span class="p">(</span><span class="n">ofpFile</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">ofpXML</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">ofpFile</span><span class="p">)</span>
    <span class="n">ofpXMLRoot</span> <span class="o">=</span> <span class="n">ofpXML</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>

    <span class="c1"># Converts the XML tree into string</span>
    <span class="n">ofpXMLStr</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">ofpXMLRoot</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="c1"># Call buildNewASTfromXMLString to rectify the XML</span>
    <span class="n">rectifiedXML</span> <span class="o">=</span> <span class="n">buildNewASTfromXMLString</span><span class="p">(</span><span class="n">ofpXMLStr</span><span class="p">)</span>
    <span class="n">rectifiedTree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">rectifiedXML</span><span class="p">)</span>

    <span class="c1"># The write function is used with the generated</span>
    <span class="c1"># XML tree object not with the file object. Thus,</span>
    <span class="c1"># same as the ofpFile, we do a check for the validity</span>
    <span class="c1"># of a file before pass to the ET tree object&#39;s write</span>
    <span class="c1"># function</span>
    <span class="n">fileChecker</span><span class="p">(</span><span class="n">rectifiedFile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">rectifiedTree</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rectifiedFile</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, Adarsh.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>