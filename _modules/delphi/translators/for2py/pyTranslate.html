

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>delphi.translators.for2py.pyTranslate &mdash; delphi  documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/collapsible-lists/css/tree_view.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../../../../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> delphi
          

          
            
            <img src="../../../../_static/delphi_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../model.html">The Delphi model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../GrFN_API.html">GroundedFunctionNetwork API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../grfn_spec.html">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cpp_api/library_root.html">C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../grfn_openapi.html">GrFN OpenAPI Specification</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">delphi</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../for2py.html">delphi.translators.for2py</a> &raquo;</li>
        
      <li>delphi.translators.for2py.pyTranslate</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for delphi.translators.for2py.pyTranslate</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot; This module contains code to convert a Fortran AST representation into a</span>
<span class="sd">Python script having the same functionalities and performing the same</span>
<span class="sd">operations as the original Fortran file.  &quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">delphi.translators.for2py.format</span> <span class="kn">import</span> <span class="n">list_data_type</span>
<span class="kn">from</span> <span class="nn">delphi.translators.for2py</span> <span class="kn">import</span> <span class="n">For2PyError</span><span class="p">,</span> <span class="n">syntax</span>

<span class="c1">###############################################################################</span>
<span class="c1">#                                                                             #</span>
<span class="c1">#                          FORTRAN-TO-PYTHON MAPPINGS                         #</span>
<span class="c1">#                                                                             #</span>
<span class="c1">###############################################################################</span>

<span class="c1"># TYPE_MAP gives the mapping from Fortran types to Python types</span>
<span class="n">TYPE_MAP</span> <span class="o">=</span> <span class="p">{</span>
<span class="c1">#    &quot;character&quot;: &quot;str&quot;,</span>
    <span class="s2">&quot;double&quot;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span>
    <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span>
    <span class="s2">&quot;int&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
    <span class="s2">&quot;integer&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
    <span class="s2">&quot;logical&quot;</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span>
    <span class="s2">&quot;real&quot;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span>
    <span class="s2">&quot;str&quot;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
    <span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># OPERATOR_MAP gives the mapping from Fortran operators to Python operators</span>
<span class="n">OPERATOR_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;+&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
    <span class="s2">&quot;-&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
    <span class="s2">&quot;*&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
    <span class="s2">&quot;/&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
    <span class="s2">&quot;**&quot;</span><span class="p">:</span> <span class="s2">&quot;**&quot;</span><span class="p">,</span>
    <span class="s2">&quot;&lt;&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;&lt;=&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;=&quot;</span><span class="p">,</span>
    <span class="s2">&quot;&gt;=&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;=&quot;</span><span class="p">,</span>
    <span class="s2">&quot;==&quot;</span><span class="p">:</span> <span class="s2">&quot;==&quot;</span><span class="p">,</span>
    <span class="s2">&quot;!=&quot;</span><span class="p">:</span> <span class="s2">&quot;!=&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.ne.&quot;</span><span class="p">:</span> <span class="s2">&quot;!=&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.not.&quot;</span><span class="p">:</span> <span class="s2">&quot;not&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.gt.&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.eq.&quot;</span><span class="p">:</span> <span class="s2">&quot;==&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.lt.&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.le.&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;=&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.ge.&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;=&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.and.&quot;</span><span class="p">:</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.or.&quot;</span><span class="p">:</span> <span class="s2">&quot;or&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.eqv.&quot;</span><span class="p">:</span> <span class="s2">&quot;==&quot;</span><span class="p">,</span>
    <span class="s2">&quot;//&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># INTRINSICS_MAP gives the mapping from Fortran intrinsics to Python operators</span>
<span class="c1"># and functions.  Each entry in this map is of the form</span>
<span class="c1">#</span>
<span class="c1">#      fortran_fn : python_tgt</span>
<span class="c1">#</span>
<span class="c1"># where fortran_fn is the Fortran function; and python_tgt is the corresponding</span>
<span class="c1"># Python target, specified as a tuple (py_fn, fn_type, py_mod), where:</span>
<span class="c1">#            -- py_fn is a Python function or operator;</span>
<span class="c1">#            -- fn_type is one of: &#39;FUNC&#39;, &#39;INFIXOP&#39;; and</span>
<span class="c1">#            -- py_mod is the module the Python function should be imported</span>
<span class="c1">#            from, None if no explicit import is necessary.</span>

<span class="n">INTRINSICS_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;abs&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;abs&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="s2">&quot;acos&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;acos&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;acosh&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;acosh&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;asin&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;asin&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;asinh&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;asinh&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;atan&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;atan&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;atanh&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;atanh&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;ceiling&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;ceil&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;cos&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;cos&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;cosh&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;cosh&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;erf&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;erf&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;erfc&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;erfc&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;exp&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;exp&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;floor&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;floor&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;hypot&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;hypot&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;int&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="s2">&quot;isnan&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;isnan&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;lge&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;&gt;=&quot;</span><span class="p">,</span> <span class="s2">&quot;INFIXOP&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>  <span class="c1"># lexical string comparison</span>
    <span class="s2">&quot;lgt&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;INFIXOP&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>  <span class="c1"># lexical string comparison</span>
    <span class="s2">&quot;lle&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="s2">&quot;INFIXOP&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>  <span class="c1"># lexical string comparison</span>
    <span class="s2">&quot;llt&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;INFIXOP&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>  <span class="c1"># lexical string comparison</span>
    <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;log10&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;log10&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;log_gamma&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;lgamma&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="s2">&quot;mod&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;INFIXOP&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="s2">&quot;modulo&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;INFIXOP&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="s2">&quot;sin&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;sin&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;sinh&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;sinh&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;sqrt&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;sqrt&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;tan&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;tan&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;tanh&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;tanh&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="s2">&quot;math&quot;</span><span class="p">),</span>
    <span class="s2">&quot;xor&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot;INFIXOP&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="s2">&quot;rand&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;random&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="s2">&quot;len&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="s2">&quot;adjustl&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;adjustl&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="s2">&quot;adjustr&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;adjustr&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="p">}</span>


<span class="c1">###############################################################################</span>
<span class="c1">#                                                                             #</span>
<span class="c1">#                                 TRANSLATION                                 #</span>
<span class="c1">#                                                                             #</span>
<span class="c1">###############################################################################</span>

<div class="viewcode-block" id="PrintState"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PrintState">[docs]</a><span class="k">class</span> <span class="nc">PrintState</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">add</span><span class="o">=</span><span class="s2">&quot;    &quot;</span><span class="p">,</span>
            <span class="n">printFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callSource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">definedVars</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">globalVars</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">functionScope</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">indexRef</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span> <span class="o">=</span> <span class="n">add</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printFirst</span> <span class="o">=</span> <span class="n">printFirst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callSource</span> <span class="o">=</span> <span class="n">callSource</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">definedVars</span> <span class="o">=</span> <span class="n">definedVars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">globalVars</span> <span class="o">=</span> <span class="n">globalVars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functionScope</span> <span class="o">=</span> <span class="n">functionScope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexRef</span> <span class="o">=</span> <span class="n">indexRef</span>

<div class="viewcode-block" id="PrintState.copy"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PrintState.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">sep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">add</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">printFirst</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">callSource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">definedVars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">globalVars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">functionScope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">indexRef</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">PrintState</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sep</span> <span class="k">if</span> <span class="n">sep</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sep</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span> <span class="k">if</span> <span class="n">add</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">add</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printFirst</span> <span class="k">if</span> <span class="n">printFirst</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">printFirst</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callSource</span> <span class="k">if</span> <span class="n">callSource</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">callSource</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">definedVars</span> <span class="k">if</span> <span class="n">definedVars</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">definedVars</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">globalVars</span> <span class="k">if</span> <span class="n">globalVars</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">globalVars</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">functionScope</span> <span class="k">if</span> <span class="n">functionScope</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">functionScope</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexRef</span> <span class="k">if</span> <span class="n">indexRef</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">indexRef</span><span class="p">,</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="PythonCodeGenerator"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator">[docs]</a><span class="k">class</span> <span class="nc">PythonCodeGenerator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Variable to hold the program name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">programName</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># Dictionary to hold the tag mapping to the</span>
        <span class="c1"># print function that needs to be invoked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printFn</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Dictionary to hold the declared variable</span>
        <span class="c1"># and its declared type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variableMap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># List to hold the imports in the program</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imports</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># List to hold the private functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">privFunctions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Dictionary to hold declared symbols (variable,</span>
        <span class="c1"># function, and format, etc) as key and map to</span>
        <span class="c1"># the symbol name that will be used in the python IR output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># List to hold the declared function names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Dictionary to hold functions and its arguments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">funcArgs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Pre-defined string format of system getframe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getframe_expr</span> <span class="o">=</span> <span class="s2">&quot;sys._getframe(</span><span class="si">{}</span><span class="s2">).f_code.co_name&quot;</span>
        <span class="c1"># List to hold the translated python string that</span>
        <span class="c1"># will be printed to the python IR output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Dictionary holding mapping of read/write</span>
        <span class="c1"># based on the file open state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stateMap</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;UNKNOWN&quot;</span><span class="p">:</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;REPLACE&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">}</span>
        <span class="c1"># Dictionary to hold the mapping of {label:format-code}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Lists to hold derived type class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declaredDerivedTypes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Lists to hold derived type variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declaredDerivedTVars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Dictionary to hold save variables local to a subroutine or function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># String to hold the current name of the subroutine or function under</span>
        <span class="c1"># analysis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_module</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># Dictionary to map all the variables (under each function) to its</span>
        <span class="c1"># corresponding types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_type</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># String to hold the current call being processed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_call</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># This flag is True when the SAVE statement is in context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_save</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># This variable holds the current variable being inspected in the</span>
        <span class="c1"># select-case statement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_select</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># This flag remains False until the first case statement is started</span>
        <span class="c1"># in every select block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_started</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># This dictionary holds the defined arrays along with their data types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">array_map</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">printFn</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;subroutine&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printSubroutine</span><span class="p">,</span>
            <span class="s2">&quot;program&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printProgram</span><span class="p">,</span>
            <span class="s2">&quot;call&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printCall</span><span class="p">,</span>
            <span class="s2">&quot;arg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printArg</span><span class="p">,</span>
            <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printVariable</span><span class="p">,</span>
            <span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printDo</span><span class="p">,</span>
            <span class="s2">&quot;do-while&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printDoWhile</span><span class="p">,</span>
            <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printIndex</span><span class="p">,</span>
            <span class="s2">&quot;if&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printIf</span><span class="p">,</span>
            <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printOp</span><span class="p">,</span>
            <span class="s2">&quot;literal&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printLiteral</span><span class="p">,</span>
            <span class="s2">&quot;ref&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printRef</span><span class="p">,</span>
            <span class="s2">&quot;assignment&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printAssignment</span><span class="p">,</span>
            <span class="s2">&quot;exit&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printExit</span><span class="p">,</span>
            <span class="s2">&quot;return&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printReturn</span><span class="p">,</span>
            <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printFunction</span><span class="p">,</span>
            <span class="s2">&quot;ret&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printFuncReturn</span><span class="p">,</span>
            <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printExit</span><span class="p">,</span>
            <span class="s2">&quot;read&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printRead</span><span class="p">,</span>
            <span class="s2">&quot;write&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printWrite</span><span class="p">,</span>
            <span class="s2">&quot;open&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printOpen</span><span class="p">,</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printFormat</span><span class="p">,</span>
            <span class="s2">&quot;module&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printModule</span><span class="p">,</span>
            <span class="s2">&quot;use&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printUse</span><span class="p">,</span>
            <span class="s2">&quot;close&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printClose</span><span class="p">,</span>
            <span class="s2">&quot;private&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printPrivate</span><span class="p">,</span>
            <span class="s2">&quot;array&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printArray</span><span class="p">,</span>
            <span class="s2">&quot;derived-type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printDerivedType</span><span class="p">,</span>
            <span class="s2">&quot;cycle&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printContinue</span><span class="p">,</span>
            <span class="s2">&quot;select&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printSelect</span><span class="p">,</span>
            <span class="s2">&quot;case&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printCase</span><span class="p">,</span>
            <span class="s2">&quot;interface&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">printInterface</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readFormat</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">###########################################################################</span>
    <span class="c1">#                                                                         #</span>
    <span class="c1">#                      TOP-LEVEL PROGRAM COMPONENTS                       #</span>
    <span class="c1">#                                                                         #</span>
    <span class="c1">###########################################################################</span>

<div class="viewcode-block" id="PythonCodeGenerator.printSubroutine"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printSubroutine">[docs]</a>    <span class="k">def</span> <span class="nf">printSubroutine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;prints Fortran subroutine in python function syntax&quot;&quot;&quot;</span>

        <span class="c1"># Handle the save statement first since the decorator needs to be</span>
        <span class="c1"># just above the function definition</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_module</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printSave</span><span class="p">(</span><span class="n">node</span><span class="p">,</span>
                       <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                           <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="p">,</span>
                           <span class="n">add</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                           <span class="n">printFirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">definedVars</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
                           <span class="n">indexRef</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="p">),</span>
                       <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">def </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span><span class="si">}</span><span class="s2">(&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
            <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">],</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="p">,</span>
                <span class="n">add</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">printFirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">definedVars</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
                <span class="n">indexRef</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;):&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">printState</span><span class="o">.</span><span class="n">sep</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">:</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
            <span class="n">node</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">],</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                <span class="n">sep</span><span class="o">=</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">printState</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>
                <span class="n">printFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">definedVars</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
                <span class="n">indexRef</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printFunction"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printFunction">[docs]</a>    <span class="k">def</span> <span class="nf">printFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;prints Fortran function in python function</span>
<span class="sd">           syntax&quot;&quot;&quot;</span>

        <span class="c1"># Handle the save statement first since the decorator needs to be</span>
        <span class="c1"># just above the function definition</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_module</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printSave</span><span class="p">(</span><span class="n">node</span><span class="p">,</span>
                       <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                           <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="p">,</span>
                           <span class="n">add</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                           <span class="n">printFirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">definedVars</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
                           <span class="n">indexRef</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="p">),</span>
        <span class="p">)</span>
        <span class="c1"># self.functions.append(self.nameMapper[node[&#39;name&#39;]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">def </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span><span class="si">}</span><span class="s2">(&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">funcArgs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
            <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">],</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="p">,</span>
                <span class="n">add</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">printFirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">definedVars</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
                <span class="n">indexRef</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;):&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">printState</span><span class="o">.</span><span class="n">sep</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">:</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
            <span class="n">node</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">],</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                <span class="n">sep</span><span class="o">=</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">printState</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>
                <span class="n">printFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">definedVars</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
                <span class="n">indexRef</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">functionScope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]],</span>
            <span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printModule"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printModule">[docs]</a>    <span class="k">def</span> <span class="nf">printModule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            prints the module syntax</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_module</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
            <span class="n">node</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">],</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">printFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">definedVars</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">indexRef</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printProgram"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printProgram">[docs]</a>    <span class="k">def</span> <span class="nf">printProgram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;prints Fortran program in Python function syntax</span>
<span class="sd">           by calling printSubroutine function&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printSubroutine</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">programName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span></div>

    <span class="c1">###########################################################################</span>
    <span class="c1">#                                                                         #</span>
    <span class="c1">#                               EXPRESSIONS                               #</span>
    <span class="c1">#                                                                         #</span>
    <span class="c1">###########################################################################</span>

<div class="viewcode-block" id="PythonCodeGenerator.proc_intrinsic"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.proc_intrinsic">[docs]</a>    <span class="k">def</span> <span class="nf">proc_intrinsic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Processes calls to intrinsic functions and returns a string that is</span>
<span class="sd">           the corresponding Python code.&quot;&quot;&quot;</span>
        <span class="n">intrinsic</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">intrinsic</span> <span class="ow">in</span> <span class="n">syntax</span><span class="o">.</span><span class="n">F_INTRINSICS</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">py_fn</span><span class="p">,</span> <span class="n">py_fn_type</span><span class="p">,</span> <span class="n">py_mod</span> <span class="o">=</span> <span class="n">INTRINSICS_MAP</span><span class="p">[</span><span class="n">intrinsic</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">For2PyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No handler for Fortran intrinsic </span><span class="si">{</span><span class="n">intrinsic</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">arg_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_arg_list</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">arg_strs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proc_expr</span><span class="p">(</span><span class="n">arg_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arg_list</span><span class="p">))</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">py_mod</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">py_mod</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">py_fn</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="n">py_fn</span>

        <span class="k">if</span> <span class="n">py_fn_type</span> <span class="o">==</span> <span class="s2">&quot;FUNC&quot;</span><span class="p">:</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arg_strs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">py_fn</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;adjustl&quot;</span><span class="p">,</span> <span class="s2">&quot;adjustr&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">arguments</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">handler</span><span class="si">}</span><span class="s2">()&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">handler</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">arguments</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">elif</span> <span class="n">py_fn_type</span> <span class="o">==</span> <span class="s2">&quot;INFIXOP&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;INFIXOP with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arg_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> arguments&quot;</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">arg_strs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">py_fn</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">arg_strs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unknown py_fn_type: </span><span class="si">{</span><span class="n">py_fn_type</span><span class="si">}</span><span class="s2">&quot;</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.get_arg_list"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.get_arg_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_arg_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get_arg_list() returns the list of arguments or subscripts at a node.</span>
<span class="sd">           If there are no arguments or subscripts, it returns the empty list.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;args&quot;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;subscripts&quot;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;subscripts&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.proc_call"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.proc_call">[docs]</a>    <span class="k">def</span> <span class="nf">proc_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Processes function calls, including calls to intrinsics, and returns</span>
<span class="sd">           a string that is the corresponding Python code.  This code assumes</span>
<span class="sd">           that proc_expr() has used type info to correctly identify array</span>
<span class="sd">           references, and that proc_call() is therefore correctly called only</span>
<span class="sd">           on function calls.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">variableMap</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;character&quot;</span><span class="p">:</span>
                <span class="n">to_find</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">opt_arg</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">.f_index(&quot;</span><span class="si">{</span><span class="n">to_find</span><span class="si">}</span><span class="s1">&quot;, [&quot;</span><span class="si">{</span><span class="n">opt_arg</span><span class="si">}</span><span class="s1">&quot;])&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">.f_index(&quot;</span><span class="si">{</span><span class="n">to_find</span><span class="si">}</span><span class="s1">&quot;)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">to_find</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">[0].find(</span><span class="si">{</span><span class="n">to_find</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">syntax</span><span class="o">.</span><span class="n">F_INTRINSICS</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_intrinsic</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_call</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_arg_list</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="n">arg_strs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">proc_expr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span>
            <span class="n">args</span><span class="p">))]</span>

        <span class="c1"># Case where a call is a print method</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_call</span> <span class="o">==</span> <span class="s2">&quot;print&quot;</span><span class="p">:</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_print</span><span class="p">(</span><span class="n">arg_strs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arg_strs</span><span class="p">)</span>
        <span class="n">exp_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_call</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">arguments</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="k">return</span> <span class="n">exp_str</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.proc_print"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.proc_print">[docs]</a>    <span class="k">def</span> <span class="nf">proc_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg_strs</span><span class="p">):</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg_strs</span><span class="p">)):</span>
            <span class="n">arguments</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">arg_strs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg_strs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">arguments</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span>
        <span class="k">return</span> <span class="n">arguments</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.proc_literal"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.proc_literal">[docs]</a>    <span class="k">def</span> <span class="nf">proc_literal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Processes a literal value and returns a string that is the</span>
<span class="sd">           corresponding Python code.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;bool&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;char&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">]</span> \
              <span class="ow">and</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">]:</span>
                <span class="n">return_val</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">return_val</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">return_val</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.proc_ref"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.proc_ref">[docs]</a>    <span class="k">def</span> <span class="nf">proc_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">wrapper</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Processes a reference node and returns a string that is the</span>
<span class="sd">           corresponding Python code.  The argument &quot;wrapper&quot; indicates whether</span>
<span class="sd">           or not the Python expression should refer to the list wrapper for</span>
<span class="sd">           (scalar) variables.&quot;&quot;&quot;</span>
        <span class="n">ref_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">is_derived_type_ref</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="s2">&quot;is_derived_type_ref&quot;</span> <span class="ow">in</span> <span class="n">node</span>
                <span class="ow">and</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;is_derived_type_ref&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
        <span class="p">):</span>
            <span class="n">ref_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_derived_type_ref</span><span class="p">(</span>
                <span class="n">node</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;numPartRef&quot;</span><span class="p">]),</span> <span class="kc">False</span>
            <span class="p">)</span>
            <span class="n">is_derived_type_ref</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ref_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span>
        <span class="c1"># If the variable is a saved variable, prefix it by the function name</span>
        <span class="c1"># to access the saved value of the variable</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_derived_type_ref</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ref_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="p">]:</span>
                    <span class="n">ref_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ref_str</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ref_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="p">]:</span>
                    <span class="n">ref_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ref_str</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;subscripts&quot;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="c1"># array reference or function call or string indexing</span>
            <span class="k">if</span> <span class="s2">&quot;is_array&quot;</span> <span class="ow">in</span> <span class="n">node</span> <span class="ow">and</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;is_array&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                <span class="n">subs</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;subscripts&quot;</span><span class="p">]</span>
                <span class="n">subs_strs</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">proc_expr</span><span class="p">(</span><span class="n">subs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subs</span><span class="p">))</span>
                <span class="p">]</span>
                <span class="n">subscripts</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs_strs</span><span class="p">)</span>
                <span class="n">expr_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ref_str</span><span class="si">}</span><span class="s2">.get_((</span><span class="si">{</span><span class="n">subscripts</span><span class="si">}</span><span class="s2">))&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">variableMap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="ow">and</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">variableMap</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> \
                    <span class="s2">&quot;character&quot;</span><span class="p">:</span>
                <span class="n">subs</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;subscripts&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">subs_strs</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">proc_expr</span><span class="p">(</span><span class="n">subs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subs</span>
                <span class="p">]</span>
                <span class="n">subscripts</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs_strs</span><span class="p">)</span>
                <span class="n">expr_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ref_str</span><span class="si">}</span><span class="s2">.get_substr(</span><span class="si">{</span><span class="n">subscripts</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">expr_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_call</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># scalar variable</span>
            <span class="k">if</span> <span class="n">wrapper</span><span class="p">:</span>
                <span class="n">expr_str</span> <span class="o">=</span> <span class="n">ref_str</span>
            <span class="k">elif</span> <span class="p">(</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;is_arg&quot;</span> <span class="ow">in</span> <span class="n">node</span>
                        <span class="ow">and</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;is_arg&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
                    <span class="p">)</span>
                    <span class="ow">or</span> <span class="n">is_derived_type_ref</span>
                <span class="p">):</span>
                <span class="n">expr_str</span> <span class="o">=</span> <span class="n">ref_str</span>
                <span class="n">is_derived_type_ref</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">ref_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declaredDerivedTVars</span><span class="p">:</span>
                <span class="n">expr_str</span> <span class="o">=</span> <span class="n">ref_str</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">variableMap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ref_str</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">variableMap</span><span class="p">[</span><span class="n">ref_str</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;character&#39;</span><span class="p">:</span>
                <span class="n">expr_str</span> <span class="o">=</span> <span class="n">ref_str</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">expr_str</span> <span class="o">=</span> <span class="n">ref_str</span> <span class="o">+</span> <span class="s2">&quot;[0]&quot;</span>

        <span class="k">return</span> <span class="n">expr_str</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.proc_op"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.proc_op">[docs]</a>    <span class="k">def</span> <span class="nf">proc_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Processes expressions involving operators and returns a string that</span>
<span class="sd">           is the corresponding Python code.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">op_str</span> <span class="o">=</span> <span class="n">OPERATOR_MAP</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;operator&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">For2PyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unhandled operator </span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;operator&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">l_subexpr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_expr</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;right&quot;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="c1"># binary operator</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="n">r_subexpr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_expr</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">expr_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">l_subexpr</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">op_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">r_subexpr</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># unary operator</span>
            <span class="n">expr_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">op_str</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">l_subexpr</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="k">return</span> <span class="n">expr_str</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.proc_expr"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.proc_expr">[docs]</a>    <span class="k">def</span> <span class="nf">proc_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">wrapper</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Processes an expression node and returns a string that is the</span>
<span class="sd">        corresponding Python code. The argument &quot;wrapper&quot; indicates whether or</span>
<span class="sd">        not the Python expression should refer to the list wrapper for (scalar)</span>
<span class="sd">        variables.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
            <span class="n">literal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_literal</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="c1"># If the literal is an argument to a function (when proc_expr has</span>
            <span class="c1"># been called from proc_call), the literal needs to be sent using</span>
            <span class="c1"># a list wrapper (e.g. f([1]) instead of f(1)</span>
            <span class="k">if</span> <span class="n">wrapper</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_call</span> <span class="o">!=</span> <span class="s2">&quot;print&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;char&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;String(</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">literal</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">literal</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">literal</span><span class="si">}</span><span class="s2">]&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">literal</span>

        <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span>
            <span class="c1"># variable or array reference</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_ref</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">wrapper</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;call&quot;</span><span class="p">:</span>
            <span class="c1"># function call</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_call</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="n">expr_str</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;op&quot;</span><span class="p">:</span>
            <span class="c1"># operator</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">wrapper</span>
            <span class="n">expr_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_op</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">expr_str</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;&gt;&gt;&gt; [proc_expr] NULL value: </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">expr_str</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printCall"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printCall">[docs]</a>    <span class="k">def</span> <span class="nf">printCall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="n">call_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_call</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">call_str</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printAst"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printAst">[docs]</a>    <span class="k">def</span> <span class="nf">printAst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;format&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">printFn</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">](</span><span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;if&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;format&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">printFn</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">](</span><span class="n">item</span><span class="p">,</span> <span class="n">printState</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;read&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">initializeFileVars</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">printState</span><span class="o">.</span><span class="n">printFirst</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">printState</span><span class="o">.</span><span class="n">printFirst</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;format&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">printFn</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]](</span><span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printPrivate"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printPrivate">[docs]</a>    <span class="k">def</span> <span class="nf">printPrivate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">prinState</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">privFunctions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printArg"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printArg">[docs]</a>    <span class="k">def</span> <span class="nf">printArg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">TYPE_MAP</span><span class="p">:</span>
                <span class="n">var_type</span> <span class="o">=</span> <span class="n">TYPE_MAP</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
            <span class="k">elif</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;character&quot;</span><span class="p">:</span>
                <span class="n">var_type</span> <span class="o">=</span> <span class="s2">&quot;String&quot;</span>
            <span class="k">elif</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;is_derived_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                <span class="n">var_type</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">For2PyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unrecognized type </span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">arg_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variableMap</span><span class="p">[</span><span class="n">arg_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
            <span class="s2">&quot;parameter&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_type</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">arg_name</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">var_type</span>
        <span class="p">})</span>
        <span class="k">if</span> <span class="s2">&quot;is_array&quot;</span> <span class="ow">in</span> <span class="n">node</span> <span class="ow">and</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;is_array&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">arg_name</span><span class="si">}</span><span class="s2">: Array&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s2">&quot;String&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">arg_name</span><span class="si">}</span><span class="s2">: String&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
                <span class="n">var_type</span> <span class="o">=</span> <span class="s2">&quot;Real&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">arg_name</span><span class="si">}</span><span class="s2">: List[</span><span class="si">{</span><span class="n">var_type</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
        <span class="n">printState</span><span class="o">.</span><span class="n">definedVars</span> <span class="o">+=</span> <span class="p">[</span><span class="n">arg_name</span><span class="p">]</span></div>

    <span class="c1">###########################################################################</span>
    <span class="c1">#                                                                         #</span>
    <span class="c1">#                                STATEMENTS                               #</span>
    <span class="c1">#                                                                         #</span>
    <span class="c1">###########################################################################</span>

<div class="viewcode-block" id="PythonCodeGenerator.printDo"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printDo">[docs]</a>    <span class="k">def</span> <span class="nf">printDo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;for &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
            <span class="n">node</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">],</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">printFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indexRef</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
            <span class="n">node</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">],</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                <span class="n">sep</span><span class="o">=</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">printState</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>
                <span class="n">printFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">indexRef</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printDoWhile"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printDoWhile">[docs]</a>    <span class="k">def</span> <span class="nf">printDoWhile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;while &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
            <span class="n">node</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">],</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">printFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indexRef</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
            <span class="n">node</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">],</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                <span class="n">sep</span><span class="o">=</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">printState</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>
                <span class="n">printFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">indexRef</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printIndex"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printIndex">[docs]</a>    <span class="k">def</span> <span class="nf">printIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="c1"># If the target variable is a saved variable add the</span>
        <span class="c1"># subroutine/function name to it&#39;s prefix.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="p">]:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">[0] in range(&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
            <span class="n">node</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">],</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">printFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indexRef</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
            <span class="n">node</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">],</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">printFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indexRef</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;+1, &quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
                <span class="n">node</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">],</span>
                <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">printFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indexRef</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;+1)&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printIf"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printIf">[docs]</a>    <span class="k">def</span> <span class="nf">printIf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;if &quot;</span><span class="p">)</span>
        <span class="n">newHeaders</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;format&quot;</span><span class="p">:</span>
                <span class="n">newHeaders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
            <span class="n">newHeaders</span><span class="p">,</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">printFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indexRef</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
            <span class="n">node</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">],</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                <span class="n">sep</span><span class="o">=</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">printState</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>
                <span class="n">printFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">indexRef</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;else&quot;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s2">&quot;else:&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
                <span class="n">node</span><span class="p">[</span><span class="s2">&quot;else&quot;</span><span class="p">],</span>
                <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                    <span class="n">sep</span><span class="o">=</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">printState</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>
                    <span class="n">printFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">indexRef</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printOp"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printOp">[docs]</a>    <span class="k">def</span> <span class="nf">printOp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="n">expr_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_expr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expr_str</span><span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printLiteral"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printLiteral">[docs]</a>    <span class="k">def</span> <span class="nf">printLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="n">expr_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_literal</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expr_str</span><span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printRef"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printRef">[docs]</a>    <span class="k">def</span> <span class="nf">printRef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="n">ref_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_ref</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref_str</span><span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printAssignment"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printAssignment">[docs]</a>    <span class="k">def</span> <span class="nf">printAssignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">rhs_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_expr</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lhs</span><span class="p">[</span><span class="s2">&quot;is_derived_type_ref&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
            <span class="n">assg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_derived_type_ref</span><span class="p">(</span>
                <span class="n">lhs</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">lhs</span><span class="p">[</span><span class="s2">&quot;numPartRef&quot;</span><span class="p">]),</span> <span class="kc">True</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">lhs</span><span class="p">[</span><span class="s2">&quot;hasSubscripts&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                    <span class="s2">&quot;subscripts&quot;</span> <span class="ow">in</span> <span class="n">lhs</span>
            <span class="p">),</span> <span class="s2">&quot;lhs &#39;hasSubscripts&#39; and actual &#39;subscripts&#39; existence does &quot;</span> \
               <span class="s2">&quot;not match.</span><span class="se">\</span>
<span class="s2">                                Fix &#39;hasSubscripts&#39; in rectify.py.&quot;</span>
            <span class="c1"># target is an array element</span>
            <span class="k">if</span> <span class="s2">&quot;is_array&quot;</span> <span class="ow">in</span> <span class="n">lhs</span> <span class="ow">and</span> <span class="n">lhs</span><span class="p">[</span><span class="s2">&quot;is_array&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                <span class="n">subs</span> <span class="o">=</span> <span class="n">lhs</span><span class="p">[</span><span class="s2">&quot;subscripts&quot;</span><span class="p">]</span>
                <span class="n">subs_strs</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">proc_expr</span><span class="p">(</span><span class="n">subs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subs</span><span class="p">))</span>
                <span class="p">]</span>
                <span class="n">subscripts</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs_strs</span><span class="p">)</span>
                <span class="n">assg_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lhs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.set_((</span><span class="si">{</span><span class="n">subscripts</span><span class="si">}</span><span class="s2">), &quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">variableMap</span><span class="p">[</span><span class="n">lhs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;character&quot;</span><span class="p">:</span>
                <span class="n">subs</span> <span class="o">=</span> <span class="n">lhs</span><span class="p">[</span><span class="s2">&quot;subscripts&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">subs_strs</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">proc_expr</span><span class="p">(</span><span class="n">subs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subs</span>
                <span class="p">]</span>
                <span class="n">subscripts</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs_strs</span><span class="p">)</span>
                <span class="n">assg_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lhs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.set_substr(</span><span class="si">{</span><span class="n">subscripts</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">variableMap</span><span class="p">[</span><span class="n">lhs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;character&quot;</span><span class="p">:</span>
            <span class="n">assg_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">lhs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">.set_(&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># target is a scalar variable</span>
            <span class="n">assg_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lhs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">[0]&quot;</span>

        <span class="c1"># Check if this is a parameter assignment</span>
        <span class="k">if</span> <span class="n">lhs</span><span class="p">[</span><span class="s2">&quot;is_parameter&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
            <span class="n">parameter_comment</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;  # PARAMETER: </span><span class="si">{</span><span class="n">assg_str</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variableMap</span><span class="p">[</span><span class="n">assg_str</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]][</span><span class="s2">&quot;parameter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">is_parameter</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_parameter</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Check if the rhs string contains a multiplication or division</span>
        <span class="c1"># operation and if so check if the target variable is an integer. In</span>
        <span class="c1"># this case, cast the rhs string with int()</span>
        <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">rhs_str</span> <span class="ow">or</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">rhs_str</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_type</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="p">]:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">lhs</span><span class="p">[</span><span class="s2">&quot;is_derived_type_ref&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">assg_str</span><span class="p">)</span> \
                        <span class="ow">or</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">lhs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]])</span> <span class="ow">and</span> \
                        <span class="n">item</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;int&quot;</span><span class="p">:</span>
                    <span class="n">rhs_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;int(</span><span class="si">{</span><span class="n">rhs_str</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="c1"># If the target variable is a saved variable add the</span>
        <span class="c1"># subroutine/function name to it&#39;s prefix.</span>
        <span class="k">if</span> <span class="n">lhs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="p">]:</span>
            <span class="n">assg_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">assg_str</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Check if the lhs is a real and convert the variable to a numpy float</span>
        <span class="c1"># object if it is</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variableMap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lhs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;REAL&quot;</span>
                <span class="ow">and</span> <span class="n">rhs</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">):</span>
            <span class="n">rhs_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Float32(</span><span class="si">{</span><span class="n">rhs_str</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;set_&quot;</span> <span class="ow">in</span> <span class="n">assg_str</span><span class="p">:</span>
            <span class="c1"># If the assignment is to an array and the value is a string,</span>
            <span class="c1"># a String object has to be created</span>
            <span class="k">if</span> <span class="s2">&quot;is_array&quot;</span> <span class="ow">in</span> <span class="n">lhs</span> <span class="ow">and</span> <span class="n">lhs</span><span class="p">[</span><span class="s2">&quot;is_array&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                <span class="n">check_further</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_map</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lhs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]):</span>
                    <span class="n">check_further</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">check_further</span> <span class="ow">and</span> \
                        <span class="s2">&quot;String&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lhs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]):</span>
                    <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_map</span><span class="p">[</span><span class="n">lhs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]][</span><span class="mi">7</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">assg_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;String(</span><span class="si">{</span><span class="n">length</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">rhs_str</span><span class="si">}</span><span class="s2">))&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">assg_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rhs_str</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">assg_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rhs_str</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">assg_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; = </span><span class="si">{</span><span class="n">rhs_str</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">is_parameter</span><span class="p">:</span>
            <span class="n">assg_str</span> <span class="o">+=</span> <span class="n">parameter_comment</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">assg_str</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printUse"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printUse">[docs]</a>    <span class="k">def</span> <span class="nf">printUse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;include&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;from delphi.translators.for2py.tmp.m_</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;arg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;import </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;include&#39;</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;from delphi.translators.for2py.tmp.m_&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;arg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2"> import *</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printFuncReturn"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printFuncReturn">[docs]</a>    <span class="k">def</span> <span class="nf">printFuncReturn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">printState</span><span class="o">.</span><span class="n">indexRef</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;args&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;return &quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">printCall</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="s2">&quot;[0]&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># TODO: Need to handle not just &quot;op&quot; but call to expressions</span>
                <span class="c1">#  as well. Also, current implementation does not go deep</span>
                <span class="c1">#  enough. This can be arbitrarily deep.</span>
                <span class="k">if</span> <span class="s2">&quot;value&quot;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                            <span class="s2">&quot;left&quot;</span> <span class="ow">in</span> <span class="n">node</span> <span class="ow">and</span>
                            <span class="s2">&quot;operator&quot;</span> <span class="ow">in</span> <span class="n">node</span> <span class="ow">and</span>
                            <span class="s2">&quot;right&quot;</span> <span class="ow">in</span> <span class="n">node</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Something is missing. Detail of node content: </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span>

                    <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span>
                        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_ref</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;call&quot;</span><span class="p">:</span>
                        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_call</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;op&quot;</span><span class="p">:</span>
                        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_op</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">left</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                    <span class="n">operator</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;operator&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span>
                        <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_ref</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;call&quot;</span><span class="p">:</span>
                        <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_call</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;op&quot;</span><span class="p">:</span>
                        <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_op</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">right</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>

                    <span class="n">val</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">operator</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">right</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;return </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printExit"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printExit">[docs]</a>    <span class="k">def</span> <span class="nf">printExit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;print(</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;exit&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;break&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">node</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;return&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;tag: </span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> not being handled yet.&quot;</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printReturn"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printReturn">[docs]</a>    <span class="k">def</span> <span class="nf">printReturn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printOpen"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printOpen">[docs]</a>    <span class="k">def</span> <span class="nf">printOpen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;arg_name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span>
            <span class="n">file_handle</span> <span class="o">=</span> <span class="s2">&quot;file_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span>
            <span class="n">file_handle</span> <span class="o">=</span> <span class="s2">&quot;file_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_handle</span> <span class="o">=</span> <span class="s2">&quot;file_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>

        <span class="c1"># We are making all file handles static i.e. SAVEing them which means</span>
        <span class="c1"># the file handles have to be prefixed with their subroutine/function</span>
        <span class="c1"># names</span>
        <span class="k">if</span> <span class="n">file_handle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="p">]:</span>
            <span class="n">file_handle</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">file_handle</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_handle</span><span class="si">}</span><span class="s2"> = &quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;arg_name&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;arg_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
                    <span class="n">file_name</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                    <span class="n">open_state</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
                <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;arg_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
                    <span class="n">open_state</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                    <span class="n">open_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stateMap</span><span class="p">[</span><span class="n">open_state</span><span class="p">]</span>

        <span class="c1"># If the file_name has quotes at the beginning and end, remove them</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">file_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">file_name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="n">file_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">and</span> <span class="n">file_name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">):</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;open(&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">&quot;, &quot;</span><span class="si">{</span><span class="n">open_state</span><span class="si">}</span><span class="s1">&quot;)&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printRead"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printRead">[docs]</a>    <span class="k">def</span> <span class="nf">printRead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="n">file_number</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;int&quot;</span><span class="p">:</span>
            <span class="n">file_handle</span> <span class="o">=</span> <span class="s2">&quot;file_&quot;</span> <span class="o">+</span> <span class="n">file_number</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;int&quot;</span><span class="p">:</span>
            <span class="n">format_label</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>

        <span class="c1"># We are making all file handles static i.e. SAVEing them which means</span>
        <span class="c1"># the file handles have to be prefixed with their subroutine/function</span>
        <span class="c1"># names</span>
        <span class="k">if</span> <span class="n">file_handle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="p">]:</span>
            <span class="n">file_handle</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">file_handle</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">isArray</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">tempInd</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="s2">&quot;subscripts&quot;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">array_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tempVar = [0] * </span><span class="si">{</span><span class="n">array_len</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>

        <span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span>
                <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span>
                <span class="k">if</span> <span class="s2">&quot;subscripts&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="n">isArray</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tempVar[</span><span class="si">{</span><span class="n">tempInd</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
                    <span class="n">tempInd</span> <span class="o">=</span> <span class="n">tempInd</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">[0]&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ind</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;,) = format_</span><span class="si">{</span><span class="n">format_label</span><span class="si">}</span><span class="s2">_obj.&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;read_line(</span><span class="si">{</span><span class="n">file_handle</span><span class="si">}</span><span class="s2">.readline())&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">isArray</span><span class="p">:</span>
            <span class="n">tempInd</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Re-initialize to zero for array index</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span>
                    <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="s2">&quot;subscripts&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">.set_((&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
                            <span class="n">item</span><span class="p">[</span><span class="s2">&quot;subscripts&quot;</span><span class="p">],</span>
                            <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                                <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="p">,</span>
                                <span class="n">add</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                <span class="n">printFirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">indexRef</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="p">),</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;), tempVar[</span><span class="si">{</span><span class="n">tempInd</span><span class="si">}</span><span class="s2">])&quot;</span><span class="p">)</span>
                        <span class="n">tempInd</span> <span class="o">=</span> <span class="n">tempInd</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printWrite"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printWrite">[docs]</a>    <span class="k">def</span> <span class="nf">printWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="n">write_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># Check whether write to file or output stream</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
            <span class="n">write_target</span> <span class="o">=</span> <span class="s2">&quot;outStream&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">write_target</span> <span class="o">=</span> <span class="s2">&quot;file&quot;</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]:</span>
                <span class="n">file_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span>
                <span class="n">file_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)])</span>
            <span class="n">file_handle</span> <span class="o">=</span> <span class="s2">&quot;file_&quot;</span> <span class="o">+</span> <span class="n">file_id</span>

            <span class="c1"># We are making all file handles static i.e. SAVEing them which</span>
            <span class="c1"># means the file handles have to be prefixed with their</span>
            <span class="c1"># subroutine/function names</span>
            <span class="k">if</span> <span class="n">file_handle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="p">]:</span>
                <span class="n">file_handle</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">file_handle</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Check whether format has been specified</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
            <span class="n">format_type</span> <span class="o">=</span> <span class="s2">&quot;runtime&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">format_type</span> <span class="o">=</span> <span class="s2">&quot;specifier&quot;</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;int&quot;</span><span class="p">:</span>
                <span class="n">format_label</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">write_target</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;write_list_</span><span class="si">{</span><span class="n">file_id</span><span class="si">}</span><span class="s2"> = &quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">write_target</span> <span class="o">==</span> <span class="s2">&quot;outStream&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;write_list_stream = &quot;</span><span class="p">)</span>

        <span class="c1"># Collect the expressions to be written out. The first two arguments to</span>
        <span class="c1"># a WRITE statement are the output stream and the format, so these are</span>
        <span class="c1"># skipped.</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="s2">&quot;is_derived_type_ref&quot;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="ow">and</span> <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;is_derived_type_ref&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
            <span class="p">):</span>
                <span class="n">args_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_derived_type_ref</span><span class="p">(</span>
                        <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;numPartRef&quot;</span><span class="p">]),</span> <span class="kc">False</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proc_expr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="kc">False</span><span class="p">))</span>

        <span class="n">write_string</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args_str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">write_string</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>

        <span class="c1"># If format specified and output in a file, execute write_line on file</span>
        <span class="c1"># handler</span>
        <span class="k">if</span> <span class="n">write_target</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">format_type</span> <span class="o">==</span> <span class="s2">&quot;specifier&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;write_line = format_</span><span class="si">{</span><span class="n">format_label</span><span class="si">}</span><span class="s2">_obj.&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;write_line(write_list_</span><span class="si">{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_handle</span><span class="si">}</span><span class="s2">.write(write_line)&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">format_type</span> <span class="o">==</span> <span class="s2">&quot;runtime&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;output_fmt = list_output_formats([&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">write_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
                    <span class="n">varMatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                        <span class="sa">r</span><span class="s2">&quot;^(.*?)\[\d+\]|^(.*?)[^\[]&quot;</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">varMatch</span><span class="p">:</span>
                        <span class="n">var</span> <span class="o">=</span> <span class="n">varMatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variableMap</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span><span class="si">}</span><span class="s1">&quot;,&#39;</span>
                        <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;])&quot;</span> <span class="o">+</span> <span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;write_stream_obj = Format(output_fmt)&quot;</span> <span class="o">+</span> <span class="n">printState</span><span class="o">.</span><span class="n">sep</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;write_line = write_stream_obj.&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;write_line(write_list_</span><span class="si">{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_handle</span><span class="si">}</span><span class="s2">.write(write_line)&quot;</span><span class="p">)</span>

        <span class="c1"># If printing on stdout, handle accordingly</span>
        <span class="k">elif</span> <span class="n">write_target</span> <span class="o">==</span> <span class="s2">&quot;outStream&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">format_type</span> <span class="o">==</span> <span class="s2">&quot;runtime&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;output_fmt = list_output_formats([&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">write_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
                    <span class="c1"># self.pyStrings.append(f&quot;{var},&quot;)</span>
                    <span class="n">varMatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                        <span class="sa">r</span><span class="s2">&quot;^(.*?)\[\d+\]|^(.*?)[^\[]&quot;</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">varMatch</span><span class="p">:</span>
                        <span class="n">var</span> <span class="o">=</span> <span class="n">varMatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variableMap</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span><span class="si">}</span><span class="s1">&quot;,&#39;</span>
                        <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;])&quot;</span> <span class="o">+</span> <span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;write_stream_obj = Format(output_fmt)&quot;</span> <span class="o">+</span> <span class="n">printState</span><span class="o">.</span><span class="n">sep</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;write_line = write_stream_obj.&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;write_line(write_list_stream)&quot;</span>
                    <span class="o">+</span> <span class="n">printState</span><span class="o">.</span><span class="n">sep</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;sys.stdout.write(write_line)&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">format_type</span> <span class="o">==</span> <span class="s2">&quot;specifier&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;write_line = format_</span><span class="si">{</span><span class="n">format_label</span><span class="si">}</span><span class="s2">_obj.&quot;</span>
                    <span class="s2">&quot;write_line(write_list_stream)&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sys.stdout.write(write_line)&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printFormat"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printFormat">[docs]</a>    <span class="k">def</span> <span class="nf">printFormat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="n">type_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">temp_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_re_int</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\d+$&quot;</span><span class="p">)</span>
        <span class="n">format_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]]</span>

        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">format_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_re_int</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>
                <span class="n">temp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">type_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_list</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="n">temp_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">type_list</span> <span class="o">=</span> <span class="n">temp_list</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;format_</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;format_</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printVariable</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;format_&quot;</span> <span class="o">+</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;STRING&quot;</span><span class="p">},</span> <span class="n">printState</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format_dict</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">type_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;format_</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">type_list</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;format_</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_obj = Format(format_</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printClose"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printClose">[docs]</a>    <span class="k">def</span> <span class="nf">printClose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="n">file_id</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;file_</span><span class="si">{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">.close()&quot;</span><span class="p">)</span></div>

    <span class="c1">###########################################################################</span>
    <span class="c1">#                                                                         #</span>
    <span class="c1">#                              DECLARATIONS                               #</span>
    <span class="c1">#                                                                         #</span>
    <span class="c1">###########################################################################</span>

<div class="viewcode-block" id="PythonCodeGenerator.printVariable"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printVariable">[docs]</a>    <span class="k">def</span> <span class="nf">printVariable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="n">var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="n">var_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">printState</span><span class="o">.</span><span class="n">definedVars</span> <span class="o">+</span> <span class="n">printState</span><span class="o">.</span><span class="n">globalVars</span>
                <span class="ow">and</span> <span class="n">var_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span> <span class="ow">and</span> <span class="n">var_name</span> <span class="ow">not</span> <span class="ow">in</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">definedVars</span> <span class="o">+=</span> <span class="p">[</span><span class="n">var_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
                    <span class="c1"># initVal = node[&quot;value&quot;][0][&quot;value&quot;]</span>
                    <span class="n">initVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_literal</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;op&quot;</span><span class="p">:</span>
                    <span class="n">initVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_op</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Tag </span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span> \
                        <span class="sa">f</span><span class="s2">&quot;currently not handled yet.&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">initVal</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">varType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;op&quot;</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">initVal</span> <span class="ow">or</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">initVal</span><span class="p">)</span> <span class="ow">and</span> <span class="n">varType</span> <span class="o">==</span> <span class="s2">&quot;int&quot;</span><span class="p">:</span>
                <span class="n">initVal</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;int(</span><span class="si">{</span><span class="n">initVal</span><span class="si">}</span><span class="s2">)&quot;</span>

            <span class="k">if</span> <span class="s2">&quot;is_derived_type&quot;</span> <span class="ow">in</span> <span class="n">node</span> <span class="ow">and</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;is_derived_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span><span class="si">}</span><span class="s2"> =  </span><span class="si">{</span><span class="n">varType</span><span class="si">}</span><span class="s2">()&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">declaredDerivedTVars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">printState</span><span class="o">.</span><span class="n">functionScope</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">funcArgs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                            <span class="n">printState</span><span class="o">.</span><span class="n">functionScope</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">: List[</span><span class="si">{</span><span class="n">varType</span><span class="si">}</span><span class="s2">]&quot;</span> <span class="sa">f</span><span class="s2">&quot; = [</span><span class="si">{</span><span class="n">initVal</span><span class="si">}</span><span class="s2">]&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">: List[</span><span class="si">{</span><span class="n">varType</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;is_string&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;is_string&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">initVal</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> = &quot;</span>
                                              <span class="sa">f</span><span class="s2">&quot;String(</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s1"> = &#39;</span>
                                              <span class="sa">f</span><span class="s1">&#39;String(</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, &#39;</span>
                                              <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">initVal</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">: List[</span><span class="si">{</span><span class="n">varType</span><span class="si">}</span><span class="s2">] = &quot;</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">initVal</span><span class="si">}</span><span class="s2">]&quot;</span>
                    <span class="p">)</span>

            <span class="c1"># The code below might cause issues on unexpected places.</span>
            <span class="c1"># If weird variable declarations appear, check code below</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">:</span>
                <span class="n">printState</span><span class="o">.</span><span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variableMap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                <span class="s2">&quot;parameter&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the variable is a saved variable, add its type mapping to</span>
            <span class="c1"># self.var_type</span>
            <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="p">]:</span>
                <span class="n">varType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variableMap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                <span class="s2">&quot;parameter&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">printFirst</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printArray"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printArray">[docs]</a>    <span class="k">def</span> <span class="nf">printArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Prints out the array declaration in a format of Array class</span>
<span class="sd">            object declaration. &#39;arrayName = Array(Type, [bounds])&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">printState</span><span class="o">.</span><span class="n">definedVars</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">printState</span><span class="o">.</span><span class="n">globalVars</span>
        <span class="p">):</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">definedVars</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]]</span>
            <span class="n">var_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="c1"># If the array has string elements, then we need the length</span>
            <span class="c1"># information as well</span>
            <span class="k">if</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s2">&quot;character&quot;</span><span class="p">:</span>
                <span class="n">var_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;String(</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">array_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">var_type</span>
            <span class="n">array_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_array_dimension</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

            <span class="c1"># If the printArray function is being called from printSave,</span>
            <span class="c1"># is_save will be True and the argument to the decorator is</span>
            <span class="c1"># returned.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_save</span><span class="p">:</span>
                <span class="n">save_argument</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">{{</span><span class="s1">&quot;name&quot;: &quot;</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;, &quot;call&quot;: Array&#39;</span> \
                    <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="n">var_type</span><span class="si">}</span><span class="s1">, [</span><span class="si">{</span><span class="n">array_range</span><span class="si">}</span><span class="s1">]), &quot;type&quot;: &#39;</span> \
                    <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">TYPE_MAP</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="si">}</span><span class="s1">&quot;</span><span class="se">}}</span><span class="s1">&#39;</span>
                <span class="k">return</span> <span class="n">save_argument</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If the array variable is not SAVEd, print the</span>
                <span class="c1"># initialization of the array</span>
                <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span><span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> = Array(</span><span class="si">{</span><span class="n">var_type</span><span class="si">}</span><span class="s2">, [</span><span class="si">{</span><span class="n">array_range</span><span class="si">}</span><span class="s2">])&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If it is SAVEd, don&#39;t print the initialization code and</span>
                    <span class="c1"># instead delete the remnant empty line.</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printDerivedType"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printDerivedType">[docs]</a>    <span class="k">def</span> <span class="nf">printDerivedType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="n">derived_type_class_info</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">derived_type_variables</span> <span class="o">=</span> <span class="n">derived_type_class_info</span><span class="p">[</span><span class="s2">&quot;derived-types&quot;</span><span class="p">]</span>
        <span class="n">num_of_variables</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">derived_type_variables</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;class </span><span class="si">{</span><span class="n">derived_type_class_info</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># For a record, store the declared derived type names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declaredDerivedTypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">derived_type_class_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    def __init__(self):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_of_variables</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">derived_type_variables</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

            <span class="c1"># Retrieve the type of member variables and check its type</span>
            <span class="n">var_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">derived_type_variables</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var_type</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">derived_type_class_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                                     <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">derived_type_variables</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">var_type</span>
                    <span class="p">})</span>
            <span class="n">is_derived_type_declaration</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># If the type is not one of the default types, but it&#39;s</span>
            <span class="c1"># a declared derived type, set the is_derived_type_declaration</span>
            <span class="c1"># to True as the declaration of variable with such type has</span>
            <span class="c1"># different declaration syntax from the default type variables.</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">var_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TYPE_MAP</span>
                    <span class="ow">and</span> <span class="n">var_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declaredDerivedTypes</span>
            <span class="p">):</span>
                <span class="n">is_derived_type_declaration</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">derived_type_variables</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="s2">&quot;is_array&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_derived_type_declaration</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s2">&quot;String&quot;</span><span class="p">:</span>
                        <span class="n">str_length</span> <span class="o">=</span> <span class="n">derived_type_variables</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="s2">&quot;length&quot;</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;        self.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">var_type</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">str_length</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>

                        <span class="k">if</span> <span class="s2">&quot;value&quot;</span> <span class="ow">in</span> <span class="n">derived_type_variables</span><span class="p">[</span><span class="n">var</span><span class="p">]:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_literal</span><span class="p">(</span>
                                <span class="n">derived_type_variables</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;, </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        self.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">var_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="s2">&quot;value&quot;</span> <span class="ow">in</span> <span class="n">derived_type_variables</span><span class="p">[</span><span class="n">var</span><span class="p">]:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_literal</span><span class="p">(</span>
                                <span class="n">derived_type_variables</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; = </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;        self.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">var_type</span><span class="si">}</span><span class="s2">()&quot;</span>
                    <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">array_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_array_dimension</span><span class="p">(</span>
                    <span class="n">derived_type_variables</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s2">&quot;character&quot;</span><span class="p">:</span>
                    <span class="n">var_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;String(&quot;</span> \
                               <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">derived_type_variables</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="s1">&#39;length&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;        self.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> = Array(</span><span class="si">{</span><span class="n">var_type</span><span class="si">}</span><span class="s2">, [</span><span class="si">{</span><span class="n">array_range</span><span class="si">}</span><span class="s2">])&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">printSave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function adds the Python string to handle Fortran SAVE</span>
<span class="sd">        statements. It adds a decorator above a function definition and makes</span>
<span class="sd">        a call to static_save function with the list of saved variables as</span>
<span class="sd">        its argument.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_save</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span>
                <span class="n">to_delete</span> <span class="o">=</span> <span class="n">item</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">@static_vars([&quot;</span><span class="p">)</span>
                <span class="n">variables</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;var_list&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">var</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;open&quot;</span><span class="p">:</span>
                        <span class="n">variable_type</span> <span class="o">=</span> <span class="s2">&quot;file_handle&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">variable_type</span> <span class="o">=</span> <span class="n">TYPE_MAP</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
                    <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">var</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;array&quot;</span><span class="p">:</span>
                        <span class="c1"># Call printArray to get the initialization code for</span>
                        <span class="c1"># Array declaration. This will be on the argument to</span>
                        <span class="c1"># the decorator.</span>
                        <span class="n">save_argument</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">printArray</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">printState</span><span class="p">)</span>
                        <span class="n">variables</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">save_argument</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="k">elif</span> <span class="n">var</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">var</span><span class="p">[</span><span class="s2">&quot;is_derived_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                            <span class="n">save_argument</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="s2">&#39;name&#39;: &#39;</span><span class="si">{</span><span class="n">var</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;, &quot;</span> \
                                <span class="sa">f</span><span class="s2">&quot;&#39;call&#39;: </span><span class="si">{</span><span class="n">var</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">(), &#39;type&#39;: &quot;</span> \
                                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">variable_type</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">}}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;        self.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">var_type</span><span class="si">}</span><span class="s2">()&quot;</span>
                    <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">array_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_array_dimension</span><span class="p">(</span>
                    <span class="n">derived_type_variables</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;        self.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> = Array(</span><span class="si">{</span><span class="n">var_type</span><span class="si">}</span><span class="s2">, [</span><span class="si">{</span><span class="n">array_range</span><span class="si">}</span><span class="s2">])&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>

<div class="viewcode-block" id="PythonCodeGenerator.printSave"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printSave">[docs]</a>    <span class="k">def</span> <span class="nf">printSave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function adds the Python string to handle Fortran SAVE</span>
<span class="sd">        statements. It adds a decorator above a function definition and makes</span>
<span class="sd">        a call to static_save function with the list of saved variables as</span>
<span class="sd">        its argument.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_save</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span>
                <span class="n">to_delete</span> <span class="o">=</span> <span class="n">item</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">@static_vars([&quot;</span><span class="p">)</span>
                <span class="n">variables</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;var_list&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">var</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;open&quot;</span><span class="p">:</span>
                        <span class="n">variable_type</span> <span class="o">=</span> <span class="s2">&quot;file_handle&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">variable_type</span> <span class="o">=</span> <span class="n">TYPE_MAP</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
                    <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">var</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;array&quot;</span><span class="p">:</span>
                        <span class="c1"># Call printArray to get the initialization code for</span>
                        <span class="c1"># Array declaration. This will be on the argument to</span>
                        <span class="c1"># the decorator.</span>
                        <span class="n">save_argument</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">printArray</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">printState</span><span class="p">)</span>
                        <span class="n">variables</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">save_argument</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="k">elif</span> <span class="n">var</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">var</span><span class="p">[</span><span class="s2">&quot;is_derived_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                            <span class="n">save_argument</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="s2">&#39;name&#39;: &#39;</span><span class="si">{</span><span class="n">var</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;, &quot;</span> \
                                <span class="sa">f</span><span class="s2">&quot;&#39;call&#39;: </span><span class="si">{</span><span class="n">var</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">(), &#39;type&#39;: &quot;</span> \
                                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">variable_type</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">}}</span><span class="s2">&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">save_argument</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">var</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                                             <span class="s2">&quot;call&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">],</span>
                                             <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">variable_type</span><span class="p">}</span>
                        <span class="n">variables</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">save_argument</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="k">elif</span> <span class="n">var</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;open&quot;</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;file_</span><span class="si">{</span><span class="n">var</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">saved_variables</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="n">save_argument</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="s2">&#39;name&#39;: &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;, &#39;call&#39;: None, &quot;</span> \
                            <span class="sa">f</span><span class="s2">&quot;&#39;type&#39;: &#39;file_handle&#39;</span><span class="se">}}</span><span class="s2">&quot;</span>
                        <span class="n">variables</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">save_argument</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variables</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">])&quot;</span><span class="p">)</span>
                <span class="n">node</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">to_delete</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_save</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printContinue"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printContinue">[docs]</a>    <span class="k">def</span> <span class="nf">printContinue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function simply adds python statement &quot;continue&quot;</span>
<span class="sd">        that is equivalent to &quot;cycle&quot; in Fortran.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
                <span class="n">node</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;cycle&quot;</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Tag must be &lt;cycle&gt; for &lt;continue&gt; statement.</span><span class="se">\</span>
<span class="s2">            current: </span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;continue&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printSelect"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printSelect">[docs]</a>    <span class="k">def</span> <span class="nf">printSelect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function converts the select-case statement in Fortran into an</span>
<span class="sd">        if-else statement block in Python</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">arg</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_select</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_ref</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_started</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">],</span> <span class="n">printState</span><span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printCase"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printCase">[docs]</a>    <span class="k">def</span> <span class="nf">printCase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function handles each CASE statement block. This relates to one</span>
<span class="sd">        if-block in Python</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;args&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_started</span><span class="p">:</span>
                <span class="c1"># self.pyStrings.append(&quot;if &quot;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">case_started</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;else:&quot;</span><span class="o">+</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="n">printState</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
                <span class="n">printState</span><span class="o">.</span><span class="n">sep</span> <span class="o">+=</span> <span class="n">printState</span><span class="o">.</span><span class="n">add</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;if &quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; or (&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;case_range&quot;</span><span class="p">:</span>
                    <span class="n">arguments</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span>
                    <span class="n">select_string</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\[.*\]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_select</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">variableMap</span><span class="p">[</span><span class="n">select_string</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> \
                            <span class="o">==</span> <span class="s2">&quot;character&quot;</span><span class="p">:</span>
                        <span class="n">check_variable</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_select</span><span class="si">}</span><span class="s2">.__str__()&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">check_variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_select</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">check_variable</span><span class="si">}</span><span class="s2"> == &quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
                            <span class="n">arg</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">],</span>
                            <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                                <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">left_arg</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">right_arg</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">left_arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span> <span class="ow">and</span> \
                           <span class="n">left_arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&#39;-Inf&#39;&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">check_variable</span><span class="si">}</span><span class="s2"> &lt;= &quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">right_arg</span><span class="p">],</span>
                                <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                                    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="k">elif</span> <span class="n">right_arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span> <span class="ow">and</span>  \
                                <span class="n">right_arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&#39;Inf&#39;&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">check_variable</span><span class="si">}</span><span class="s2"> &gt;= &quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">left_arg</span><span class="p">],</span>
                                <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                                    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">check_variable</span><span class="si">}</span><span class="s2"> &gt;= &quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">left_arg</span><span class="p">],</span>
                                <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                                    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; and &quot;</span>
                                                  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">check_variable</span><span class="si">}</span><span class="s2"> &lt;= &quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">right_arg</span><span class="p">],</span>
                                <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                                    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Invalid length of case arguments &quot;</span> \
                                      <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unhandled case argument </span><span class="si">{</span><span class="n">arg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tag&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;else:&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span>
            <span class="n">node</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">],</span>
            <span class="n">printState</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                <span class="n">sep</span><span class="o">=</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">printState</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>
                <span class="n">printFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">indexRef</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.printInterface"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.printInterface">[docs]</a>    <span class="k">def</span> <span class="nf">printInterface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function definition is simply a place holder for INTERFACE</span>
<span class="sd">        just in case of any possible usage in the future. For now, it does</span>
<span class="sd">        nothing and pass. Since translate.py also passes interface, this</span>
<span class="sd">        should not be encountered in any case.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;In printInterface function, which should not be in any case.&quot;</span></div>

    <span class="c1">###########################################################################</span>
    <span class="c1">#                                                                         #</span>
    <span class="c1">#                              MISCELLANEOUS                              #</span>
    <span class="c1">#                                                                         #</span>
    <span class="c1">###########################################################################</span>

<div class="viewcode-block" id="PythonCodeGenerator.initializeFileVars"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.initializeFileVars">[docs]</a>    <span class="k">def</span> <span class="nf">initializeFileVars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">printState</span><span class="p">:</span> <span class="n">PrintState</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
        <span class="n">data_type</span> <span class="o">=</span> <span class="n">list_data_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_dict</span><span class="p">[</span><span class="n">label</span><span class="p">])</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">printVariable</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]],</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">data_type</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                    <span class="p">},</span>
                    <span class="n">printState</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printState</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.nameMapping"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.nameMapping">[docs]</a>    <span class="k">def</span> <span class="nf">nameMapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ast</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ast</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">inner</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="n">inner</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nameMapping</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="n">inner</span><span class="p">])</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.get_python_source"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.get_python_source">[docs]</a>    <span class="k">def</span> <span class="nf">get_python_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">imports</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imports</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">imports</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">imports</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">programName</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">programName</span><span class="si">}</span><span class="s2">()</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyStrings</span><span class="p">)</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.get_range"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.get_range">[docs]</a>    <span class="k">def</span> <span class="nf">get_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function will construct the range string in &#39;loBound,</span>
<span class="sd">           Upbound&#39; format and return to the called function&quot;&quot;&quot;</span>

        <span class="c1"># [0]: lower bound</span>
        <span class="c1"># [1]: upper bound</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">retrieved_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">],</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_bound</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">retrieved_bounds</span><span class="p">)</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.get_bound"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.get_bound">[docs]</a>    <span class="k">def</span> <span class="nf">get_bound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">retrieved_bounds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function will fill the bounds list with appropriately</span>
<span class="sd">        retrieved bounds from the node.&quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">bound</span> <span class="ow">in</span> <span class="n">retrieved_bounds</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
                <span class="n">bounds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_literal</span><span class="p">(</span><span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;op&quot;</span><span class="p">:</span>
                <span class="n">bounds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_op</span><span class="p">(</span><span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span>
                <span class="n">bounds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_ref</span><span class="p">(</span><span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unrecognized tag in retrieved_bound: &quot;</span> \
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.get_derived_type_ref"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.get_derived_type_ref">[docs]</a>    <span class="k">def</span> <span class="nf">get_derived_type_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">numPartRef</span><span class="p">,</span> <span class="n">is_assignment</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function forms a derived type reference</span>
<span class="sd">        and return to the caller&quot;&quot;&quot;</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;hasSubscripts&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
            <span class="n">subscript</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;subscripts&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">subscript</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">subscript</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">[0]&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">subscript</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">numPartRef</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_assignment</span><span class="p">:</span>
                <span class="n">ref</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.get_(</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ref</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.set_(</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">, &quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ref</span> <span class="o">+=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="n">numPartRef</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="s2">&quot;ref&quot;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">derived_type_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_derived_type_ref</span><span class="p">(</span>
                <span class="n">node</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">numPartRef</span><span class="p">,</span> <span class="n">is_assignment</span><span class="p">)</span>
            <span class="n">ref</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">derived_type_ref</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">ref</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.get_type"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.get_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This function checks the type of a variable and returns</span>
<span class="sd">            the appropriate Python syntax type name. &quot;&quot;&quot;</span>

        <span class="n">variable_type</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameMapper</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">variable_type</span> <span class="ow">in</span> <span class="n">TYPE_MAP</span><span class="p">:</span>
            <span class="n">mapped_type</span> <span class="o">=</span> <span class="n">TYPE_MAP</span><span class="p">[</span><span class="n">variable_type</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_derived_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_default_var_type</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">mapped_type</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">mapped_type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;is_derived_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">variable_type</span> <span class="o">==</span> <span class="s2">&quot;character&quot;</span><span class="p">:</span>
                    <span class="n">variable_type</span> <span class="o">=</span> <span class="s2">&quot;String&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_default_var_type</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">variable_type</span><span class="p">)</span>
                <span class="c1"># Add each element of the derived type into self.var_type as</span>
                <span class="c1"># well</span>
                <span class="k">if</span> <span class="n">variable_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_type</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_type</span><span class="p">[</span><span class="n">variable_type</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">var_type</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">var</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">var</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
                        <span class="p">})</span>
            <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">node</span><span class="p">[</span><span class="s2">&quot;is_derived_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span>
                    <span class="ow">and</span> <span class="n">variable_type</span> <span class="o">==</span> <span class="s2">&quot;character&quot;</span>
            <span class="p">):</span>
                <span class="n">variable_type</span> <span class="o">==</span> <span class="s2">&quot;str&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_default_var_type</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">variable_type</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unrecognized variable type: </span><span class="si">{</span><span class="n">variable_type</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="k">return</span> <span class="n">variable_type</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.set_default_var_type"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.set_default_var_type">[docs]</a>    <span class="k">def</span> <span class="nf">set_default_var_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">var_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This function sets the default variable type of the declared</span>
<span class="sd">        variable.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">var_type</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_module</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">var_name</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">var_type</span>
        <span class="p">})</span></div>

<div class="viewcode-block" id="PythonCodeGenerator.get_array_dimension"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.PythonCodeGenerator.get_array_dimension">[docs]</a>    <span class="k">def</span> <span class="nf">get_array_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This function is for extracting the dimensions&#39; range information</span>
<span class="sd">            from the AST. This function is needed for handling a multi-dimensional</span>
<span class="sd">            array(s). &quot;&quot;&quot;</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">array_range</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;dimensions&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="s2">&quot;literal&quot;</span> <span class="ow">in</span> <span class="n">dimension</span>
            <span class="p">):</span>  <span class="c1"># A case where no explicit low bound set</span>
                <span class="n">upBound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_literal</span><span class="p">(</span><span class="n">dimension</span><span class="p">[</span><span class="s2">&quot;literal&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">array_range</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;(0, </span><span class="si">{</span><span class="n">upBound</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">elif</span> <span class="p">(</span>
                    <span class="s2">&quot;range&quot;</span> <span class="ow">in</span> <span class="n">dimension</span>
            <span class="p">):</span>  <span class="c1"># A case where explicit low and up bounds are set</span>
                <span class="n">array_range</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">dimension</span><span class="p">[</span><span class="s1">&#39;range&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">elif</span> <span class="p">(</span>
                    <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">dimension</span>
            <span class="p">):</span> <span class="c1"># A case where variable name given as a size with no explicit lower bound.</span>
                <span class="n">array_range</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;(0, </span><span class="si">{</span><span class="n">dimension</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Array range case not handled. Reference node content: </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]):</span>
                <span class="n">array_range</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">array_range</span></div></div>


<div class="viewcode-block" id="index_modules"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.index_modules">[docs]</a><span class="k">def</span> <span class="nf">index_modules</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Counts the number of modules in the Fortran file including the program</span>
<span class="sd">        file. Each module is written out into a separate Python file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">module_index_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">node</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">),</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;module&quot;</span><span class="p">,</span> <span class="s2">&quot;program&quot;</span><span class="p">,</span> <span class="s2">&quot;subroutine&quot;</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">module_index_dict</span></div>


<div class="viewcode-block" id="get_python_sources_and_variable_map"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.get_python_sources_and_variable_map">[docs]</a><span class="k">def</span> <span class="nf">get_python_sources_and_variable_map</span><span class="p">(</span><span class="n">outputDict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
    <span class="n">module_index_dict</span> <span class="o">=</span> <span class="n">index_modules</span><span class="p">(</span><span class="n">outputDict</span><span class="p">[</span><span class="s2">&quot;ast&quot;</span><span class="p">])</span>
    <span class="n">py_sourcelist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">main_ast</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">import_lines</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;import sys&quot;</span><span class="p">,</span>
        <span class="s2">&quot;from typing import List&quot;</span><span class="p">,</span>
        <span class="s2">&quot;import math&quot;</span><span class="p">,</span>
        <span class="s2">&quot;from delphi.translators.for2py.format import *&quot;</span><span class="p">,</span>
        <span class="s2">&quot;from delphi.translators.for2py.arrays import *&quot;</span><span class="p">,</span>
        <span class="s2">&quot;from delphi.translators.for2py.static_save import *&quot;</span><span class="p">,</span>
        <span class="s2">&quot;from delphi.translators.for2py.strings import *&quot;</span><span class="p">,</span>
        <span class="s2">&quot;from dataclasses import dataclass&quot;</span><span class="p">,</span>
        <span class="s2">&quot;from delphi.translators.for2py.types_ext import Float32&quot;</span><span class="p">,</span>
        <span class="s2">&quot;import delphi.translators.for2py.math_ext as math&quot;</span><span class="p">,</span>
        <span class="s2">&quot;from numbers import Real&quot;</span><span class="p">,</span>
        <span class="s2">&quot;from random import random</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">module_index_dict</span><span class="p">:</span>
        <span class="n">code_generator</span> <span class="o">=</span> <span class="n">PythonCodeGenerator</span><span class="p">()</span>
        <span class="n">code_generator</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">import_lines</span><span class="p">))</span>
        <span class="k">if</span> <span class="s2">&quot;module&quot;</span> <span class="ow">in</span> <span class="n">module_index_dict</span><span class="p">[</span><span class="n">module</span><span class="p">]:</span>
            <span class="n">ast</span> <span class="o">=</span> <span class="p">[</span><span class="n">outputDict</span><span class="p">[</span><span class="s2">&quot;ast&quot;</span><span class="p">][</span><span class="n">module_index_dict</span><span class="p">[</span><span class="n">module</span><span class="p">][</span><span class="mi">1</span><span class="p">]]]</span>
            <span class="c1"># Copy the derived type ast from the main_ast into the separate list,</span>
            <span class="c1"># so it can be printed outside (above) the main method</span>
            <span class="n">derived_type_ast</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ast</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;body&quot;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="s2">&quot;is_derived_type&quot;</span> <span class="ow">in</span> <span class="n">index</span> <span class="ow">and</span> <span class="n">index</span><span class="p">[</span><span class="s2">&quot;is_derived_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;tag&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
                        <span class="n">derived_type_ast</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                        <span class="n">ast</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;body&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="c1"># Print derived type declaration(s)</span>
            <span class="k">if</span> <span class="n">derived_type_ast</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">derived_type_ast</span><span class="p">)):</span>
                    <span class="n">code_generator</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">@dataclass&quot;</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">derived_type_ast</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;is_derived_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
                    <span class="p">),</span> <span class="s2">&quot;[derived_type_ast] holds non-derived type ast&quot;</span>
                    <span class="n">code_generator</span><span class="o">.</span><span class="n">nameMapping</span><span class="p">([</span><span class="n">derived_type_ast</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                    <span class="n">code_generator</span><span class="o">.</span><span class="n">printDerivedType</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">derived_type_ast</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">PrintState</span><span class="p">()</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">main_ast</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outputDict</span><span class="p">[</span><span class="s2">&quot;ast&quot;</span><span class="p">][</span><span class="n">module_index_dict</span><span class="p">[</span><span class="n">module</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">continue</span>

        <span class="c1"># Fill the name mapper dictionary</span>
        <span class="n">code_generator</span><span class="o">.</span><span class="n">nameMapping</span><span class="p">(</span><span class="n">ast</span><span class="p">)</span>
        <span class="n">code_generator</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">PrintState</span><span class="p">())</span>
        <span class="n">py_sourcelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">code_generator</span><span class="o">.</span><span class="n">get_python_source</span><span class="p">(),</span>
                <span class="n">module</span><span class="p">,</span>
                <span class="n">module_index_dict</span><span class="p">[</span><span class="n">module</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Writing the main program section</span>
    <span class="n">code_generator</span> <span class="o">=</span> <span class="n">PythonCodeGenerator</span><span class="p">()</span>
    <span class="n">code_generator</span><span class="o">.</span><span class="n">functions</span> <span class="o">=</span> <span class="n">outputDict</span><span class="p">[</span><span class="s2">&quot;functionList&quot;</span><span class="p">]</span>
    <span class="n">code_generator</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">import_lines</span><span class="p">))</span>

    <span class="c1"># Some Fortran files do not hold any PROGRAM function, such as files created</span>
    <span class="c1"># for module holder purpose.</span>
    <span class="k">if</span> <span class="n">main_ast</span><span class="p">:</span>
        <span class="c1"># Copy the derived type ast from the main_ast into the separate list,</span>
        <span class="c1"># so it can be printed outside (above) the main method</span>
        <span class="n">derived_type_ast</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">main_ast</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;body&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="s2">&quot;is_derived_type&quot;</span> <span class="ow">in</span> <span class="n">index</span> <span class="ow">and</span> <span class="n">index</span><span class="p">[</span><span class="s2">&quot;is_derived_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;tag&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
                    <span class="n">derived_type_ast</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">main_ast</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;body&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># Print derived type declaration(s)</span>
        <span class="k">if</span> <span class="n">derived_type_ast</span><span class="p">:</span>
            <span class="n">code_generator</span><span class="o">.</span><span class="n">pyStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;@dataclass</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">derived_type_ast</span><span class="p">)):</span>
                <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">derived_type_ast</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;is_derived_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
                <span class="p">),</span> <span class="s2">&quot;[derived_type_ast] holds non-derived type ast&quot;</span>
                <span class="n">code_generator</span><span class="o">.</span><span class="n">nameMapping</span><span class="p">([</span><span class="n">derived_type_ast</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                <span class="n">code_generator</span><span class="o">.</span><span class="n">printDerivedType</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">derived_type_ast</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">PrintState</span><span class="p">()</span>
                <span class="p">)</span>

        <span class="n">code_generator</span><span class="o">.</span><span class="n">nameMapping</span><span class="p">(</span><span class="n">main_ast</span><span class="p">)</span>
        <span class="n">code_generator</span><span class="o">.</span><span class="n">printAst</span><span class="p">(</span><span class="n">main_ast</span><span class="p">,</span> <span class="n">PrintState</span><span class="p">())</span>
        <span class="n">py_sourcelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">code_generator</span><span class="o">.</span><span class="n">get_python_source</span><span class="p">(),</span> <span class="n">main_ast</span><span class="p">,</span> <span class="s2">&quot;program&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">py_sourcelist</span><span class="p">,</span> <span class="n">code_generator</span><span class="o">.</span><span class="n">variableMap</span><span class="p">)</span></div>


<div class="viewcode-block" id="parse_args"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.pyTranslate.parse_args">[docs]</a><span class="k">def</span> <span class="nf">parse_args</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-g&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--gen&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Routines for which dependency graphs should be generated&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-f&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--files&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Pickled version of the asts together with non-source code&quot;</span>
            <span class="s2">&quot;information&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-t&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--target&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Target directory to store the output files in&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--out&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Text file containing the list of output python files being &quot;</span>
             <span class="s2">&quot;generated&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="n">pickleFile</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pyFile</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">gen</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">outFile</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">targetDir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">pickleFile</span><span class="p">,</span> <span class="n">pyFile</span><span class="p">,</span> <span class="n">targetDir</span><span class="p">,</span> <span class="n">outFile</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="p">(</span><span class="n">pickleFile</span><span class="p">,</span> <span class="n">pyFile</span><span class="p">,</span> <span class="n">targetDir</span><span class="p">,</span> <span class="n">outFile</span><span class="p">)</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pickleFile</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">outputDict</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">For2PyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to read file </span><span class="si">{</span><span class="n">pickleFile</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="p">(</span><span class="n">python_source_list</span><span class="p">,</span> <span class="n">variable_map</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_python_source_list</span><span class="p">(</span><span class="n">outputDict</span><span class="p">)</span>
    <span class="n">outputList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">python_source_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;module&quot;</span><span class="p">:</span>
            <span class="n">modFile</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">targetDir</span><span class="si">}</span><span class="s2">m_</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">.py&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">modFile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">outputList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modFile</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">For2PyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to write to </span><span class="si">{</span><span class="n">modFile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pyFile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">outputList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pyFile</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">For2PyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to write to </span><span class="si">{</span><span class="n">pyFile</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="n">variable_map_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pyFile</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">_variables_pickle&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">variable_map_file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">variable_map</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">For2PyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to write to </span><span class="si">{</span><span class="n">variable_map_file</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outFile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="n">outputList</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">For2PyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to write to </span><span class="si">{</span><span class="n">outFile</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018, Adarsh.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>