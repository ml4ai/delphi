sudo: required
language:
 - python
 - cpp

services:
  - docker

compiler:
  - gcc

python:
  - "3.6"

before_install:
  - docker pull pauldhein/project-containers:delphi
  - docker run -itd --rm --name build-con pauldhein/project-containers:delphi
  - docker exec build-con git fetch
  - docker exec build-con git checkout $TRAVIS_COMMIT
  # - docker exec build-com git pull
  - docker exec build-con rm -rf /repo/delphi/build
  - docker exec build-con pip install -e .[test,docs]

script:
  - docker exec build-con make test
  - docker exec -w /repo/delphi/docs build-con bash -c "make apidocs; make html"

deploy:
  local-dir: docs/_build/html
  provider: pages
  skip-cleanup: true
  github-token: $GITHUB_TOKEN
  on:
    branch: master


after_success: bash <(curl -s https://codecov.io/bash)

cache: pip
